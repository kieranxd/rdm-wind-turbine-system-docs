{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"E-Ink Display IoT System Documentation","text":"<p>Welcome to the technical documentation for the E-Ink Display IoT System at the RDM campus wind turbine. This guide covers the complete setup, configuration, and maintenance of the digital infrastructure that powers the turbine monitoring and visualization system.</p> <p>About This Documentation</p> <p>This manual focuses exclusively on the installation, configuration, and maintenance of the technical systems that collect, store, and display wind turbine data. It is intended for system administrators and technical staff responsible for keeping the IoT infrastructure operational.</p>"},{"location":"#project-context","title":"Project Context","text":"<p>The broader project aims to increase visibility of the wind turbine's IoT capabilities through both digital and physical means:</p> <p>Physical Installation: - A sustainable display installation at the turbine location featuring the e-ink screen - Integration of displays showing turbine data in an attractive and understandable format - Different kind of art designs to replace the current fence at the turbine's location</p> <p>Digital Solution: - A simple way of providing access to the same data and visualizations online - Docker-based infrastructure for scalability and management - Integration between online and physical presentations</p> <p>This Documentation Covers:</p> <p>This manual documents the digital infrastructure that makes the project possible - the IoT stack, databases, visualization tools, networking, and automation that collect and display the turbine data. It provides step-by-step instructions for installing, configuring, and maintaining these systems.</p>"},{"location":"#system-overview","title":"System Overview","text":"<p>The system uses a layered architecture:</p> <ul> <li>Virtualization Layer: Proxmox host running a Linux VM</li> <li>Application Layer: Docker containers (Node-RED, InfluxDB, Grafana, Image Renderer)</li> <li>Bridge Layer: Raspberry Pi 4 in USB gadget mode</li> <li>Display Layer: Samsung EM32DX e-ink display </li> <li>Networking: Tailscale VPN connecting VM and Raspberry Pi</li> </ul> <p>For detailed architecture diagrams and data flow, see the Architecture section.</p>"},{"location":"#key-components","title":"Key Components","text":"<ul> <li>Proxmox Host: Virtualization platform hosting the IoT stack</li> <li>IOTstack: Docker-based IoT services (InfluxDB, Grafana, Node-RED, Portainer)</li> <li>Grafana Image Renderer: Custom service for rendering dashboard snapshots</li> <li>Raspberry Pi: USB gadget mode mass storage device</li> <li>Samsung EM32DX: E-ink display for data display</li> </ul>"},{"location":"#system-capabilities","title":"System Capabilities","text":"<ul> <li>Real-time wind turbine sensor monitoring (via eGauge)</li> <li>Weather data integration (nearby weather station API)</li> <li>Data storage in InfluxDB time-series database</li> <li>Visual dashboard in Grafana</li> <li>Automated image rendering and delivery to e-ink display</li> <li>USB mass storage display method via Raspberry Pi</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<ol> <li>New Installation: Start with Proxmox Host Setup</li> <li>Maintenance: See Regular Tasks</li> <li>Troubleshooting: Check Troubleshooting Guide</li> </ol>"},{"location":"#documentation-structure","title":"Documentation Structure","text":"<p>This manual is organized into logical sections:</p> <ul> <li>Architecture: Understand how the system works</li> <li>Infrastructure Setup: Set up the virtualization and IoT stack</li> <li>Docker Services: Configure individual services</li> <li>Raspberry Pi: Set up the USB gadget mode bridge</li> <li>Hardware: Physical setup and connections</li> <li>Maintenance: Keep the system running smoothly</li> </ul>"},{"location":"#support-contact","title":"Support &amp; Contact","text":"<p>For questions or issues, refer to the troubleshooting section or contact the system administrator.</p> <p>Documentation created: January 2026</p>"},{"location":"appendix/configs/","title":"Configuration Files","text":"<p>Reference for all key configuration files in the system.</p>"},{"location":"appendix/configs/#docker-compose","title":"Docker Compose","text":"<p>Location: <code>~/IOTstack/docker-compose.yml</code></p> <p>Authentication Tokens</p> <p>Replace <code>YOUR_RENDERER_TOKEN_HERE</code> and <code>YOUR_AUTH_TOKEN_HERE</code> with actual tokens in production.</p>"},{"location":"appendix/configs/#complete-configuration","title":"Complete Configuration","text":"<pre><code>networks:\n  iotstack_default:\n    external: true\n    name: \"iotstack_default\"\n\nservices:\n  grafana:\n    cap_drop:\n      - \"AUDIT_CONTROL\"\n      - \"BLOCK_SUSPEND\"\n      - \"DAC_READ_SEARCH\"\n      - \"IPC_LOCK\"\n      - \"IPC_OWNER\"\n      - \"LEASE\"\n      - \"LINUX_IMMUTABLE\"\n      - \"MAC_ADMIN\"\n      - \"MAC_OVERRIDE\"\n      - \"NET_ADMIN\"\n      - \"NET_BROADCAST\"\n      - \"SYSLOG\"\n      - \"SYS_ADMIN\"\n      - \"SYS_BOOT\"\n      - \"SYS_MODULE\"\n      - \"SYS_NICE\"\n      - \"SYS_PACCT\"\n      - \"SYS_PTRACE\"\n      - \"SYS_RAWIO\"\n      - \"SYS_RESOURCE\"\n      - \"SYS_TIME\"\n      - \"SYS_TTY_CONFIG\"\n      - \"WAKE_ALARM\"\n    container_name: \"grafana\"\n    entrypoint:\n      - \"/run.sh\"\n    environment:\n      - \"TZ=Etc/UTC\"\n      - \"GF_PATHS_DATA=/var/lib/grafana\"\n      - \"GF_PATHS_LOGS=/var/log/grafana\"\n      - \"PATH=/usr/share/grafana/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n      - \"GF_PATHS_CONFIG=/etc/grafana/grafana.ini\"\n      - \"GF_PATHS_HOME=/usr/share/grafana\"\n      - \"GF_PATHS_PLUGINS=/var/lib/grafana/plugins\"\n      - \"GF_PATHS_PROVISIONING=/etc/grafana/provisioning\"\n      - \"GF_RENDERING_SERVER_URL=http://145.24.180.60:8081/render\"\n      - \"GF_RENDERING_CALLBACK_URL=http://145.24.180.60:3000/\"\n      - \"GF_RENDERING_RENDERER_TOKEN=YOUR_RENDERER_TOKEN_HERE\"\n      - \"GF_SERVER_DOMAIN=145.24.180.60\"\n    hostname: \"568c217d58c8\"\n    image: \"grafana/grafana:latest\"\n    ipc: \"private\"\n    labels:\n      maintainer: \"Grafana Labs &lt;hello@grafana.com&gt;\"\n      org.opencontainers.image.source: \"https://github.com/grafana/grafana\"\n    logging:\n      driver: \"json-file\"\n      options: {}\n    networks:\n      - \"iotstack_default\"\n    ports:\n      - \"3000:3000/tcp\"\n    restart: \"unless-stopped\"\n    user: \"0\"\n    volumes:\n      - \"/home/iotuser/IOTstack/volumes/grafana/data:/var/lib/grafana\"\n      - \"/home/iotuser/IOTstack/volumes/grafana/log:/var/log/grafana\"\n    working_dir: \"/usr/share/grafana\"\n  influxdb:\n    command:\n      - \"influxd\"\n    container_name: \"influxdb\"\n    entrypoint:\n      - \"/entrypoint.sh\"\n    environment:\n      - \"INFLUXDB_REPORTING_DISABLED=false\"\n      - \"INFLUXDB_HTTP_AUTH_ENABLED=false\"\n      - \"INFLUXDB_MONITOR_STORE_ENABLED=FALSE\"\n      - \"TZ=Etc/UTC\"\n      - \"INFLUXDB_HTTP_FLUX_ENABLED=false\"\n      - \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n    hostname: \"f5dd8a03e804\"\n    image: \"influxdb:1.11\"\n    ipc: \"private\"\n    logging:\n      driver: \"json-file\"\n      options: {}\n    networks:\n      - \"iotstack_default\"\n    ports:\n      - \"8086:8086/tcp\"\n    restart: \"unless-stopped\"\n    user: \"0\"\n    volumes:\n      - \"/home/iotuser/IOTstack/backups/influxdb/db:/var/lib/influxdb/backup\"\n      - \"/home/iotuser/IOTstack/volumes/influxdb/data:/var/lib/influxdb\"\n  nodered:\n    cap_drop:\n      - \"AUDIT_CONTROL\"\n      - \"BLOCK_SUSPEND\"\n      - \"DAC_READ_SEARCH\"\n      - \"IPC_LOCK\"\n      - \"IPC_OWNER\"\n      - \"LEASE\"\n      - \"LINUX_IMMUTABLE\"\n      - \"MAC_ADMIN\"\n      - \"MAC_OVERRIDE\"\n      - \"NET_ADMIN\"\n      - \"NET_BROADCAST\"\n      - \"SYSLOG\"\n      - \"SYS_ADMIN\"\n      - \"SYS_BOOT\"\n      - \"SYS_MODULE\"\n      - \"SYS_NICE\"\n      - \"SYS_PACCT\"\n      - \"SYS_PTRACE\"\n      - \"SYS_RAWIO\"\n      - \"SYS_RESOURCE\"\n      - \"SYS_TIME\"\n      - \"SYS_TTY_CONFIG\"\n      - \"WAKE_ALARM\"\n    container_name: \"nodered\"\n    entrypoint:\n      - \"./entrypoint.sh\"\n    environment:\n      - \"TZ=Europe/Amsterdam\"\n      - \"NODE_OPTIONS=--dns-result-order=ipv4first\"\n      - \"PATH=/usr/src/node-red/node_modules/.bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n      - \"NODE_VERSION=20.19.5\"\n      - \"YARN_VERSION=1.22.22\"\n      - \"NODE_RED_VERSION=v4.1.1\"\n      - \"NODE_PATH=/usr/src/node-red/node_modules:/data/node_modules\"\n      - \"FLOWS=flows.json\"\n    hostname: \"0b07c52e9073\"\n    image: \"iotstack-nodered:latest\"\n    ipc: \"private\"\n    labels:\n      authors: \"Dave Conway-Jones, Nick O'Leary, James Thomas, Raymond Mouthaan\"\n      org.opencontainers.image.source: \"https://github.com/node-red/node-red-docker\"\n    logging:\n      driver: \"json-file\"\n      options: {}\n    network_mode: \"host\"\n    ports:\n      - \"1880:1880/tcp\"\n    restart: \"unless-stopped\"\n    user: \"0\"\n    volumes:\n      - \"/home/iotuser/IOTstack/volumes/nodered/data:/data\"\n      - \"/home/iotuser/IOTstack/volumes/nodered/ssh:/root/.ssh\"\n    working_dir: \"/usr/src/node-red\"\n  portainer-ce:\n    container_name: \"portainer-ce\"\n    entrypoint:\n      - \"/portainer\"\n    environment:\n      - \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n    hostname: \"9dd856bf4ddd\"\n    image: \"portainer/portainer-ce\"\n    ipc: \"private\"\n    labels:\n      io.portainer.server: \"true\"\n      org.opencontainers.image.description: \"Docker container management made simple, with the world's most popular GUI-based container management platform.\"\n      org.opencontainers.image.title: \"Portainer\"\n      org.opencontainers.image.vendor: \"Portainer.io\"\n    logging:\n      driver: \"json-file\"\n      options: {}\n    networks:\n      - \"iotstack_default\"\n    ports:\n      - \"8000:8000/tcp\"\n      - \"9000:9000/tcp\"\n      - \"9443:9443/tcp\"\n    restart: \"unless-stopped\"\n    volumes:\n      - \"/home/iotuser/IOTstack/volumes/portainer-ce/data:/data\"\n      - \"/var/run/docker.sock:/var/run/docker.sock\"\n    working_dir: \"/\"\n  renderer:\n    cap_drop:\n      - \"AUDIT_CONTROL\"\n      - \"BLOCK_SUSPEND\"\n      - \"DAC_READ_SEARCH\"\n      - \"IPC_LOCK\"\n      - \"IPC_OWNER\"\n      - \"LEASE\"\n      - \"LINUX_IMMUTABLE\"\n      - \"MAC_ADMIN\"\n      - \"MAC_OVERRIDE\"\n      - \"NET_ADMIN\"\n      - \"NET_BROADCAST\"\n      - \"SYSLOG\"\n      - \"SYS_ADMIN\"\n      - \"SYS_BOOT\"\n      - \"SYS_MODULE\"\n      - \"SYS_NICE\"\n      - \"SYS_PACCT\"\n      - \"SYS_PTRACE\"\n      - \"SYS_RAWIO\"\n      - \"SYS_RESOURCE\"\n      - \"SYS_TIME\"\n      - \"SYS_TTY_CONFIG\"\n      - \"WAKE_ALARM\"\n    command:\n      - \"server\"\n    container_name: \"renderer\"\n    entrypoint:\n      - \"tini\"\n      - \"--\"\n      - \"/usr/bin/grafana-image-renderer\"\n    environment:\n      - \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n      - \"CHROME_BIN=/usr/bin/chromium\"\n      - \"LANG=en_US.UTF-8\"\n      - \"LC_ALL=en_US.UTF-8\"\n      - \"AUTH_TOKEN=YOUR_AUTH_TOKEN_HERE\"\n      - \"TZ=Europe/Amsterdam\"\n    hostname: \"3a5022bd091e\"\n    image: \"grafana/grafana-image-renderer:latest\"\n    ipc: \"private\"\n    labels:\n      maintainer: \"Grafana team &lt;hello@grafana.com&gt;\"\n      org.opencontainers.image.source: \"https://github.com/grafana/grafana-image-renderer/tree/master/Dockerfile\"\n    logging:\n      driver: \"json-file\"\n      options: {}\n    networks:\n      - \"iotstack_default\"\n    ports:\n      - \"8081:8081/tcp\"\n    restart: \"unless-stopped\"\n    user: \"65532\"\n    working_dir: \"/home/nonroot\"\nversion: \"3.6\"\n</code></pre> <p>Notes:</p> <ul> <li>Update IP addresses to match your network</li> <li>Adjust volume paths as needed</li> </ul>"},{"location":"appendix/configs/#node-red-settings","title":"Node-RED Settings","text":"<p>Location: <code>~/IOTstack/volumes/nodered/data/settings.js</code></p>"},{"location":"appendix/configs/#key-sections","title":"Key Sections","text":"<pre><code>module.exports = {\n    // Server settings\n    uiPort: process.env.PORT || 1880,\n\n    // Security\n    adminAuth: {\n        type: \"credentials\",\n        users: [{\n            username: \"admin\",\n            password: \"$2b$08$...\",  // Generated hash\n            permissions: \"*\"\n        }]\n    },\n\n    // Editor settings\n    editorTheme: {\n        projects: {\n            enabled: false\n        }\n    },\n\n    // Logging\n    logging: {\n        console: {\n            level: \"info\",\n            metrics: false,\n            audit: false\n        }\n    },\n\n    // Context storage\n    contextStorage: {\n        default: {\n            module: \"memory\"\n        }\n    }\n}\n</code></pre>"},{"location":"appendix/configs/#grafana-environment-variables","title":"Grafana Environment Variables","text":""},{"location":"appendix/configs/#required-for-image-rendering","title":"Required for Image Rendering","text":"<pre><code>GF_SERVER_DOMAIN=192.168.178.164\nGF_SERVER_ROOT_URL=http://192.168.178.164:3000/\nGF_SERVER_SERVE_FROM_SUB_PATH=false\nGF_RENDERING_SERVER_URL=http://grafana-image-renderer:8081/render\nGF_RENDERING_CALLBACK_URL=http://192.168.178.164:3000/\nGF_RENDERING_RENDERER_TOKEN=glsa_AzyNQ7uhzHzg4UCe5KC8fHUAiJPGjBaz_0d0c9ffb\n</code></pre>"},{"location":"appendix/configs/#optional-settings","title":"Optional Settings","text":"<pre><code># Anonymous access\nGF_AUTH_ANONYMOUS_ENABLED=true\nGF_AUTH_ANONYMOUS_ORG_ROLE=Viewer\n\n# SMTP for alerts\nGF_SMTP_ENABLED=true\nGF_SMTP_HOST=smtp.gmail.com:587\nGF_SMTP_USER=your-email@gmail.com\nGF_SMTP_PASSWORD=your-app-password\nGF_SMTP_FROM_ADDRESS=your-email@gmail.com\n</code></pre>"},{"location":"appendix/configs/#raspberry-pi-network-configuration","title":"Raspberry Pi Network Configuration","text":""},{"location":"appendix/configs/#static-ip-dhcpcd","title":"Static IP (dhcpcd)","text":"<p>Location: <code>/etc/dhcpcd.conf</code></p> <pre><code>interface eth0\nstatic ip_address=192.168.178.148/24\nstatic routers=192.168.178.1\nstatic domain_name_servers=8.8.8.8 8.8.4.4\n</code></pre>"},{"location":"appendix/configs/#static-ip-netplan-ubuntu","title":"Static IP (Netplan - Ubuntu)","text":"<p>Location: <code>/etc/netplan/01-netcfg.yaml</code></p> <pre><code>network:\n  version: 2\n  renderer: networkd\n  ethernets:\n    eth0:\n      dhcp4: no\n      addresses:\n        - 192.168.178.148/24\n      gateway4: 192.168.178.1\n      nameservers:\n        addresses:\n          - 8.8.8.8\n          - 8.8.4.4\n</code></pre> <p>Apply:</p> <pre><code>sudo netplan apply\n</code></pre>"},{"location":"appendix/configs/#raspberry-pi-boot-configuration","title":"Raspberry Pi Boot Configuration","text":"<p>Location: <code>/boot/config.txt</code></p> <pre><code># Enable USB gadget mode\ndtoverlay=dwc2\n\n# PoE HAT fan control\ndtparam=poe_fan_temp0=60000\ndtparam=poe_fan_temp1=65000\ndtparam=poe_fan_temp2=70000\ndtparam=poe_fan_temp3=75000\n</code></pre> <p>Location: <code>/boot/cmdline.txt</code></p> <pre><code>console=serial0,115200 console=tty1 root=PARTUUID=... rootfstype=ext4 fsck.repair=yes rootwait modules-load=dwc2,libcomposite\n</code></pre>"},{"location":"appendix/configs/#tailscale-configuration","title":"Tailscale Configuration","text":""},{"location":"appendix/configs/#on-vm-docker","title":"On VM (Docker)","text":"<p>Location: <code>~/IOTstack/docker-compose.yml</code> (see Docker Compose section above)</p> <p>Authenticate:</p> <pre><code>docker exec tailscale tailscale up\n</code></pre> <p>Get Tailscale IP:</p> <pre><code>docker exec tailscale tailscale ip -4\n</code></pre> <p>Check status:</p> <pre><code>docker exec tailscale tailscale status\n</code></pre>"},{"location":"appendix/configs/#on-raspberry-pi-native","title":"On Raspberry Pi (Native)","text":"<p>Install:</p> <pre><code>curl -fsSL https://tailscale.com/install.sh | sh\nsudo tailscale up\n</code></pre> <p>Get Tailscale IP:</p> <pre><code>tailscale ip -4\n</code></pre> <p>Check status:</p> <pre><code>sudo tailscale status\n</code></pre> <p>Enable on boot:</p> <pre><code>sudo systemctl enable tailscaled\n</code></pre>"},{"location":"appendix/configs/#tailscale-network-ips","title":"Tailscale Network IPs","text":"<ul> <li>VM Tailscale IP: e.g., <code>100.64.1.10</code> (assigned automatically)</li> <li>Raspberry Pi Tailscale IP: e.g., <code>100.64.1.5</code> (assigned automatically)</li> <li>IP Range: Typically <code>100.x.x.x</code> (Tailscale CGNAT range)</li> </ul>"},{"location":"appendix/configs/#systemd-service-files","title":"Systemd Service Files","text":""},{"location":"appendix/configs/#usb-gadget-service","title":"USB Gadget Service","text":"<p>Location: <code>/etc/systemd/system/usb-gadget.service</code></p> <pre><code>[Unit]\nDescription=USB Gadget Mode Configuration\nAfter=network.target\n\n[Service]\nType=oneshot\nExecStart=/usr/local/bin/gadget.sh\nRemainAfterExit=yes\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Enable:</p> <pre><code>sudo systemctl enable usb-gadget.service\n</code></pre>"},{"location":"appendix/configs/#ssh-configuration","title":"SSH Configuration","text":""},{"location":"appendix/configs/#ssh-server-config","title":"SSH Server Config","text":"<p>Location: <code>/etc/ssh/sshd_config</code></p> <pre><code># Security settings\nPasswordAuthentication no\nPubkeyAuthentication yes\nPermitRootLogin no\nChallengeResponseAuthentication no\n\n# Performance\nUseDNS no\n</code></pre> <p>Restart SSH:</p> <pre><code>sudo systemctl restart ssh\n</code></pre>"},{"location":"appendix/configs/#authorized-keys","title":"Authorized Keys","text":"<p>Location: <code>~/.ssh/authorized_keys</code></p> <pre><code>ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAI... node-red@iotstack\n</code></pre> <p>Permissions:</p> <pre><code>chmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\n</code></pre>"},{"location":"appendix/configs/#sudo-configuration","title":"Sudo Configuration","text":"<p>Location: <code>/etc/sudoers.d/nopasswd</code></p> <pre><code>hrtech ALL=(ALL) NOPASSWD: /usr/bin/tee\nhrtech ALL=(ALL) NOPASSWD: /usr/bin/mount\nhrtech ALL=(ALL) NOPASSWD: /usr/bin/umount\nhrtech ALL=(ALL) NOPASSWD: /usr/bin/mkdir\nhrtech ALL=(ALL) NOPASSWD: /bin/rm\nhrtech ALL=(ALL) NOPASSWD: /bin/cp\n</code></pre> <p>Create with:</p> <pre><code>sudo visudo -f /etc/sudoers.d/nopasswd\n</code></pre>"},{"location":"appendix/configs/#firewall-rules","title":"Firewall Rules","text":""},{"location":"appendix/configs/#ufw-uncomplicated-firewall","title":"UFW (Uncomplicated Firewall)","text":"<p>On VM:</p> <pre><code>sudo ufw allow from 192.168.178.0/24 to any port 3000  # Grafana\nsudo ufw allow from 192.168.178.0/24 to any port 8086  # InfluxDB\nsudo ufw allow from 192.168.178.0/24 to any port 1880  # Node-RED\nsudo ufw allow from 192.168.178.0/24 to any port 9000  # Portainer\nsudo ufw allow from 192.168.178.0/24 to any port 22    # SSH\nsudo ufw enable\n</code></pre> <p>On Raspberry Pi:</p> <pre><code># Allow SSH only through Tailscale interface\nsudo ufw allow in on tailscale0 to any port 22\nsudo ufw deny 22/tcp\nsudo ufw enable\n</code></pre> <p>Check status:</p> <pre><code>sudo ufw status numbered\n</code></pre>"},{"location":"appendix/configs/#cron-jobs","title":"Cron Jobs","text":""},{"location":"appendix/configs/#automated-backups","title":"Automated Backups","text":"<p>Location: User crontab (<code>crontab -e</code>)</p> <pre><code># Daily backup at 2 AM\n0 2 * * * cd ~/IOTstack &amp;&amp; ./scripts/backup.sh\n\n# Weekly cleanup at 3 AM Sunday\n0 3 * * 0 docker system prune -f\n\n# Daily offsite sync at 4 AM\n0 4 * * * rclone sync ~/IOTstack/backups/ remote:backups/\n</code></pre>"},{"location":"appendix/configs/#influxdb-configuration","title":"InfluxDB Configuration","text":""},{"location":"appendix/configs/#create-database","title":"Create Database","text":"<pre><code>docker exec influxdb influx -execute \"CREATE DATABASE iot_data\"\n</code></pre>"},{"location":"appendix/configs/#retention-policy","title":"Retention Policy","text":"<pre><code>docker exec influxdb influx -execute \\\n  \"CREATE RETENTION POLICY 90_days ON iot_data DURATION 90d REPLICATION 1 DEFAULT\"\n</code></pre>"},{"location":"appendix/configs/#show-configuration","title":"Show Configuration","text":"<pre><code>docker exec influxdb influx -execute \"SHOW DATABASES\"\ndocker exec influxdb influx -execute \"SHOW RETENTION POLICIES ON iot_data\"\n</code></pre>"},{"location":"appendix/configs/#environment-variables-summary","title":"Environment Variables Summary","text":""},{"location":"appendix/configs/#grafana","title":"Grafana","text":"Variable Value Purpose GF_SERVER_DOMAIN 192.168.178.164 Server address GF_SERVER_ROOT_URL http://192.168.178.164:3000/ Base URL GF_RENDERING_SERVER_URL http://grafana-image-renderer:8081/render Renderer endpoint GF_RENDERING_CALLBACK_URL http://192.168.178.164:3000/ Callback for renderer GF_RENDERING_RENDERER_TOKEN glsa_... Auth token"},{"location":"appendix/configs/#grafana-image-renderer","title":"Grafana Image Renderer","text":"Variable Value Purpose AUTH_TOKEN glsa_... Must match Grafana token HTTP_HOST 0.0.0.0 Listen on all interfaces HTTP_PORT 8081 Service port BROWSER_TZ Europe/Amsterdam Timezone for rendering"},{"location":"appendix/configs/#node-red","title":"Node-RED","text":"Variable Value Purpose TZ Europe/Amsterdam Timezone NODE_RED_CREDENTIAL_SECRET (optional) Encrypt credentials"},{"location":"appendix/configs/#tailscale","title":"Tailscale","text":"Variable Value Purpose TS_AUTHKEY (optional) Auth key for unattended setup TS_STATE_DIR /var/lib/tailscale State directory TS_EXTRA_ARGS --advertise-tags=tag:iotstack Additional arguments"},{"location":"appendix/configs/#file-locations-reference","title":"File Locations Reference","text":"File/Directory Location Purpose Docker Compose <code>~/IOTstack/docker-compose.yml</code> Stack definition InfluxDB data <code>~/IOTstack/volumes/influxdb/data/</code> Database storage Grafana data <code>~/IOTstack/volumes/grafana/data/</code> Dashboards, config Node-RED flows <code>~/IOTstack/volumes/nodered/data/flows.json</code> Flow definitions Node-RED settings <code>~/IOTstack/volumes/nodered/data/settings.js</code> Configuration Tailscale state <code>~/IOTstack/volumes/tailscale/state/</code> Tailscale configuration Backups <code>~/IOTstack/backups/</code> Backup storage Pi scripts <code>/home/hrtech/*.sh</code> Shell scripts Gadget script <code>/usr/local/bin/gadget.sh</code> USB gadget setup USB backing file <code>/home/hrtech/drive.bin</code> Mass storage image Incoming images <code>/home/hrtech/incoming_images/</code> From Node-RED Processed images <code>/home/hrtech/eink_usb/SAMSUNG_E-Paper/</code> Ready for display"},{"location":"appendix/configs/#default-ports","title":"Default Ports","text":"Service Port Protocol Access Grafana 3000 HTTP Web UI InfluxDB 8086 HTTP API Node-RED 1880 HTTP Web UI Portainer 9000 HTTP Web UI Image Renderer 8081 HTTP Internal SSH 22 TCP Terminal PoE+ N/A Ethernet Power"},{"location":"appendix/configs/#api-credentials","title":"API Credentials","text":""},{"location":"appendix/configs/#egauge-xml-api","title":"eGauge XML API","text":"<p>Endpoint: <code>https://egauge84432.egaug.es/cgi-bin/egauge?inst</code></p> <p>Authentication: Digest Auth - Username: <code>HR_RDM</code> - Password: (contact system administrator)</p> <p>Register Types:</p> <p>The eGauge XML API returns instantaneous values for various register types. According to the eGauge XML API documentation, the main register types include:</p> <ul> <li>Power registers (e.g., <code>S6_*</code>, <code>S5_*</code>, <code>S2_*</code>): Grid power measurements in watts</li> <li>Orientation registers (e.g., <code>IM_*</code>): Turbine orientation and position data</li> <li>Vibration registers (e.g., <code>VM_*</code>): Vibration monitoring sensors</li> <li>Frequency registers: Grid and generator frequency in Hz</li> <li>Voltage registers: Line voltage measurements</li> </ul> <p>The Node-RED flow sanitizes these register names by converting them to snake_case and adding appropriate prefixes (e.g., <code>grid_</code>, <code>orientation_</code>, <code>vibration_</code>).</p> <p>Response Format: XML containing register values with metadata</p> <p>Documentation: See <code>egauge-xml-api.pdf</code> in project root for complete register type specifications and data structures.</p>"},{"location":"appendix/configs/#weather-api","title":"Weather API","text":"<p>Endpoint: <code>https://weerlive.nl/api/weerlive_api_v2.php</code></p> <p>Authentication: API Key - Key: <code>3c2224ecab</code> - Location: <code>51.89908,4.42348</code> (Rotterdam coordinates)</p> <p>No additional authentication required - API key is passed as URL parameter.</p>"},{"location":"appendix/configs/#quick-reference-commands","title":"Quick Reference Commands","text":"<pre><code># Start all services\ncd ~/IOTstack &amp;&amp; docker compose up -d\n\n# Stop all services\ncd ~/IOTstack &amp;&amp; docker compose down\n\n# View logs\ndocker compose logs -f &lt;service&gt;\n\n# Restart service\ndocker compose restart &lt;service&gt;\n\n# Backup\ncd ~/IOTstack &amp;&amp; ./scripts/backup.sh\n\n# InfluxDB CLI\ndocker exec -it influxdb influx\n\n# Check gadget status\ncat /sys/kernel/config/usb_gadget/EInkGadget/UDC\n\n# SSH to Pi (via Tailscale)\nssh hrtech@&lt;pi-tailscale-ip&gt;  # e.g., ssh hrtech@100.64.1.5\n\n# Trigger refresh (via Tailscale)\nssh hrtech@&lt;pi-tailscale-ip&gt; '/home/hrtech/refresh_script.sh'\n\n# Check Tailscale status\ndocker exec tailscale tailscale status  # On VM (if Docker)\nsudo tailscale status  # On Pi or VM (if native)\n</code></pre>"},{"location":"appendix/references/","title":"References","text":"<p>External resources and documentation links.</p>"},{"location":"appendix/references/#official-documentation","title":"Official Documentation","text":""},{"location":"appendix/references/#core-technologies","title":"Core Technologies","text":"<p>Proxmox</p> <ul> <li>Official Site: https://www.proxmox.com/</li> <li>Documentation: https://pve.proxmox.com/pve-docs/</li> <li>Wiki: https://pve.proxmox.com/wiki/</li> <li>Forum: https://forum.proxmox.com/</li> </ul> <p>IOTstack</p> <ul> <li>GitHub Repository: https://github.com/SensorsIot/IOTstack</li> <li>Installation Guide: https://sensorsiot.github.io/IOTstack/</li> <li>Discord Community: IOTstack Discord</li> </ul> <p>Docker</p> <ul> <li>Official Site: https://www.docker.com/</li> <li>Documentation: https://docs.docker.com/</li> <li>Docker Compose: https://docs.docker.com/compose/</li> <li>Docker Hub: https://hub.docker.com/</li> </ul> <p>Tailscale</p> <ul> <li>Official Site: https://tailscale.com/</li> <li>Documentation: https://tailscale.com/kb/</li> <li>Download: https://tailscale.com/download</li> <li>Admin Console: https://login.tailscale.com/</li> <li>GitHub: https://github.com/tailscale/tailscale</li> </ul>"},{"location":"appendix/references/#services","title":"Services","text":"<p>InfluxDB</p> <ul> <li>Official Site: https://www.influxdata.com/</li> <li>InfluxDB 1.x Docs: https://docs.influxdata.com/influxdb/v1.8/</li> <li>InfluxQL Reference: https://docs.influxdata.com/influxdb/v1.8/query_language/</li> <li>Community Forum: https://community.influxdata.com/</li> </ul> <p>Grafana</p> <ul> <li>Official Site: https://grafana.com/</li> <li>Documentation: https://grafana.com/docs/grafana/latest/</li> <li>Dashboard Repository: https://grafana.com/grafana/dashboards/</li> <li>Community Forum: https://community.grafana.com/</li> </ul> <p>Grafana Image Renderer</p> <ul> <li>GitHub: https://github.com/grafana/grafana-image-renderer</li> <li>Documentation: https://grafana.com/docs/grafana/latest/setup-grafana/image-rendering/</li> </ul> <p>Node-RED</p> <ul> <li>Official Site: https://nodered.org/</li> <li>Documentation: https://nodered.org/docs/</li> <li>Flow Library: https://flows.nodered.org/</li> <li>Forum: https://discourse.nodered.org/</li> </ul> <p>Portainer</p> <ul> <li>Official Site: https://www.portainer.io/</li> <li>Documentation: https://docs.portainer.io/</li> <li>GitHub: https://github.com/portainer/portainer</li> </ul>"},{"location":"appendix/references/#hardware","title":"Hardware","text":"<p>Raspberry Pi</p> <ul> <li>Official Site: https://www.raspberrypi.com/</li> <li>Documentation: https://www.raspberrypi.com/documentation/</li> <li>USB Gadget Mode: https://www.kernel.org/doc/html/latest/usb/gadget.html</li> <li>Forums: https://forums.raspberrypi.com/</li> </ul> <p>Samsung E-Ink Display</p> <ul> <li>Samsung Display: https://www.samsung.com/us/business/displays/</li> </ul> <p>PoE Standards</p> <ul> <li>IEEE 802.3af (PoE): https://standards.ieee.org/standard/802_3af-2003.html</li> <li>IEEE 802.3at (PoE+): https://standards.ieee.org/standard/802_3at-2009.html</li> </ul>"},{"location":"appendix/references/#tutorials-guides","title":"Tutorials &amp; Guides","text":""},{"location":"appendix/references/#getting-started","title":"Getting Started","text":"<ul> <li>IOTstack Setup Guide: https://sensorsiot.github.io/IOTstack/Basic_setup/</li> <li>Docker for Beginners: https://docker-curriculum.com/</li> <li>InfluxDB + Grafana Tutorial: https://grafana.com/docs/grafana/latest/datasources/influxdb/</li> <li>Node-RED Basics: https://nodered.org/docs/tutorials/</li> <li>Tailscale Quick Start: https://tailscale.com/kb/1017/install/</li> <li>Tailscale in Docker: https://tailscale.com/kb/1282/docker/</li> </ul>"},{"location":"appendix/references/#advanced-topics","title":"Advanced Topics","text":"<ul> <li>Raspberry Pi USB Gadget: https://www.isticktoit.net/?p=1383</li> <li>Proxmox Backup &amp; Restore: https://pve.proxmox.com/wiki/Backup_and_Restore</li> <li>Docker Networking: https://docs.docker.com/network/</li> <li>InfluxDB Performance Tuning: https://docs.influxdata.com/influxdb/v1.8/guides/hardware_sizing/</li> <li>Tailscale ACLs: https://tailscale.com/kb/1018/acls/</li> <li>Tailscale Exit Nodes: https://tailscale.com/kb/1103/exit-nodes/</li> </ul>"},{"location":"appendix/references/#community-resources","title":"Community Resources","text":""},{"location":"appendix/references/#forums-support","title":"Forums &amp; Support","text":"<ul> <li>Stack Overflow (Docker): https://stackoverflow.com/questions/tagged/docker</li> <li>Stack Overflow (Grafana): https://stackoverflow.com/questions/tagged/grafana</li> <li>Reddit r/homelab: https://www.reddit.com/r/homelab/</li> <li>Reddit r/selfhosted: https://www.reddit.com/r/selfhosted/</li> </ul>"},{"location":"appendix/references/#youtube-channels","title":"YouTube Channels","text":"<ul> <li>Andreas Spiess (IOTstack creator): https://www.youtube.com/c/AndreasSpiess</li> <li>NetworkChuck (Proxmox tutorials): https://www.youtube.com/c/NetworkChuck</li> <li>Techno Tim (Docker &amp; Self-hosting): https://www.youtube.com/c/TechnoTimLive</li> </ul>"},{"location":"appendix/references/#tools-utilities","title":"Tools &amp; Utilities","text":""},{"location":"appendix/references/#network-tools","title":"Network Tools","text":"<ul> <li>nmap: Network scanning: https://nmap.org/</li> <li>iperf3: Network performance: https://iperf.fr/</li> <li>wireshark: Packet analysis: https://www.wireshark.org/</li> <li>Tailscale: Mesh VPN: https://tailscale.com/</li> <li>ping/traceroute: Built-in connectivity testing</li> </ul>"},{"location":"appendix/references/#system-monitoring","title":"System Monitoring","text":"<ul> <li>htop: Interactive process viewer: https://htop.dev/</li> <li>iotop: I/O monitoring: http://guichaz.free.fr/iotop/</li> <li>ncdu: Disk usage analyzer: https://dev.yorhel.nl/ncdu</li> </ul>"},{"location":"appendix/references/#backup-tools","title":"Backup Tools","text":"<ul> <li>rclone: Cloud sync: https://rclone.org/</li> <li>restic: Backup program: https://restic.net/</li> <li>Proxmox Backup Server: https://www.proxmox.com/en/proxmox-backup-server</li> </ul>"},{"location":"appendix/references/#development-tools","title":"Development Tools","text":"<ul> <li>Visual Studio Code: Code editor: https://code.visualstudio.com/</li> <li>Postman: API testing: https://www.postman.com/</li> <li>jq: JSON processor: https://stedolan.github.io/jq/</li> </ul>"},{"location":"appendix/references/#api-documentation","title":"API Documentation","text":""},{"location":"appendix/references/#weather-api","title":"Weather API","text":"<ul> <li>Weerlive API: https://weerlive.nl/api/</li> <li>Documentation: Contact provider for full API docs</li> </ul>"},{"location":"appendix/references/#egauge-api","title":"eGauge API","text":"<ul> <li>eGauge Systems: https://www.egauge.net/</li> <li>API Documentation: See egauge-xml-api.pdf for complete XML API reference</li> <li>Endpoint: <code>https://egauge84432.egaug.es/cgi-bin/egauge?inst</code> (instantaneous values)</li> <li>Authentication: Digest Auth required</li> <li>Response format: XML with register values and metadata</li> <li>Documentation includes: Register types, data structures, query parameters, and examples</li> </ul>"},{"location":"appendix/references/#project-configuration-files","title":"Project Configuration Files","text":""},{"location":"appendix/references/#node-red-flow","title":"Node-RED Flow","text":"<ul> <li>File: flows.json</li> <li>Description: Complete Node-RED flow configuration for data collection and visualization</li> <li>Contents: HTTP request nodes, InfluxDB integration, Grafana rendering, SSH/SCP commands</li> <li>Usage: Import via Node-RED UI \u2192 Menu \u2192 Import \u2192 Select file</li> </ul>"},{"location":"appendix/references/#grafana-dashboard","title":"Grafana Dashboard","text":"<ul> <li>File: dashboard.json</li> <li>Description: Pre-configured Grafana dashboard for wind turbine monitoring</li> <li>Contents: Panels for turbine data, weather information, and system metrics</li> <li>Usage: Import via Grafana UI \u2192 Dashboards \u2192 Import \u2192 Upload JSON file</li> </ul>"},{"location":"appendix/references/#security-resources","title":"Security Resources","text":""},{"location":"appendix/references/#best-practices","title":"Best Practices","text":"<ul> <li>Docker Security: https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html</li> <li>SSH Hardening: https://www.ssh.com/academy/ssh/security</li> <li>Linux Security: https://www.cisecurity.org/benchmark/ubuntu_linux</li> </ul>"},{"location":"appendix/references/#security-tools","title":"Security Tools","text":"<ul> <li>fail2ban: Intrusion prevention: https://www.fail2ban.org/</li> <li>ClamAV: Antivirus: https://www.clamav.net/</li> <li>Lynis: Security auditing: https://cisofy.com/lynis/</li> </ul>"},{"location":"appendix/references/#standards-specifications","title":"Standards &amp; Specifications","text":""},{"location":"appendix/references/#network-standards","title":"Network Standards","text":"<ul> <li>IEEE 802.3: Ethernet standards</li> <li>RFC 791: Internet Protocol (IP)</li> <li>RFC 793: Transmission Control Protocol (TCP)</li> </ul>"},{"location":"appendix/references/#data-formats","title":"Data Formats","text":"<ul> <li>JSON: https://www.json.org/</li> <li>YAML: https://yaml.org/</li> <li>XML: https://www.w3.org/XML/</li> </ul>"},{"location":"appendix/references/#montreal-solutions-documentation","title":"Montreal Solutions Documentation","text":"<p>Wind Turbine Sensors &amp; Equipment</p> <p>Montreal Solutions installed and maintains the sensor equipment on the RDM wind turbine.</p> <ul> <li>Device Manual: See Montreal Solutions Devices Manual V1.0-1.pdf</li> <li>Wind Turbine Sensors: Induction sensor, vibration sensor (WitMotion WTVB01-485), rotation sensor (WitMotion WT901C-485)</li> <li>Electrical Cabinet: eGauge EG4015 data logger, Teltonika RUT241 4G modem, RS485-USB converters, power coils</li> <li>Connectivity: Equipment layout, cable connections, and ethernet ports</li> <li>Equipment Locations: Diagrams showing sensor placement and electrical cabinet layout</li> <li>Warning: Warranty void if equipment is altered</li> <li>Data Logger Access: eGauge dashboard for sensor data (see eGauge API section above)</li> <li>Internet: 4G modem with unlimited SIM from Hogeschool Rotterdam</li> </ul> <p>Equipment Maintenance</p> <p>All sensors and devices installed by Montreal Solutions are under warranty. Do not modify their equipment without consulting Montreal Solutions first to avoid voiding the warranty.</p>"},{"location":"appendix/references/#related-projects","title":"Related Projects","text":""},{"location":"appendix/references/#similar-setups","title":"Similar Setups","text":"<ul> <li>Home Assistant: https://www.home-assistant.io/</li> <li>OpenHAB: https://www.openhab.org/</li> <li>Domoticz: https://www.domoticz.com/</li> </ul>"},{"location":"appendix/references/#alternative-stacks","title":"Alternative Stacks","text":"<ul> <li>TIG Stack (Telegraf, InfluxDB, Grafana): https://www.influxdata.com/time-series-platform/</li> <li>ELK Stack (Elasticsearch, Logstash, Kibana): https://www.elastic.co/elk-stack</li> <li>Prometheus + Grafana: https://prometheus.io/</li> </ul>"},{"location":"appendix/references/#glossary","title":"Glossary","text":""},{"location":"appendix/references/#common-terms","title":"Common Terms","text":"<ul> <li>Docker Container: Lightweight, standalone executable package</li> <li>Volume: Persistent data storage for containers</li> <li>PoE+: Power over Ethernet Plus (IEEE 802.3at)</li> <li>E-Ink: Electronic paper display technology</li> <li>USB Gadget Mode: Linux feature to emulate USB devices</li> <li>Time Series Database: Database optimized for timestamped data</li> <li>TSDB: Time Series Database (abbreviation)</li> <li>VM: Virtual Machine</li> <li>HAT: Hardware Attached on Top (Raspberry Pi expansion board)</li> <li>Tailscale: WireGuard-based mesh VPN service</li> <li>Tailnet: Your private Tailscale network</li> <li>CGNAT: Carrier-Grade NAT (100.x.x.x IP range used by Tailscale)</li> <li>Mesh VPN: Peer-to-peer VPN where devices connect directly</li> </ul>"},{"location":"appendix/references/#version-history","title":"Version History","text":""},{"location":"appendix/references/#documentation-versions","title":"Documentation Versions","text":"<ul> <li>v1.0 (January 2026): Initial documentation</li> <li>Created during internship</li> <li>Covers complete system as deployed</li> </ul>"},{"location":"appendix/references/#contact-support","title":"Contact &amp; Support","text":""},{"location":"appendix/references/#internal-contacts","title":"Internal Contacts","text":"<ul> <li>System Administrator: Kieran Julien - Computer Science Student - 1048363@hr.nl</li> <li>Internship Supervisor: Johan Antonissen - Energietransitielab CoE HRTech - j.antonissen@hr.nl</li> </ul>"},{"location":"appendix/references/#external-support","title":"External Support","text":"<ul> <li>IOTstack Community: Discord, GitHub Issues</li> <li>Professional Support: Consider commercial support for Grafana, InfluxDB if needed</li> </ul>"},{"location":"appendix/references/#license-information","title":"License Information","text":""},{"location":"appendix/references/#open-source-licenses","title":"Open Source Licenses","text":"<ul> <li>Docker: Apache License 2.0</li> <li>Grafana: AGPLv3</li> <li>InfluxDB: MIT License (v1.x)</li> <li>Node-RED: Apache License 2.0</li> <li>Proxmox: AGPLv3</li> <li>Tailscale: BSD 3-Clause License (client), Proprietary (coordination server)</li> </ul> <p>Ensure compliance with all applicable licenses.</p>"},{"location":"appendix/references/#updates-maintenance","title":"Updates &amp; Maintenance","text":""},{"location":"appendix/references/#keeping-this-reference-current","title":"Keeping This Reference Current","text":"<ul> <li>Review quarterly for broken links</li> <li>Update version numbers annually</li> <li>Add new resources as discovered</li> <li>Remove deprecated links</li> </ul> <p>Last Updated: January 2026</p> <p>For the most current information, always check official documentation sites.</p>"},{"location":"architecture/data-flow/","title":"Data Flow","text":"<p>This document details how data moves through the system from sensors to display.</p>"},{"location":"architecture/data-flow/#flow-1-weather-data-collection","title":"Flow 1: Weather Data Collection","text":"<pre><code>flowchart TD\n    Weather[\"Weather Station API&lt;br/&gt;weerlive.nl\"]\n    HTTPReq[\"Node-RED&lt;br/&gt;HTTP Request Node\"]\n    Parse[\"Node-RED&lt;br/&gt;Parse Function&lt;br/&gt;\u2022 Extract temp&lt;br/&gt;\u2022 Extract humidity&lt;br/&gt;\u2022 Calculate air density\"]\n    DB[\"InfluxDB&lt;br/&gt;weather measurement\"]\n\n    Weather --&gt;|HTTPS GET&lt;br/&gt;Every 5 min| HTTPReq\n    HTTPReq --&gt;|JSON Response| Parse\n    Parse --&gt;|InfluxDB Point| DB\n\n    style Weather fill:#81c784,stroke:#43a047,color:#fff\n    style HTTPReq fill:#66bb6a,stroke:#388e3c,color:#fff\n    style Parse fill:#aed581,stroke:#7cb342,color:#fff\n    style DB fill:#42a5f5,stroke:#1e88e5,color:#fff</code></pre>"},{"location":"architecture/data-flow/#weather-data-fields-stored","title":"Weather Data Fields Stored","text":"Field Description Unit temperature_C Air temperature \u00b0C humidity Relative humidity % wind_speed_kmh Wind speed km/h wind_speed_ms Wind speed m/s wind_speed_kn Wind speed knots wind_bft Beaufort scale - wind_direction Cardinal direction text wind_direction_deg Wind direction degrees air_pressure_hPa Atmospheric pressure hPa dew_point_C Dew point \u00b0C air_density Calculated air density kg/m\u00b3 visibility_m Visibility meters summary Weather description text"},{"location":"architecture/data-flow/#air-density-calculation","title":"Air Density Calculation","text":"<pre><code>let P = weather.luchtd * 100;  // hPa \u2192 Pa\nlet R = 287;                    // J/(kg\u00b7K)\nlet T_K = T + 273.15;           // \u00b0C \u2192 K\nlet air_density = P / (R * T_K);\n</code></pre>"},{"location":"architecture/data-flow/#flow-2-turbine-data-collection","title":"Flow 2: Turbine Data Collection","text":"<pre><code>flowchart TD\n    eGauge[\"Wind Turbine eGauge&lt;br/&gt;egauge84432.egaug.es\"]\n    HTTPReq[\"Node-RED&lt;br/&gt;HTTP Request Node\"]\n    XMLParse[\"Node-RED&lt;br/&gt;XML Parser Node\"]\n    Parse[\"Node-RED&lt;br/&gt;Parse Function&lt;br/&gt;\u2022 Sanitize field names&lt;br/&gt;\u2022 Convert values&lt;br/&gt;\u2022 Add prefixes\"]\n    DB[\"InfluxDB&lt;br/&gt;turbine measurement\"]\n\n    eGauge --&gt;|HTTPS GET&lt;br/&gt;Every 30 sec| HTTPReq\n    HTTPReq --&gt;|XML Response| XMLParse\n    XMLParse --&gt;|Parsed Object| Parse\n    Parse --&gt;|InfluxDB Point| DB\n\n    style eGauge fill:#ef5350,stroke:#c62828,color:#fff\n    style HTTPReq fill:#66bb6a,stroke:#388e3c,color:#fff\n    style XMLParse fill:#ba68c8,stroke:#8e24aa,color:#fff\n    style Parse fill:#aed581,stroke:#7cb342,color:#fff\n    style DB fill:#42a5f5,stroke:#1e88e5,color:#fff</code></pre>"},{"location":"architecture/data-flow/#field-name-sanitization","title":"Field Name Sanitization","text":"<p>The parse function converts eGauge field names to snake_case and adds prefixes:</p> Original Prefix New Prefix Example S6_, S5_, S2_ grid_ <code>S6_Power</code> \u2192 <code>grid_s6_power</code> IM_ orientation_ <code>IM_X</code> \u2192 <code>orientation_x</code> VM_ vibration_ <code>VM_Accel</code> \u2192 <code>vibration_accel</code>"},{"location":"architecture/data-flow/#flow-3-image-rendering-delivery","title":"Flow 3: Image Rendering &amp; Delivery","text":"<pre><code>flowchart TD\n    Inject[\"Node-RED&lt;br/&gt;Inject Node&lt;br/&gt;(Every 5 min)\"]\n    HTTPReq[\"Node-RED&lt;br/&gt;HTTP Request to Grafana&lt;br/&gt;Bearer Auth\"]\n    Renderer[\"Grafana Image Renderer&lt;br/&gt;(Headless Chromium)\"]\n    WriteFile[\"Node-RED&lt;br/&gt;Write File&lt;br/&gt;/tmp/001.png\"]\n\n    subgraph PathA[\"Path A: USB Mode\"]\n        SCP[\"Node-RED&lt;br/&gt;SCP to RPi&lt;br/&gt;via SSH\"]\n        Incoming[\"Raspberry Pi&lt;br/&gt;/home/hrtech/incoming_images/\"]\n        RefreshScript[\"Shell Script&lt;br/&gt;refresh_script.sh&lt;br/&gt;\u2022 Unbind USB&lt;br/&gt;\u2022 Resize to 2560x1440&lt;br/&gt;\u2022 Mount drive.bin&lt;br/&gt;\u2022 Copy image&lt;br/&gt;\u2022 Unmount&lt;br/&gt;\u2022 Rebind USB\"]\n        USBStorage[\"USB Mass Storage&lt;br/&gt;(SAMSUNG_E-Paper/)\"]\n        DisplayUSB[\"Samsung E-Ink Display&lt;br/&gt;(USB Mode)\"]\n    end\n\n    Inject --&gt; HTTPReq\n    HTTPReq --&gt; Renderer\n    Renderer --&gt;|PNG Binary| WriteFile\n    WriteFile --&gt; SCP\n\n    SCP --&gt; Incoming\n    Incoming --&gt; RefreshScript\n    RefreshScript --&gt; USBStorage\n    USBStorage --&gt;|USB-C Cable| DisplayUSB\n\n    style Inject fill:#66bb6a,stroke:#388e3c,color:#fff\n    style HTTPReq fill:#66bb6a,stroke:#388e3c,color:#fff\n    style Renderer fill:#ffb74d,stroke:#fb8c00,color:#fff\n    style WriteFile fill:#aed581,stroke:#7cb342,color:#fff\n    style SCP fill:#4dd0e1,stroke:#00acc1,color:#fff\n    style PrepareScript fill:#ba68c8,stroke:#8e24aa,color:#fff\n    style UpdateScript fill:#ba68c8,stroke:#8e24aa,color:#fff\n    style PublishScript fill:#ba68c8,stroke:#8e24aa,color:#fff\n    style DisplayUSB fill:#9575cd,stroke:#5e35b1,color:#fff</code></pre>"},{"location":"architecture/data-flow/#timing-frequencies","title":"Timing &amp; Frequencies","text":"Activity Frequency Node-RED Node Weather data poll Every 5 minutes (300s) loop_weather_data Turbine data poll Every 30 seconds loop_turbine_data Image render &amp; delivery Every 5 minutes (300s) loop_image_renderer"},{"location":"architecture/data-flow/#authentication-tokens","title":"Authentication &amp; Tokens","text":""},{"location":"architecture/data-flow/#grafana-to-image-renderer","title":"Grafana to Image Renderer","text":"<ul> <li>Method: Bearer token authentication</li> <li>Token: <code>glsa_AzyNQ7uhzHzg4UCe5KC8fHUAiJPGjBaz_0d0c9ffb</code></li> <li>Environment Variables:<ul> <li>Grafana: <code>GF_RENDERING_RENDERER_TOKEN</code></li> <li>Renderer: <code>AUTH_TOKEN</code></li> </ul> </li> </ul> <p>Security Note</p> <p>Tokens shown here are examples from your development environment. In production, regenerate and secure these tokens.</p>"},{"location":"architecture/data-flow/#node-red-to-raspberry-pi","title":"Node-RED to Raspberry Pi","text":"<ul> <li>Method: SSH with key-based authentication</li> <li>Network: Tailscale VPN (encrypted mesh network)</li> <li>Command: <code>scp /tmp/001.png &lt;pi-user&gt;@&lt;pi-tailscale-ip&gt;:/home/&lt;pi-user&gt;/incoming_images/incoming.png</code></li> <li>Example: <code>scp /tmp/001.png hrtech@100.64.1.5:/home/hrtech/incoming_images/incoming.png</code></li> <li>Uses Tailscale IP (typically <code>100.x.x.x</code> range)</li> </ul>"},{"location":"architecture/data-flow/#error-handling","title":"Error Handling","text":""},{"location":"architecture/data-flow/#node-red-flow-logic","title":"Node-RED Flow Logic","text":"<ul> <li>Each loop operates independently</li> <li>Failed HTTP requests logged to debug nodes</li> <li>Continue on error to prevent blocking other flows</li> </ul>"},{"location":"architecture/data-flow/#raspberry-pi-scripts","title":"Raspberry Pi Scripts","text":"<ul> <li><code>set -e</code> in scripts: Exit on any error</li> <li>Check if USB gadget is bound before updating</li> <li>Verify mount points exist before operations</li> </ul>"},{"location":"architecture/data-flow/#data-retention","title":"Data Retention","text":"<ul> <li>InfluxDB: Default retention policy (check IOTstack settings)</li> <li>Grafana: Dashboard configured for last 3 hours (<code>from=now-3h&amp;to=now</code>)</li> <li>Images: Only latest image kept on Raspberry Pi and display</li> </ul>"},{"location":"architecture/overview/","title":"System Overview","text":""},{"location":"architecture/overview/#architecture-diagram","title":"Architecture Diagram","text":"<pre><code>graph TB\n    subgraph Proxmox[\"Proxmox Host\"]\n        subgraph VM[\"VM (Ubuntu/Debian)\"]\n            subgraph Docker[\"Docker / IOTstack\"]\n                NodeRED[\"Node-RED\"]\n                InfluxDB[\"InfluxDB\"]\n                Grafana[\"Grafana\"]\n                Renderer[\"Grafana Image Renderer\"]\n\n                NodeRED --&gt; InfluxDB\n                InfluxDB --&gt; Grafana\n                Grafana --&gt; Renderer\n            end\n        end\n    end\n\n    Docker --&gt; RPi[\"Raspberry Pi&lt;br/&gt;(USB Gadget)\"]\n    RPi --&gt;|USB-C| Display[\"Samsung E-Ink Display&lt;br/&gt;(USB Mode)\"]\n\n    style Proxmox fill:#546e7a,stroke:#37474f,color:#fff\n    style VM fill:#78909c,stroke:#546e7a,color:#fff\n    style Docker fill:#90a4ae,stroke:#607d8b,color:#fff\n    style NodeRED fill:#66bb6a,stroke:#43a047,color:#fff\n    style InfluxDB fill:#42a5f5,stroke:#1e88e5,color:#fff\n    style Grafana fill:#ff7043,stroke:#e64a19,color:#fff\n    style Renderer fill:#ffa726,stroke:#fb8c00,color:#fff\n    style RPi fill:#ab47bc,stroke:#8e24aa,color:#fff\n    style Display fill:#7e57c2,stroke:#5e35b1,color:#fff</code></pre>"},{"location":"architecture/overview/#component-roles","title":"Component Roles","text":""},{"location":"architecture/overview/#proxmox-host","title":"Proxmox Host","text":"<ul> <li>Purpose: Virtualization platform</li> <li>Function: Hosts the VM running the entire IoT stack</li> <li>Benefits: Easy backup, snapshots, resource management</li> </ul>"},{"location":"architecture/overview/#virtual-machine","title":"Virtual Machine","text":"<ul> <li>OS: Linux (Ubuntu/Debian recommended by IOTstack)</li> <li>Purpose: Runs Docker and all services</li> <li>Resources: CPU, RAM, storage allocated from Proxmox</li> </ul>"},{"location":"architecture/overview/#iotstack-services","title":"IOTstack Services","text":""},{"location":"architecture/overview/#node-red","title":"Node-RED","text":"<ul> <li>Role: Orchestration and automation engine</li> <li>Functions:<ul> <li>Polls weather API every 5 minutes</li> <li>Polls eGauge (turbine sensors) every 30 seconds</li> <li>Requests dashboard images every 5 minutes</li> <li>Manages image delivery to Raspberry Pi via SCP</li> </ul> </li> </ul>"},{"location":"architecture/overview/#influxdb-10","title":"InfluxDB 1.0","text":"<ul> <li>Role: Time-series database</li> <li>Functions:<ul> <li>Stores weather data (temperature, humidity, wind, pressure)</li> <li>Stores turbine sensor data (power, vibration, orientation)</li> <li>Optimized for time-based queries</li> </ul> </li> </ul>"},{"location":"architecture/overview/#grafana","title":"Grafana","text":"<ul> <li>Role: Visualization and dashboard platform</li> <li>Functions:<ul> <li>Displays real-time turbine and weather data</li> <li>Configured with custom renderer integration</li> <li>Serves dashboard to image renderer</li> </ul> </li> </ul>"},{"location":"architecture/overview/#grafana-image-renderer","title":"Grafana Image Renderer","text":"<ul> <li>Role: Headless browser for dashboard screenshots</li> <li>Functions:<ul> <li>Renders Grafana dashboards as PNG images</li> <li>Runs outside IOTstack but in Docker</li> <li>Authenticated via bearer token</li> </ul> </li> </ul>"},{"location":"architecture/overview/#portainer","title":"Portainer","text":"<ul> <li>Role: Docker management UI</li> <li>Functions:<ul> <li>Monitor container status</li> <li>View logs</li> <li>Manage stack updates</li> </ul> </li> </ul>"},{"location":"architecture/overview/#raspberry-pi","title":"Raspberry Pi","text":"<ul> <li>Role: USB mass storage bridge</li> <li>Mode: USB gadget mode (mass storage)</li> <li>Functions:<ul> <li>Receives images via SCP from Node-RED</li> <li>Processes and formats images for e-ink display</li> <li>Exposes images via USB mass storage to display</li> </ul> </li> <li>Scripts: Automated image handling and refresh</li> </ul>"},{"location":"architecture/overview/#samsung-em32dx-e-ink-display","title":"Samsung EM32DX E-Ink Display","text":"<ul> <li>Technology: 32\" E-Paper display</li> <li>Power: PoE+</li> <li>Display Mode: USB mass storage - reads images from Raspberry Pi</li> </ul>"},{"location":"architecture/overview/#network-topology","title":"Network Topology","text":"<pre><code>graph TB\n    Internet((Internet))\n    Tailscale[Tailscale Network&lt;br/&gt;Encrypted Mesh VPN]\n\n    subgraph Remote[Remote Location - IOTstack]\n        ProxmoxVM[Proxmox VM&lt;br/&gt;Tailscale IP: 100.x.x.x&lt;br/&gt;IOTstack]\n    end\n\n    subgraph TurbineLocation[Turbine Location]\n        Modem[Modem/Router&lt;br/&gt;gateway_ip&lt;br/&gt;Montreal Solutions]\n        Switch[PoE+ Switch]\n        RPi[Raspberry Pi&lt;br/&gt;Tailscale IP: 100.x.x.x&lt;br/&gt;PoE+ HAT]\n        Display[Samsung E-Ink Display&lt;br/&gt;display_ip&lt;br/&gt;PoE+]\n    end\n\n    ProxmoxVM -.-&gt;|Tailscale VPN| Tailscale\n    Tailscale -.-&gt;|Tailscale VPN| RPi\n    Modem --&gt; Switch\n    Switch --&gt;|Ethernet PoE+| RPi\n    Switch --&gt;|Ethernet PoE+| Display\n    RPi -.-&gt;|USB-C| Display\n    ProxmoxVM -.-&gt;|Tailscale: Data &amp; Images| RPi\n\n    style Internet fill:#ffd54f,stroke:#f9a825,color:#000\n    style Tailscale fill:#9c27b0,stroke:#6a1b9a,color:#fff\n    style Remote fill:#bbdefb,stroke:#1976d2,color:#000\n    style TurbineLocation fill:#fff3e0,stroke:#f57c00,color:#000\n    style Modem fill:#81c784,stroke:#43a047,color:#fff\n    style Switch fill:#64b5f6,stroke:#1e88e5,color:#fff\n    style ProxmoxVM fill:#ff8a65,stroke:#e64a19,color:#fff\n    style RPi fill:#ba68c8,stroke:#8e24aa,color:#fff\n    style Display fill:#9575cd,stroke:#5e35b1,color:#fff</code></pre>"},{"location":"architecture/overview/#data-sources","title":"Data Sources","text":""},{"location":"architecture/overview/#weather-station-api","title":"Weather Station API","text":"<ul> <li>URL: <code>https://weerlive.nl/api/weerlive_api_v2.php</code></li> <li>Location: 51.89908, 4.42348</li> <li>Data: Temperature, humidity, wind speed/direction, air pressure, visibility</li> <li>Frequency: Every 5 minutes</li> </ul>"},{"location":"architecture/overview/#egauge-turbine-sensors","title":"eGauge (Turbine Sensors)","text":"<ul> <li>URL: <code>https://egauge84432.egaug.es/cgi-bin/egauge?inst</code></li> <li>Format: XML</li> <li>Data: Power output, vibration sensors, orientation sensors</li> <li>Frequency: Every 30 seconds</li> </ul>"},{"location":"architecture/overview/#image-delivery-flow","title":"Image Delivery Flow","text":"<ol> <li>Node-RED triggers image request (every 5 minutes)</li> <li>Grafana Image Renderer renders dashboard at 1536px width</li> <li>Image returned as binary data to Node-RED</li> <li>Node-RED writes to <code>/tmp/001.png</code></li> <li>Node-RED transfers image via SCP to Raspberry Pi through Tailscale VPN</li> <li>Raspberry Pi shell scripts process the image</li> <li>Image is exposed via USB mass storage to the display</li> <li>Display refreshes and shows the new image</li> </ol>"},{"location":"architecture/overview/#network-security","title":"Network Security","text":""},{"location":"architecture/overview/#tailscale-vpn","title":"Tailscale VPN","text":"<p>All communication between the Proxmox VM and Raspberry Pi happens through Tailscale's encrypted mesh network:</p> <ul> <li>Zero-config mesh VPN - Tailscale automatically creates secure peer-to-peer connections</li> <li>No port forwarding required - Works through NATs and firewalls without manual configuration</li> <li>WireGuard-based encryption - Uses the WireGuard protocol under the hood for secure tunneling</li> <li>Automatic IP assignment - Each device gets a persistent Tailscale IP (100.x.x.x range)</li> <li>SSH never exposed publicly - SSH port 22 remains closed to the internet, accessible only via Tailscale</li> <li>Easy multi-device management - Simple web-based admin panel for device management</li> </ul> <p>Setup: Both the VM and Raspberry Pi run the Tailscale client and authenticate to your Tailscale network (tailnet). Once connected, they can communicate directly using their assigned Tailscale IPs (e.g., VM at <code>100.64.1.10</code>, Pi at <code>100.64.1.5</code>).</p> <p>Network Flow: <code>Node-RED \u2192 Tailscale VPN \u2192 Raspberry Pi</code></p> <p>See Node-RED Tailscale Configuration for setup details.</p>"},{"location":"architecture/overview/#key-design-decisions","title":"Key Design Decisions","text":"<ul> <li>Why InfluxDB 1.0?: IOTstack default, simpler than 2.0 for this use case</li> <li>Why separate image renderer?: Not included in IOTstack by default, requires custom token auth</li> <li>Why Raspberry Pi bridge?: Samsung display USB mode requires specific file structure</li> <li>Why dual display modes?: Redundancy and flexibility for the end user</li> </ul>"},{"location":"hardware/display/","title":"Samsung E-Ink Display","text":"<p>Configuration and usage of the Samsung EM32DX 32\" E-Paper display.</p>"},{"location":"hardware/display/#display-specifications","title":"Display Specifications","text":"<ul> <li>Model: Samsung EM32DX</li> <li>Size: 32 inches diagonal</li> <li>Technology: E-Paper (E-Ink)</li> <li>Resolution: 2560 x 1440 pixels</li> <li>Orientation: Landscape</li> <li>Power: PoE+ (802.3at)</li> <li>Connectivity:</li> <li>Ethernet (PoE+)</li> <li>USB-C (data/mass storage)</li> <li>Wi-Fi (optional)</li> </ul>"},{"location":"hardware/display/#display-modes","title":"Display Modes","text":"<p>The display supports two methods for showing content:</p>"},{"location":"hardware/display/#1-usb-mass-storage-mode","title":"1. USB Mass Storage Mode","text":"<p>How it works:</p> <ul> <li>Raspberry Pi in USB gadget mode appears as USB drive</li> <li>Display reads images from <code>SAMSUNG_E-Paper</code> folder</li> <li>Supports multiple images (001.png, 002.png, etc.)</li> <li>Display cycles through images</li> </ul> <p>Advantages:</p> <ul> <li>Simple setup</li> <li>No network configuration needed</li> <li>Reliable (direct USB connection)</li> </ul> <p>Disadvantages:</p> <ul> <li>Requires physical USB connection</li> <li>Manual refresh triggered by Pi scripts</li> </ul> <p>Configuration:</p> <p>See Raspberry Pi Gadget Mode.</p> <p>Note: This is the only display method used in this project. USB mass storage provides a reliable, simple solution without requiring custom app development.</p>"},{"location":"hardware/display/#initial-setup","title":"Initial Setup","text":""},{"location":"hardware/display/#power-on","title":"Power On","text":"<ol> <li>Connect PoE+ Ethernet cable</li> <li>Display powers on automatically</li> <li>Wait for boot (30-60 seconds)</li> </ol>"},{"location":"hardware/display/#access-settings","title":"Access Settings","text":"<ol> <li>Press menu button on display (or remote)</li> <li>Navigate to Settings</li> <li>Configure network and USB settings</li> </ol>"},{"location":"hardware/display/#network-configuration","title":"Network Configuration","text":""},{"location":"hardware/display/#wired-poe","title":"Wired (PoE+)","text":"<ol> <li>Settings \u2192 Network \u2192 Wired</li> <li>Set static IP or DHCP</li> <li>Test connection: ping display IP from VM</li> </ol>"},{"location":"hardware/display/#wireless-optional","title":"Wireless (Optional)","text":"<ol> <li>Settings \u2192 Network \u2192 Wi-Fi</li> <li>Select SSID</li> <li>Enter password</li> <li>Save</li> </ol>"},{"location":"hardware/display/#usb-settings","title":"USB Settings","text":"<ol> <li>Settings \u2192 USB</li> <li>Enable USB Mass Storage mode</li> <li>Set auto-detect to On</li> <li>Save</li> </ol>"},{"location":"hardware/display/#image-requirements","title":"Image Requirements","text":""},{"location":"hardware/display/#format","title":"Format","text":"<ul> <li>File Type: PNG (preferred) or JPEG</li> <li>Color: Grayscale or RGB (will be converted to grayscale)</li> <li>Bit Depth: 8-bit or higher</li> </ul>"},{"location":"hardware/display/#resolution","title":"Resolution","text":"<ul> <li>Display Native: 2560 x 1440 pixels</li> <li>Aspect Ratio: 16:9 (landscape)</li> </ul> <p>Recommendations:</p> <ul> <li>Match native resolution for best quality</li> <li>Use <code>refresh_script.sh</code> to auto-resize (see Scripts)</li> </ul>"},{"location":"hardware/display/#file-size","title":"File Size","text":"<ul> <li>Recommended: &lt;2 MB per image</li> <li>Maximum: Display-dependent (check specs)</li> </ul>"},{"location":"hardware/display/#naming-convention","title":"Naming Convention","text":"<p>For USB mode, use sequential naming:</p> <ul> <li><code>001.png</code></li> <li><code>002.png</code></li> <li><code>003.png</code></li> </ul> <p>Display reads in numerical order.</p>"},{"location":"hardware/display/#display-configuration","title":"Display Configuration","text":""},{"location":"hardware/display/#refresh-settings","title":"Refresh Settings","text":"<p>E-Ink displays have different refresh modes:</p>"},{"location":"hardware/display/#full-refresh","title":"Full Refresh","text":"<ul> <li>Speed: Slow (1-2 seconds)</li> <li>Quality: High (no ghosting)</li> <li>Use: For detailed images, graphs</li> </ul>"},{"location":"hardware/display/#partial-refresh","title":"Partial Refresh","text":"<ul> <li>Speed: Fast (0.5 seconds)</li> <li>Quality: May show ghosting</li> <li>Use: For frequent updates, text</li> </ul> <p>Configure:</p> <ol> <li>Settings \u2192 Display \u2192 Refresh Mode</li> <li>Choose Full or Partial</li> <li>Save</li> </ol>"},{"location":"hardware/display/#brightness","title":"Brightness","text":"<p>E-Ink uses ambient light (no backlight).</p> <p>Optional front light:</p> <ol> <li>Settings \u2192 Display \u2192 Front Light</li> <li>Adjust intensity</li> <li>Save</li> </ol>"},{"location":"hardware/display/#auto-rotate","title":"Auto Rotate","text":"<ol> <li>Settings \u2192 Display \u2192 Orientation</li> <li>Select Portrait or Landscape</li> <li>Save</li> </ol>"},{"location":"hardware/display/#slideshow-settings-usb-mode","title":"Slideshow Settings (USB Mode)","text":""},{"location":"hardware/display/#configure-slideshow","title":"Configure Slideshow","text":"<ol> <li>Settings \u2192 USB \u2192 Slideshow</li> <li>Interval: Set time between images (e.g., 300 seconds)</li> <li>Loop: Enable to repeat</li> <li>Transition: Select fade or instant</li> <li>Save</li> </ol>"},{"location":"hardware/display/#manual-advance","title":"Manual Advance","text":"<p>Use remote or buttons to manually navigate images.</p>"},{"location":"hardware/display/#connecting-to-raspberry-pi","title":"Connecting to Raspberry Pi","text":""},{"location":"hardware/display/#physical-connection","title":"Physical Connection","text":"<ol> <li>USB-C cable from Raspberry Pi to display</li> <li>Ensure Pi is powered and in gadget mode</li> <li>Display should auto-detect USB drive</li> </ol>"},{"location":"hardware/display/#verify-connection","title":"Verify Connection","text":"<ol> <li>On display, navigate to USB source</li> <li>Should show \"EInkUSB\" or similar device name</li> <li>Open device to see <code>SAMSUNG_E-Paper</code> folder</li> <li>Images should be listed</li> </ol>"},{"location":"hardware/display/#troubleshooting-connection","title":"Troubleshooting Connection","text":"<p>If display doesn't detect USB:</p> <ol> <li>Check cable (must support data)</li> <li>Verify Pi gadget mode active:</li> </ol> <pre><code>cat /sys/kernel/config/usb_gadget/EInkGadget/UDC\n</code></pre> <p>Should show UDC name, not empty.</p> <ol> <li>Restart both devices</li> <li>Check display USB settings (must be enabled)</li> </ol>"},{"location":"hardware/display/#image-quality-optimization","title":"Image Quality Optimization","text":""},{"location":"hardware/display/#for-e-ink-displays","title":"For E-Ink Displays","text":"<p>E-Ink is different from LCD:</p> <ul> <li>High Contrast: Use bold text, clear graphics</li> <li>Grayscale: Color is converted to gray</li> <li>No Animation: Refresh rate is slow</li> <li>Power Efficient: Image persists without power</li> </ul>"},{"location":"hardware/display/#grafana-dashboard-design","title":"Grafana Dashboard Design","text":"<p>For best results:</p> <ol> <li>High Contrast Theme: Dark background, light text (or vice versa)</li> <li>Large Text: Minimum 14pt font</li> <li>Bold Lines: Thick graph lines (2-3px)</li> <li>Limit Colors: Use grayscale-friendly colors</li> <li>Avoid Gradients: Solid fills preferred</li> </ol>"},{"location":"hardware/display/#testing","title":"Testing","text":"<p>Render and view on actual display to verify readability.</p>"},{"location":"hardware/display/#maintenance","title":"Maintenance","text":""},{"location":"hardware/display/#cleaning","title":"Cleaning","text":"<ul> <li>Screen: Use soft, dry microfiber cloth</li> <li>Avoid: Liquid cleaners, abrasives</li> <li>Frequency: As needed (E-Ink accumulates less dust)</li> </ul>"},{"location":"hardware/display/#ghosting-prevention","title":"Ghosting Prevention","text":"<p>E-Ink can show ghosting (image retention).</p> <p>Prevention:</p> <ul> <li>Perform full refresh periodically</li> <li>Vary content to avoid static images</li> <li>Use display's \"Screen Refresh\" function monthly</li> </ul> <p>To Refresh:</p> <ol> <li>Settings \u2192 Display \u2192 Screen Refresh</li> <li>Display will flash black/white several times</li> <li>Clears ghosting</li> </ol>"},{"location":"hardware/display/#firmware-updates","title":"Firmware Updates","text":"<p>Check for updates:</p> <ol> <li>Settings \u2192 System \u2192 About</li> <li>Check for updates</li> <li>Download and install if available</li> </ol> <p>Or visit Samsung support website.</p>"},{"location":"hardware/display/#power-management","title":"Power Management","text":""},{"location":"hardware/display/#sleep-mode","title":"Sleep Mode","text":"<ol> <li>Settings \u2192 Power \u2192 Sleep Timer</li> <li>Set inactivity timeout (e.g., Never for always-on)</li> <li>Save</li> </ol>"},{"location":"hardware/display/#auto-power-onoff","title":"Auto Power On/Off","text":"<ol> <li>Settings \u2192 Power \u2192 Schedule</li> <li>Set on/off times</li> <li>Save</li> </ol> <p>For 24/7 monitoring, disable auto-off.</p>"},{"location":"hardware/display/#troubleshooting","title":"Troubleshooting","text":""},{"location":"hardware/display/#display-not-powering-on","title":"Display Not Powering On","text":"<ol> <li>Check PoE+ connection</li> <li>Verify switch provides PoE+ (not just PoE)</li> <li>Try different switch port</li> <li>Check cable</li> </ol> <p>See PoE Setup for more.</p>"},{"location":"hardware/display/#image-not-updating","title":"Image Not Updating","text":""},{"location":"hardware/display/#usb-mode","title":"USB Mode","text":"<ol> <li>Verify Pi is connected (check USB cable)</li> <li>Check images exist in <code>SAMSUNG_E-Paper</code> folder:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;rpi_ip&gt; 'ls -lh /mnt/usb_drive/SAMSUNG_E-Paper/'\n</code></pre> <ol> <li>Trigger manual refresh on display</li> <li>Check display slideshow settings</li> </ol>"},{"location":"hardware/display/#display-frozen","title":"Display Frozen","text":"<ol> <li>Unplug PoE cable</li> <li>Wait 30 seconds</li> <li>Reconnect</li> <li>Display should reboot</li> </ol>"},{"location":"hardware/display/#poor-image-quality","title":"Poor Image Quality","text":"<ol> <li>Check image resolution matches display (2560x1440)</li> <li>Use full refresh mode</li> <li>Increase text size and line thickness</li> <li>Verify PNG format (not compressed JPEG)</li> </ol>"},{"location":"hardware/display/#advanced-features","title":"Advanced Features","text":""},{"location":"hardware/display/#remote-management","title":"Remote Management","text":"<p>If display supports:</p> <ul> <li>Web Interface: Access via <code>http://&lt;display-ip&gt;</code></li> <li>SNMP: Monitor status via SNMP</li> <li>Samsung MagicInfo: Enterprise content management</li> </ul> <p>Consult display manual for details.</p>"},{"location":"hardware/display/#content-management","title":"Content Management","text":"<p>For more complex content:</p> <ul> <li>Use Samsung MagicInfo software</li> <li>Schedule content playback</li> <li>Manage multiple displays</li> </ul>"},{"location":"hardware/display/#security","title":"Security","text":""},{"location":"hardware/display/#display-settings-password","title":"Display Settings Password","text":"<ol> <li>Settings \u2192 Security \u2192 Set Password</li> <li>Enter and confirm password</li> <li>Save</li> </ol> <p>Prevents unauthorized changes.</p>"},{"location":"hardware/display/#network-security","title":"Network Security","text":"<ul> <li>Use VLAN to isolate display (if using managed switch)</li> <li>Firewall rules to limit access</li> <li>Disable unused services (Wi-Fi if not needed)</li> </ul>"},{"location":"hardware/display/#specifications-reference","title":"Specifications Reference","text":"Feature Specification Display Size 32\" diagonal Resolution 2560 x 1440 pixels Aspect Ratio 16:9 (landscape) Technology E-Paper (E-Ink) Brightness Ambient light reflective Viewing Angle 180\u00b0 (E-Ink characteristic) Power PoE+ (802.3at), &lt;25W Refresh Rate 1-2 seconds (full refresh) Operating Temp 0-40\u00b0C Humidity 10-80% RH (non-condensing) MTBF Check manufacturer specs"},{"location":"hardware/display/#support-resources","title":"Support Resources","text":"<ul> <li>Samsung Support: https://www.samsung.com/support/</li> <li>User Manual: Consult included documentation</li> </ul>"},{"location":"hardware/network/","title":"Network Topology","text":"<p>This document describes the physical and logical network setup.</p>"},{"location":"hardware/network/#network-diagram","title":"Network Diagram","text":"<pre><code>graph TB\n    Internet((Internet))\n    Tailscale[Tailscale Network&lt;br/&gt;Encrypted Mesh VPN]\n\n    subgraph Remote[Remote Location - IOTstack]\n        ProxmoxVM[Proxmox VM&lt;br/&gt;Tailscale: 100.x.x.x&lt;br/&gt;IOTstack]\n    end\n\n    subgraph TurbineLocation[Turbine Location]\n        Modem[Modem/Router&lt;br/&gt;gateway_ip&lt;br/&gt;Montreal Solutions]\n        Switch[PoE+ Switch]\n        RPi[Raspberry Pi&lt;br/&gt;Tailscale: 100.x.x.x&lt;br/&gt;PoE+ HAT]\n        Display[Samsung E-Ink Display&lt;br/&gt;display_ip&lt;br/&gt;PoE+]\n    end\n\n    ProxmoxVM -.-&gt;|Tailscale VPN| Tailscale\n    Tailscale -.-&gt;|Tailscale VPN| RPi\n    Modem --&gt; Switch\n    Switch --&gt;|Ethernet PoE+| RPi\n    Switch --&gt;|Ethernet PoE+| Display\n    RPi -.-&gt;|USB-C| Display\n    ProxmoxVM -.-&gt;|Tailscale: SSH/SCP| RPi\n\n    style Internet fill:#ffd54f,stroke:#f9a825,color:#000\n    style Tailscale fill:#9c27b0,stroke:#6a1b9a,color:#fff\n    style Remote fill:#bbdefb,stroke:#1976d2,color:#000\n    style TurbineLocation fill:#fff3e0,stroke:#f57c00,color:#000\n    style Modem fill:#81c784,stroke:#43a047,color:#fff\n    style Switch fill:#64b5f6,stroke:#1e88e5,color:#fff\n    style ProxmoxVM fill:#ff8a65,stroke:#e64a19,color:#fff\n    style RPi fill:#ba68c8,stroke:#8e24aa,color:#fff\n    style Display fill:#9575cd,stroke:#5e35b1,color:#fff</code></pre>"},{"location":"hardware/network/#ip-addresses","title":"IP Addresses","text":""},{"location":"hardware/network/#remote-location-proxmox-host","title":"Remote Location (Proxmox Host)","text":"Device IP Address Connection Notes Internet Modem <code>&lt;remote_gateway_ip&gt;</code> - Gateway at Proxmox location Proxmox VM (IOTstack) <code>&lt;vm_ip&gt;</code> (e.g., 192.168.x.164) Ethernet to modem Static IP recommended"},{"location":"hardware/network/#local-location-display-site","title":"Local Location (Display Site)","text":"Device IP Address Connection Notes Internet Modem <code>&lt;local_gateway_ip&gt;</code> (default: .1) - Montreal Solutions, DHCP server Raspberry Pi <code>&lt;rpi_ip&gt;</code> (e.g., 192.168.178.148) PoE+ to switch Static IP required Samsung E-Ink Display <code>&lt;display_ip&gt;</code> PoE+ to switch Check display settings PoE+ Switch <code>&lt;switch_ip&gt;</code> Ethernet to modem May have management IP"},{"location":"hardware/network/#network-segments","title":"Network Segments","text":""},{"location":"hardware/network/#remote-location-proxmox-host_1","title":"Remote Location (Proxmox Host)","text":"<p>Proxmox VM on its own network segment:</p> <ul> <li>Gateway: <code>&lt;remote_gateway_ip&gt;</code></li> <li>Subnet: Varies by location</li> <li>DNS: Provided by ISP or custom</li> </ul>"},{"location":"hardware/network/#local-location-display-site_1","title":"Local Location (Display Site)","text":"<p>Raspberry Pi and Display on <code>192.168.178.0/24</code> network:</p> <ul> <li>Gateway: <code>192.168.178.1</code> (Montreal Solutions modem)</li> <li>Subnet Mask: <code>255.255.255.0</code></li> <li>DNS: Provided by modem (or 8.8.8.8)</li> </ul> <p>Remote Communication via Tailscale VPN</p> <p>The Proxmox VM communicates with the Raspberry Pi over the internet via Tailscale's encrypted mesh network:</p> <ul> <li>Zero-config mesh VPN - Both devices connect to your Tailscale network (tailnet)</li> <li>VM Tailscale IP: e.g., <code>100.64.1.10</code> - Persistent IP assigned by Tailscale</li> <li>Raspberry Pi Tailscale IP: e.g., <code>100.64.1.5</code> - Persistent IP assigned by Tailscale</li> <li>No port forwarding required - Tailscale handles NAT traversal automatically</li> </ul> <p>All SSH/SCP traffic is encrypted through Tailscale's WireGuard-based tunnel. SSH port 22 is never exposed publicly - only accessible through the Tailscale network. Both devices initiate outbound connections to Tailscale's coordination server, so no inbound ports or firewall rules are needed on either side.</p> <p>See Node-RED Tailscale Configuration for setup details.</p>"},{"location":"hardware/network/#connection-details","title":"Connection Details","text":""},{"location":"hardware/network/#proxmox-host-vm","title":"Proxmox Host / VM","text":"<ul> <li>Location: Remote location (separate from display site)</li> <li>Connection: Ethernet to local network</li> <li>Network Mode: Bridged (vmbr0 in Proxmox) or NAT</li> <li>IP Configuration: DHCP or static</li> <li>VPN: Tailscale client (Docker or native)</li> <li>Required Ports: None (only outbound HTTPS to Tailscale servers)</li> <li>Services (internal access only):</li> <li>3000 (Grafana)</li> <li>8086 (InfluxDB)</li> <li>1880 (Node-RED)</li> <li>9000 (Portainer)</li> <li>8081 (Grafana Image Renderer)</li> </ul>"},{"location":"hardware/network/#raspberry-pi","title":"Raspberry Pi","text":"<ul> <li>Location: Local location (at display site)</li> <li>Connection: PoE+ HAT to PoE+ switch</li> <li>Power: Supplied via PoE (48V DC, stepped down)</li> <li>IP Configuration: Static (local network), Tailscale IP assigned automatically</li> <li>Tailscale Client: Running on Pi for VM communication</li> <li>Remote Access: Via Tailscale VPN from VM</li> <li>USB Connection: USB-C to display (data + mass storage)</li> <li>Required Ports: None (Tailscale handles connectivity)</li> <li>Services:</li> <li>22/TCP - SSH (only accessible via Tailscale, not publicly exposed)</li> </ul>"},{"location":"hardware/network/#samsung-e-ink-display","title":"Samsung E-Ink Display","text":"<ul> <li>Location: Local location (at display site)</li> <li>Connection: PoE+ to switch</li> <li>Power: PoE+ (802.3at, up to 25W)</li> <li>IP Configuration: DHCP or static</li> <li>USB Connection: USB-C to Raspberry Pi</li> <li>Display Mode: USB Mass Storage (reads images from Pi via USB)</li> </ul>"},{"location":"hardware/network/#poe-switch","title":"PoE+ Switch","text":""},{"location":"hardware/network/#requirements","title":"Requirements","text":"<ul> <li>Standard: 802.3at (PoE+)</li> <li>Power Budget: Minimum 30W per port</li> <li>Display: ~20-25W</li> <li>Raspberry Pi: ~5-8W (with HAT)</li> </ul>"},{"location":"hardware/network/#ports-used","title":"Ports Used","text":"<ul> <li>Port 1: To modem (uplink)</li> <li>Port 2: To Raspberry Pi (PoE+)</li> <li>Port 3: To Samsung Display (PoE+)</li> <li>Additional ports available for expansion</li> </ul>"},{"location":"hardware/network/#modem-configuration","title":"Modem Configuration","text":""},{"location":"hardware/network/#local-modem-display-site","title":"Local Modem (Display Site)","text":"<p>Managed by Montreal Solutions. Configuration required:</p> <ul> <li>No port forwarding required - Tailscale handles all VPN connectivity automatically</li> <li>Static IP or DHCP reservation for Raspberry Pi (recommended for easier management)</li> <li>No firewall changes needed - Pi only makes outbound connections to Tailscale servers</li> <li>Optional: DHCP reservation for Display</li> <li>Optional: WiFi configuration</li> </ul> <p>Tailscale Advantage</p> <p>Tailscale eliminates the need to configure port forwarding, firewall rules, or involve network administrators. Both the VM and Raspberry Pi make outbound HTTPS connections to Tailscale's coordination servers, so no inbound ports need to be opened on either network.</p>"},{"location":"hardware/network/#vm-network-proxmox-location","title":"VM Network (Proxmox Location)","text":"<p>Configuration at VM location:</p> <ul> <li>No port forwarding required - VM only makes outbound connections</li> <li>No firewall changes needed - Outbound HTTPS traffic typically allowed</li> <li>VM network configuration: Managed by network admin or Proxmox host</li> <li>Advantage: No need to involve network admin for VPN setup</li> </ul>"},{"location":"hardware/network/#static-ip-configuration","title":"Static IP Configuration","text":""},{"location":"hardware/network/#on-proxmox-vm","title":"On Proxmox VM","text":"<p>See VM Configuration.</p>"},{"location":"hardware/network/#on-raspberry-pi","title":"On Raspberry Pi","text":"<p>Edit <code>/etc/dhcpcd.conf</code>:</p> <pre><code>sudo nano /etc/dhcpcd.conf\n</code></pre> <p>Add at the end:</p> <pre><code>interface eth0\nstatic ip_address=&lt;rpi_ip&gt;/24\nstatic routers=&lt;gateway_ip&gt;\nstatic domain_name_servers=8.8.8.8 8.8.4.4\n</code></pre> <p>Restart:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"hardware/network/#on-samsung-display","title":"On Samsung Display","text":"<p>Access display network settings:</p> <ol> <li>Open Samsung Epaper app</li> <li>Select the configured screen</li> <li>Navigate to Network</li> <li>Set static IP or use DHCP reservation on modem</li> </ol>"},{"location":"hardware/network/#firewall-considerations","title":"Firewall Considerations","text":""},{"location":"hardware/network/#proxmox-host","title":"Proxmox Host","text":"<p>If firewall enabled, allow:</p> <ul> <li>Inbound: SSH (22), Web UI (8006)</li> <li>Outbound: All</li> </ul>"},{"location":"hardware/network/#vm-iotstack","title":"VM (IOTstack)","text":"<p>Allow inbound from LAN:</p> <ul> <li>3000, 8086, 1880, 9000, 8081</li> </ul> <p>Example UFW rules:</p> <pre><code>sudo ufw allow from 192.168.178.0/24 to any port 3000\nsudo ufw allow from 192.168.178.0/24 to any port 8086\nsudo ufw allow from 192.168.178.0/24 to any port 1880\nsudo ufw enable\n</code></pre>"},{"location":"hardware/network/#raspberry-pi_1","title":"Raspberry Pi","text":"<p>Allow SSH only from Tailscale network:</p> <pre><code># Allow SSH only through Tailscale interface\nsudo ufw allow in on tailscale0 to any port 22\n\n# Deny SSH from everywhere else\nsudo ufw deny 22/tcp\n\n# Enable firewall\nsudo ufw enable\n</code></pre> <p>This configuration allows SSH only through the Tailscale interface, not from the public internet or local network.</p>"},{"location":"hardware/network/#dns-configuration","title":"DNS Configuration","text":""},{"location":"hardware/network/#internal-dns","title":"Internal DNS","text":"<p>No internal DNS server. Devices use modem as DNS or public DNS:</p> <ul> <li><code>8.8.8.8</code> (Google)</li> <li><code>8.8.4.4</code> (Google)</li> <li><code>1.1.1.1</code> (Cloudflare)</li> </ul>"},{"location":"hardware/network/#docker-internal-dns","title":"Docker Internal DNS","text":"<p>Docker containers use internal DNS:</p> <ul> <li>Grafana reaches InfluxDB via hostname <code>influxdb</code></li> <li>Node-RED reaches InfluxDB via hostname <code>influxdb</code></li> </ul>"},{"location":"hardware/network/#network-testing","title":"Network Testing","text":""},{"location":"hardware/network/#connectivity-tests","title":"Connectivity Tests","text":"<p>From VM to Pi (via Tailscale VPN):</p> <pre><code># Verify Tailscale is connected\ntailscale status  # or: docker exec tailscale tailscale status\n\n# Test Tailscale connectivity\nping &lt;pi_tailscale_ip&gt;  # e.g., ping 100.64.1.5\n\n# SSH through Tailscale\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;  # e.g., ssh hrtech@100.64.1.5\n</code></pre> <p>From Pi to internet:</p> <pre><code>ping 8.8.8.8\n</code></pre> <p>From Pi to Display (local network):</p> <pre><code>ping &lt;display_ip&gt;\n</code></pre>"},{"location":"hardware/network/#service-tests","title":"Service Tests","text":"<p>Test Grafana from Proxmox host:</p> <pre><code>curl http://localhost:3000\n</code></pre> <p>Test SSH to Pi from VM (through Tailscale):</p> <pre><code># Verify Tailscale is connected first\ntailscale status  # or: docker exec tailscale tailscale status\n\n# Test SSH through Tailscale\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;  # e.g., ssh hrtech@100.64.1.5\n</code></pre>"},{"location":"hardware/network/#bandwidth-requirements","title":"Bandwidth Requirements","text":""},{"location":"hardware/network/#normal-operation","title":"Normal Operation","text":"<ul> <li>Weather API: ~1 KB every 5 min (from Proxmox VM)</li> <li>eGauge API: ~2 KB every 30 sec (from Proxmox VM)</li> <li>Image transfer to Pi: ~500 KB every 5 min (VM \u2192 Pi over internet)</li> <li>Total bandwidth (VM \u2192 Pi): ~1 MB every 5 minutes</li> <li>Required: Stable internet at both locations (minimum 1 Mbps upload/download)</li> </ul>"},{"location":"hardware/network/#latency","title":"Latency","text":"<p>Not critical for this application. Can tolerate 100-500ms latency between locations.</p>"},{"location":"hardware/network/#troubleshooting","title":"Troubleshooting","text":""},{"location":"hardware/network/#device-cant-reach-internet","title":"Device Can't Reach Internet","text":"<ol> <li>Check gateway: <code>ping 192.168.178.1</code></li> <li>Check DNS: <code>nslookup google.com</code></li> <li>Check modem uplink</li> </ol>"},{"location":"hardware/network/#device-cant-reach-other-devices-on-lan","title":"Device Can't Reach Other Devices on LAN","text":"<ol> <li>Verify IP addresses: <code>ip a</code> or <code>ipconfig</code></li> <li>Check subnet mask (should be 255.255.255.0)</li> <li>Check switch connections (link lights)</li> <li>Disable firewall temporarily: <code>sudo ufw disable</code></li> </ol>"},{"location":"hardware/network/#poe-device-not-powering-on","title":"PoE Device Not Powering On","text":"<ol> <li>Verify switch is PoE+ capable (802.3at)</li> <li>Check power budget (may need to unplug other devices)</li> <li>Try different port on switch</li> <li>Verify cable is Cat5e or better</li> <li>Check cable length (&lt;100m)</li> </ol>"},{"location":"hardware/network/#intermittent-connectivity","title":"Intermittent Connectivity","text":"<ol> <li>Check for cable damage</li> <li>Check switch logs (if managed switch)</li> <li>Monitor for IP conflicts: <code>arp-scan --localnet</code></li> <li>Check for DHCP issues (prefer static IPs)</li> </ol>"},{"location":"hardware/network/#network-security","title":"Network Security","text":""},{"location":"hardware/network/#recommendations","title":"Recommendations","text":"<ol> <li>Change default passwords on modem and switch</li> <li>Use static IPs for critical devices</li> <li>Enable firewall on each device</li> <li>Disable unused services</li> <li>Regular firmware updates</li> <li>Monitor logs for suspicious activity</li> </ol>"},{"location":"hardware/network/#access-control","title":"Access Control","text":"<ul> <li>VM services accessible only from LAN</li> <li>SSH accessible only from specific IPs</li> <li>Display management interface password-protected</li> </ul>"},{"location":"hardware/network/#future-expansion","title":"Future Expansion","text":""},{"location":"hardware/network/#adding-devices","title":"Adding Devices","text":"<ul> <li>Ensure PoE+ budget is sufficient</li> <li>Plan IP addressing (keep range organized)</li> <li>Document new devices in this guide</li> </ul>"},{"location":"hardware/network/#vlans-optional","title":"VLANs (Optional)","text":"<p>For better security, consider VLANs:</p> <ul> <li>VLAN 10: Management (Proxmox, Portainer)</li> <li>VLAN 20: IoT devices (Pi, Display)</li> <li>VLAN 30: Data (InfluxDB, Grafana)</li> </ul> <p>Requires managed switch and Proxmox VLAN configuration.</p>"},{"location":"hardware/poe/","title":"PoE Setup","text":"<p>Power over Ethernet (PoE+) is used to power both the Raspberry Pi and Samsung E-Ink Display.</p>"},{"location":"hardware/poe/#poe-standards","title":"PoE Standards","text":""},{"location":"hardware/poe/#poe-8023af","title":"PoE (802.3af)","text":"<ul> <li>Power: Up to 15.4W at switch, 12.95W at device</li> <li>Voltage: 48V DC</li> <li>Use: Low-power devices</li> </ul>"},{"location":"hardware/poe/#poe-8023at","title":"PoE+ (802.3at)","text":"<ul> <li>Power: Up to 30W at switch, 25.5W at device</li> <li>Voltage: 48V DC</li> <li>Use: Higher-power devices (our setup)</li> </ul>"},{"location":"hardware/poe/#poe-8023bt","title":"PoE++ (802.3bt)","text":"<ul> <li>Power: Up to 60-100W</li> <li>Not required for this project</li> </ul>"},{"location":"hardware/poe/#devices-using-poe","title":"Devices Using PoE+","text":""},{"location":"hardware/poe/#samsung-em32dx-e-ink-display","title":"Samsung EM32DX E-Ink Display","text":"<ul> <li>Standard: PoE+ (802.3at)</li> <li>Power Draw: Approximately 20-25W</li> <li>Voltage: 48V DC (stepped down internally)</li> <li>Connector: RJ45 Ethernet</li> </ul>"},{"location":"hardware/poe/#raspberry-pi-with-poe-hat","title":"Raspberry Pi with PoE+ HAT","text":"<ul> <li>HAT Model: Official Raspberry Pi PoE+ HAT</li> <li>Standard: PoE+ (802.3at)</li> <li>Power Draw: 5-8W (depending on load)</li> <li>Max Power: 15W</li> <li>Voltage: 48V DC \u2192 5V DC (via HAT)</li> <li>Cooling: Fan included on HAT (temperature-controlled)</li> </ul>"},{"location":"hardware/poe/#poe-switch-requirements","title":"PoE+ Switch Requirements","text":""},{"location":"hardware/poe/#specifications","title":"Specifications","text":"<ul> <li>Standard: 802.3at (PoE+) or 802.3bt (PoE++)</li> <li>Power Budget: Minimum 60W total</li> <li>Display: 25W</li> <li>Raspberry Pi: 8W</li> <li>Overhead: 10W</li> <li>Reserve: 17W</li> <li>Ports: Minimum 4 (uplink, VM, Pi, Display)</li> </ul>"},{"location":"hardware/poe/#recommended-switches","title":"Recommended Switches","text":"<ul> <li>Unmanaged: TP-Link TL-SG1005P (4 PoE+ ports, 65W budget)</li> <li>Managed: Netgear GS305EP (4 PoE+ ports, 63W budget)</li> <li>Enterprise: Cisco SG350-10P (8 PoE+ ports, 124W budget)</li> </ul>"},{"location":"hardware/poe/#cable-requirements","title":"Cable Requirements","text":""},{"location":"hardware/poe/#category","title":"Category","text":"<ul> <li>Minimum: Cat5e</li> <li>Recommended: Cat6 or Cat6a</li> <li>Maximum Length: 100 meters (328 feet)</li> </ul>"},{"location":"hardware/poe/#wiring-standard","title":"Wiring Standard","text":"<ul> <li>T568A or T568B (both work, must be consistent)</li> <li>All 8 wires must be connected for PoE</li> </ul>"},{"location":"hardware/poe/#testing","title":"Testing","text":"<p>Verify cable quality:</p> <pre><code># On Linux device\nsudo ethtool eth0\n</code></pre> <p>Look for:</p> <ul> <li>Speed: 1000Mb/s (Gigabit)</li> <li>Duplex: Full</li> </ul>"},{"location":"hardware/poe/#installation","title":"Installation","text":""},{"location":"hardware/poe/#raspberry-pi-poe-hat","title":"Raspberry Pi PoE+ HAT","text":""},{"location":"hardware/poe/#1-assemble-hat","title":"1. Assemble HAT","text":"<ol> <li>Attach 40-pin header to Raspberry Pi GPIO</li> <li>Align HAT with GPIO pins</li> <li>Press down gently until seated</li> <li>Secure with provided spacers and screws</li> </ol>"},{"location":"hardware/poe/#2-connect-ethernet","title":"2. Connect Ethernet","text":"<ol> <li>Connect Ethernet cable to Pi</li> <li>Other end to PoE+ switch port</li> <li>Pi should power on automatically (red LED)</li> </ol>"},{"location":"hardware/poe/#3-verify-power","title":"3. Verify Power","text":"<p>Check Pi is receiving power:</p> <pre><code>vcgencmd get_throttled\n</code></pre> <p>Output <code>0x0</code> means no power issues.</p>"},{"location":"hardware/poe/#samsung-display-poe-setup","title":"Samsung Display PoE+ Setup","text":"<ol> <li>Connect Ethernet cable to display's PoE+ port</li> <li>Other end to PoE+ switch port</li> <li>Display should power on automatically</li> <li>Check network connection status via Samsung app (network configuration, content management)</li> </ol>"},{"location":"hardware/poe/#power-budget-management","title":"Power Budget Management","text":""},{"location":"hardware/poe/#calculate-total-draw","title":"Calculate Total Draw","text":"Device Power Draw PoE Port Samsung Display 25W Port 4 Raspberry Pi 8W Port 3 Total 33W - <p>Ensure switch power budget \u2265 33W (preferably 60W+ for headroom).</p>"},{"location":"hardware/poe/#check-switch-power-status","title":"Check Switch Power Status","text":"<p>If using managed switch:</p> <ol> <li>Log into switch web interface</li> <li>Navigate to PoE status</li> <li>Verify:</li> <li>Each port shows power delivered</li> <li>Total budget not exceeded</li> <li>No \"overload\" warnings</li> </ol>"},{"location":"hardware/poe/#troubleshooting","title":"Troubleshooting","text":""},{"location":"hardware/poe/#device-not-powering-on","title":"Device Not Powering On","text":""},{"location":"hardware/poe/#check-1-poe-capability","title":"Check 1: PoE Capability","text":"<p>Verify switch supports PoE+:</p> <ul> <li>Check label on switch for \"802.3at\" or \"PoE+\"</li> <li>Check switch specifications</li> </ul>"},{"location":"hardware/poe/#check-2-cable","title":"Check 2: Cable","text":"<ul> <li>Use Cat5e or better</li> <li>Ensure all 8 wires connected</li> <li>Test with known-good cable</li> </ul>"},{"location":"hardware/poe/#check-3-port-configuration","title":"Check 3: Port Configuration","text":"<p>If managed switch:</p> <ul> <li>Log into switch interface</li> <li>Enable PoE on specific port</li> <li>Set to \"Auto\" or \"Force\" mode</li> </ul>"},{"location":"hardware/poe/#check-4-power-budget","title":"Check 4: Power Budget","text":"<ul> <li>Check if other PoE devices consuming budget</li> <li>Disconnect other PoE devices temporarily</li> <li>Verify total draw &lt; switch capacity</li> </ul>"},{"location":"hardware/poe/#intermittent-power","title":"Intermittent Power","text":""},{"location":"hardware/poe/#symptoms","title":"Symptoms","text":"<ul> <li>Device reboots randomly</li> <li>Network disconnects</li> <li>Underpowered warnings</li> </ul>"},{"location":"hardware/poe/#solutions","title":"Solutions","text":"<ol> <li>Check cable length: Must be &lt;100m</li> <li>Verify cable quality: Use Cat6 for longer runs</li> <li>Check crimps: Poorly crimped connectors cause resistance</li> <li>Monitor power draw:</li> </ol> <pre><code># On Raspberry Pi\nvcgencmd get_throttled\n</code></pre> <p>If not <code>0x0</code>, power issues detected.</p> <ol> <li>Check switch temperature: Overheating reduces power output</li> </ol>"},{"location":"hardware/poe/#poe-hat-fan-noise","title":"PoE HAT Fan Noise","text":""},{"location":"hardware/poe/#adjust-fan-settings","title":"Adjust Fan Settings","text":"<p>Edit Pi config:</p> <pre><code>sudo nano /boot/config.txt\n</code></pre> <p>Add:</p> <pre><code>dtparam=poe_fan_temp0=60000\ndtparam=poe_fan_temp1=65000\ndtparam=poe_fan_temp2=70000\ndtparam=poe_fan_temp3=75000\n</code></pre> <p>This sets fan thresholds (in millidegrees Celsius):</p> <ul> <li>Below 60\u00b0C: Fan off</li> <li>60-65\u00b0C: Low speed</li> <li>65-70\u00b0C: Medium speed</li> <li>70-75\u00b0C: High speed</li> <li>Above 75\u00b0C: Full speed</li> </ul> <p>Reboot:</p> <pre><code>sudo reboot\n</code></pre>"},{"location":"hardware/poe/#safety-considerations","title":"Safety Considerations","text":""},{"location":"hardware/poe/#voltage","title":"Voltage","text":"<ul> <li>PoE uses 48V DC</li> <li>Safe for humans (low current)</li> <li>Still, avoid touching exposed conductors</li> </ul>"},{"location":"hardware/poe/#heat","title":"Heat","text":"<ul> <li>PoE switches generate heat</li> <li>Ensure adequate ventilation</li> <li>Don't stack devices on top of switch</li> </ul>"},{"location":"hardware/poe/#certification","title":"Certification","text":"<ul> <li>Use only certified PoE equipment</li> <li>Avoid cheap/uncertified PoE injectors</li> <li>Check for CE/FCC/UL marks</li> </ul>"},{"location":"hardware/poe/#alternative-power-options","title":"Alternative Power Options","text":"<p>If PoE is not available:</p>"},{"location":"hardware/poe/#raspberry-pi","title":"Raspberry Pi","text":"<ul> <li>USB-C Power Supply: Official 5V 3A adapter</li> <li>PoE Injector: Passive or active injector</li> </ul>"},{"location":"hardware/poe/#samsung-display","title":"Samsung Display","text":"<ul> <li>DC Power Adapter: Check display specs</li> <li>PoE Injector: 802.3at compatible injector</li> </ul>"},{"location":"hardware/poe/#power-consumption-monitoring","title":"Power Consumption Monitoring","text":""},{"location":"hardware/poe/#raspberry-pi_1","title":"Raspberry Pi","text":"<p>Check current draw:</p> <pre><code>vcgencmd measure_volts\nvcgencmd measure_current\n</code></pre>"},{"location":"hardware/poe/#display","title":"Display","text":"<p>Power consumption monitoring is limited on the Samsung E-Ink display. Configuration and monitoring available through the Samsung app includes:</p> <ul> <li>Network settings</li> <li>Content management</li> <li>Screen protection settings</li> </ul> <p>Note: Real-time power consumption monitoring may not be available. Check switch-level monitoring instead.</p>"},{"location":"hardware/poe/#switch","title":"Switch","text":"<p>If managed switch, view per-port power consumption:</p> <ul> <li>Log into web interface</li> <li>PoE status page</li> <li>Shows watts per port</li> </ul>"},{"location":"hardware/poe/#maintenance","title":"Maintenance","text":""},{"location":"hardware/poe/#monthly-checks","title":"Monthly Checks","text":"<ol> <li>Verify all devices powered</li> <li>Check switch status LEDs</li> <li>Test network connectivity</li> <li>Monitor temperatures</li> <li>Check display status via Samsung app</li> </ol>"},{"location":"hardware/poe/#annual-maintenance","title":"Annual Maintenance","text":"<ol> <li>Inspect cables for damage</li> <li>Clean PoE switch vents</li> <li>Verify power budget still adequate</li> <li>Update switch firmware</li> </ol>"},{"location":"hardware/poe/#poe-standards-comparison","title":"PoE Standards Comparison","text":"Standard IEEE Max Power (Switch) Max Power (Device) Voltage PoE 802.3af 15.4W 12.95W 48V PoE+ 802.3at 30W 25.5W 48V PoE++ Type 3 802.3bt 60W 51W 48V PoE++ Type 4 802.3bt 100W 71W 48V <p>Our setup requires PoE+ minimum.</p>"},{"location":"hardware/poe/#cable-pinout","title":"Cable Pinout","text":"<p>PoE uses pairs 2 and 3 (pins 1,2,3,6 and 4,5,7,8):</p> <pre><code>Pin 1: TX+ (Data &amp; Power)\nPin 2: TX- (Data &amp; Power)\nPin 3: RX+ (Data &amp; Power)\nPin 4: Power+\nPin 5: Power-\nPin 6: RX- (Data &amp; Power)\nPin 7: Power+\nPin 8: Power-\n</code></pre> <p>Standard Ethernet data uses pins 1,2,3,6. PoE adds power on pins 4,5,7,8 or uses data pairs.</p>"},{"location":"hardware/poe/#future-upgrades","title":"Future Upgrades","text":""},{"location":"hardware/poe/#higher-power-devices","title":"Higher Power Devices","text":"<p>If adding devices &gt;25W:</p> <ul> <li>Upgrade to PoE++ (802.3bt) switch</li> <li>Verify cable supports higher power</li> <li>Recalculate total power budget</li> </ul>"},{"location":"hardware/poe/#additional-poe-devices","title":"Additional PoE Devices","text":"<p>When adding more:</p> <ol> <li>Calculate total power draw</li> <li>Ensure switch budget sufficient</li> <li>Consider redundant power supply</li> <li>Document new device power requirements</li> </ol>"},{"location":"infrastructure/iotstack/","title":"IOTstack Installation","text":"<p>IOTstack is a Docker-based IoT services stack specifically designed for Raspberry Pi, but works great on any Linux system.</p>"},{"location":"infrastructure/iotstack/#prerequisites","title":"Prerequisites","text":"<ul> <li>VM with Ubuntu/Debian installed</li> <li>SSH access to the VM</li> <li>Sudo privileges</li> <li>Internet connectivity</li> </ul>"},{"location":"infrastructure/iotstack/#installation-process","title":"Installation Process","text":""},{"location":"infrastructure/iotstack/#method-1-quick-install-recommended","title":"Method 1: Quick Install (Recommended)","text":"<p>The simplest way to install IOTstack on an existing system:</p> <ol> <li>Install curl:</li> </ol> <pre><code>sudo apt install -y curl\n</code></pre> <ol> <li>Run the IOTstack installer:</li> </ol> <pre><code>curl -fsSL https://raw.githubusercontent.com/SensorsIot/IOTstack/master/install.sh | bash\n</code></pre> <p>The <code>install.sh</code> script is designed to be run multiple times. If it discovers a problem, it will explain how to fix it, and you can safely re-run the script.</p>"},{"location":"infrastructure/iotstack/#method-2-manual-docker-installation","title":"Method 2: Manual Docker Installation","text":"<p>If you prefer to install Docker manually first:</p> <pre><code># Remove old Docker versions\nsudo apt remove docker docker-engine docker.io containerd runc\n\n# Install dependencies\nsudo apt update\nsudo apt install -y ca-certificates curl gnupg\n\n# Add Docker GPG key\nsudo install -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\n\n# Add Docker repository (for Debian)\necho \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \\\n  $(. /etc/os-release &amp;&amp; echo \"$VERSION_CODENAME\") stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n\n# Install Docker\nsudo apt update\nsudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n\n# Add your user to docker group\nsudo usermod -aG docker $USER\n</code></pre> <p>Important: Log out and back in for group changes to take effect.</p> <p>Verify Docker:</p> <pre><code>docker --version\ndocker compose version\n</code></pre>"},{"location":"infrastructure/iotstack/#3-clone-iotstack","title":"3. Clone IOTstack","text":"<pre><code>cd ~\ngit clone https://github.com/SensorsIot/IOTstack.git IOTstack\ncd IOTstack\n</code></pre>"},{"location":"infrastructure/iotstack/#4-run-the-menu-to-select-services","title":"4. Run the Menu to Select Services","text":"<pre><code>./menu.sh\n</code></pre> <p>The menu will:</p> <ol> <li>Check for dependencies and install them</li> <li>Present a selection interface for choosing containers</li> </ol> <p>Select these services (for this project):</p> <ul> <li>[x] InfluxDB</li> <li>[x] Grafana</li> <li>[x] Node-RED</li> <li>[x] Portainer</li> </ul> <p>Do NOT select (we'll add these separately):</p> <ul> <li>[ ] Grafana Image Renderer (not available in default menu)</li> <li>[ ] WireGuard (we'll use Tailscale instead - see note below)</li> </ul> <p>Tailscale VPN for VM-to-Pi Communication</p> <p>The VM uses Tailscale VPN to securely communicate with the Raspberry Pi over the internet without requiring port forwarding.</p> <p>Recommended Setup: Run Tailscale in Docker alongside IOTstack - Integrates cleanly with IOTstack services - Managed through docker-compose - Automatic restarts with container orchestration - Shared network access with Node-RED</p> <p>Alternative: Install Tailscale natively on the VM - System-level service - Independent of Docker stack - Simpler for some users</p> <p>Both the VM and Raspberry Pi connect to your Tailscale network (tailnet) and receive persistent IPs in the 100.x.x.x range. Node-RED uses these IPs for secure SSH/SCP communication.</p> <p>Network Flow: <code>Node-RED \u2192 Tailscale VPN \u2192 Raspberry Pi</code></p> <p>See Node-RED Tailscale Configuration for complete setup instructions.</p> <p>Navigate with arrow keys, select with Space, confirm with Enter.</p> <p>Critical: Node-RED Add-on Nodes Required</p> <p>If you select Node-RED, you MUST press the right-arrow key and choose at least one add-on node. If you skip this step, Node-RED will not build properly. Recommended add-on nodes:</p> <ul> <li><code>node-red-dashboard</code> (for UI dashboards)</li> <li><code>node-red-contrib-influxdb</code> (for InfluxDB integration)</li> </ul> <p>Even if you don't need these specific nodes, you must select at least one for the build to work correctly.</p>"},{"location":"infrastructure/iotstack/#4-generate-docker-composeyml","title":"4. Generate docker-compose.yml","text":"<p>After selection, the menu will generate <code>~/IOTstack/docker-compose.yml</code></p>"},{"location":"infrastructure/iotstack/#5-review-configuration","title":"5. Review Configuration","text":"<pre><code>cat ~/IOTstack/docker-compose.yml\n</code></pre> <p>Verify the selected services are present.</p>"},{"location":"infrastructure/iotstack/#start-the-stack","title":"Start the Stack","text":""},{"location":"infrastructure/iotstack/#first-time-start","title":"First Time Start","text":"<pre><code>cd ~/IOTstack\ndocker compose up -d\n</code></pre> <p>This will:</p> <ul> <li>Download Docker images</li> <li>Create volumes for persistent data</li> <li>Start all containers</li> <li>May take 5-10 minutes</li> </ul>"},{"location":"infrastructure/iotstack/#verify-containers","title":"Verify Containers","text":"<pre><code>docker compose ps\n</code></pre> <p>All containers should show state <code>Up</code>.</p>"},{"location":"infrastructure/iotstack/#check-logs","title":"Check Logs","text":"<pre><code>docker compose logs -f\n</code></pre> <p>Press Ctrl+C to exit logs.</p>"},{"location":"infrastructure/iotstack/#initial-access","title":"Initial Access","text":""},{"location":"infrastructure/iotstack/#grafana","title":"Grafana","text":"<ul> <li>URL: <code>http://&lt;vm-ip&gt;:3000</code></li> <li>Default login: <code>admin</code> / <code>admin</code></li> <li>Change password on first login</li> </ul>"},{"location":"infrastructure/iotstack/#influxdb","title":"InfluxDB","text":"<ul> <li>URL: <code>http://&lt;vm-ip&gt;:8086</code></li> <li>Create initial database:</li> </ul> <pre><code>docker exec -it influxdb influx\n</code></pre> <p>In the InfluxDB shell:</p> <pre><code>CREATE DATABASE iot_data\nSHOW DATABASES\nEXIT\n</code></pre>"},{"location":"infrastructure/iotstack/#node-red","title":"Node-RED","text":"<ul> <li>URL: <code>http://&lt;vm-ip&gt;:1880</code></li> <li>No default authentication (configure in settings)</li> </ul>"},{"location":"infrastructure/iotstack/#portainer","title":"Portainer","text":"<ul> <li>URL: <code>http://&lt;vm-ip&gt;:9000</code></li> <li>Create admin user on first access</li> </ul>"},{"location":"infrastructure/iotstack/#directory-structure","title":"Directory Structure","text":"<pre><code>~/IOTstack/\n\u251c\u2500\u2500 docker-compose.yml          # Main stack definition\n\u251c\u2500\u2500 menu.sh                     # Menu for managing services\n\u251c\u2500\u2500 services/                   # Service definitions\n\u251c\u2500\u2500 volumes/                    # Persistent data\n\u2502   \u251c\u2500\u2500 grafana/\n\u2502   \u251c\u2500\u2500 influxdb/\n\u2502   \u251c\u2500\u2500 nodered/\n\u2502   \u2514\u2500\u2500 portainer/\n\u2514\u2500\u2500 backups/                    # Backup location\n</code></pre>"},{"location":"infrastructure/iotstack/#stack-management-commands","title":"Stack Management Commands","text":""},{"location":"infrastructure/iotstack/#startstop-stack","title":"Start/Stop Stack","text":"<pre><code>cd ~/IOTstack\ndocker compose up -d      # Start all services\ndocker compose down       # Stop all services\ndocker compose restart    # Restart all services\n</code></pre>"},{"location":"infrastructure/iotstack/#individual-container-management","title":"Individual Container Management","text":"<pre><code>docker compose restart grafana      # Restart one service\ndocker compose logs -f node-red     # View logs for one service\ndocker compose stop influxdb        # Stop one service\ndocker compose start influxdb       # Start one service\n</code></pre>"},{"location":"infrastructure/iotstack/#update-containers","title":"Update Containers","text":"<pre><code>cd ~/IOTstack\ndocker compose pull       # Pull new images\ndocker compose up -d      # Recreate containers with new images\n</code></pre>"},{"location":"infrastructure/iotstack/#backup","title":"Backup","text":"<p>IOTstack includes backup scripts:</p> <pre><code>cd ~/IOTstack\n./scripts/backup.sh\n</code></pre> <p>Backups stored in <code>~/IOTstack/backups/</code></p>"},{"location":"infrastructure/iotstack/#auto-start-on-boot","title":"Auto-Start on Boot","text":"<p>Docker is configured to auto-start containers by default. Verify:</p> <pre><code>docker inspect grafana | grep -A 5 RestartPolicy\n</code></pre> <p>Should show <code>\"Name\": \"unless-stopped\"</code> or <code>\"Name\": \"always\"</code></p> <p>If not, update <code>docker-compose.yml</code>:</p> <pre><code>services:\n  grafana:\n    restart: unless-stopped\n</code></pre>"},{"location":"infrastructure/iotstack/#networking","title":"Networking","text":"<p>All services are on the same Docker network, allowing them to communicate:</p> <ul> <li>Grafana can reach InfluxDB at <code>http://influxdb:8086</code></li> <li>Node-RED can reach InfluxDB at <code>http://influxdb:8086</code></li> <li>Services use internal DNS resolution</li> </ul>"},{"location":"infrastructure/iotstack/#next-steps","title":"Next Steps","text":"<ol> <li>Configure InfluxDB</li> <li>Configure Grafana</li> <li>Configure Node-RED</li> <li>Add Grafana Image Renderer</li> </ol>"},{"location":"infrastructure/iotstack/#troubleshooting","title":"Troubleshooting","text":""},{"location":"infrastructure/iotstack/#port-conflicts","title":"Port Conflicts","text":"<p>If ports are already in use:</p> <pre><code>sudo netstat -tlnp | grep :3000  # Check what's using port 3000\n</code></pre> <p>Edit <code>docker-compose.yml</code> to change ports:</p> <pre><code>ports:\n  - \"3001:3000\"  # Map host port 3001 to container port 3000\n</code></pre>"},{"location":"infrastructure/iotstack/#permission-issues","title":"Permission Issues","text":"<p>If you get permission denied errors:</p> <pre><code>sudo chown -R $USER:$USER ~/IOTstack/volumes/\n</code></pre>"},{"location":"infrastructure/iotstack/#container-wont-start","title":"Container Won't Start","text":"<p>Check logs:</p> <pre><code>docker compose logs &lt;service-name&gt;\n</code></pre> <p>Remove and recreate:</p> <pre><code>docker compose rm &lt;service-name&gt;\ndocker compose up -d &lt;service-name&gt;\n</code></pre>"},{"location":"infrastructure/proxmox/","title":"Proxmox Host Setup","text":""},{"location":"infrastructure/proxmox/#prerequisites","title":"Prerequisites","text":"<ul> <li>Physical server or compatible hardware</li> <li>Network connectivity</li> <li>Access to Proxmox installation media</li> </ul>"},{"location":"infrastructure/proxmox/#installation-steps","title":"Installation Steps","text":""},{"location":"infrastructure/proxmox/#1-install-proxmox-ve","title":"1. Install Proxmox VE","text":"<ol> <li>Download Proxmox VE ISO from https://www.proxmox.com/en/downloads</li> <li>Create bootable USB or mount ISO in server</li> <li>Boot from installation media</li> <li>Follow the installation wizard:</li> <li>Select target disk</li> <li>Set timezone and keyboard layout</li> <li>Configure network (static IP recommended)</li> <li>Set root password</li> <li>Set hostname and domain</li> </ol>"},{"location":"infrastructure/proxmox/#2-post-installation-configuration","title":"2. Post-Installation Configuration","text":""},{"location":"infrastructure/proxmox/#access-web-interface","title":"Access Web Interface","text":"<ol> <li>Navigate to <code>https://&lt;proxmox-ip&gt;:8006</code> in your browser</li> <li>Log in with username <code>root</code> and your password</li> <li>Accept the self-signed certificate warning</li> </ol>"},{"location":"infrastructure/proxmox/#update-system","title":"Update System","text":"<pre><code>apt update\napt dist-upgrade -y\n</code></pre>"},{"location":"infrastructure/proxmox/#configure-storage","title":"Configure Storage","text":"<ol> <li>Go to Datacenter \u2192 Storage</li> <li>Verify local and local-lvm storage pools</li> <li>Add additional storage if needed</li> </ol>"},{"location":"infrastructure/proxmox/#network-configuration","title":"Network Configuration","text":""},{"location":"infrastructure/proxmox/#bridge-configuration","title":"Bridge Configuration","text":"<p>The default bridge (<code>vmbr0</code>) should be configured during installation.</p> <p>Verify in Proxmox Node \u2192 System \u2192 Network:</p> <ul> <li>Name: <code>vmbr0</code></li> <li>IPv4/CIDR: <code>&lt;proxmox-ip&gt;/&lt;netmask&gt;</code></li> <li>Gateway (IPv4): <code>&lt;gateway&gt;</code></li> <li>Autostart: <code>true</code></li> <li>Bridge ports: <code>&lt;physical-interface&gt;</code></li> </ul> <p>This bridge allows VMs to access the network.</p>"},{"location":"infrastructure/proxmox/#resource-allocation","title":"Resource Allocation","text":""},{"location":"infrastructure/proxmox/#recommended-minimum-resources","title":"Recommended Minimum Resources","text":"<p>For the IoT Stack VM:</p> <ul> <li>CPU: 2 cores</li> <li>RAM: 4GB</li> <li>Disk: 50GB</li> <li>Network: Bridged to vmbr0</li> </ul> <p>These can be adjusted based on your Proxmox host's capabilities.</p>"},{"location":"infrastructure/proxmox/#backup-configuration","title":"Backup Configuration","text":""},{"location":"infrastructure/proxmox/#automated-backups","title":"Automated Backups","text":"<ol> <li>Go to Datacenter \u2192 Backup</li> <li>Click Add to create a backup job</li> <li>Configure:</li> <li>Storage: Select backup destination</li> <li>Schedule: Daily at 2:00 AM recommended</li> <li>Selection mode: All or select specific VMs</li> <li>Mode: Snapshot (allows backup of running VMs)</li> <li>Compression: ZSTD (good balance)</li> <li>Retention: Keep last 7 backups</li> </ol>"},{"location":"infrastructure/proxmox/#manual-backup","title":"Manual Backup","text":"<p>To manually backup a VM:</p> <ol> <li>Select the VM</li> <li>Go to Backup tab</li> <li>Click Backup now</li> <li>Select storage and mode</li> <li>Wait for completion</li> </ol>"},{"location":"infrastructure/proxmox/#security-recommendations","title":"Security Recommendations","text":""},{"location":"infrastructure/proxmox/#firewall","title":"Firewall","text":"<ol> <li>Enable Proxmox firewall: Datacenter \u2192 Firewall</li> <li>Add rules to allow:</li> <li>SSH (port 22) from trusted networks</li> <li>Web interface (port 8006) from trusted networks</li> <li>Deny all other inbound traffic by default</li> </ol>"},{"location":"infrastructure/proxmox/#updates","title":"Updates","text":"<p>Keep Proxmox updated:</p> <pre><code>apt update\napt dist-upgrade -y\n</code></pre> <p>Run monthly or enable automatic security updates.</p>"},{"location":"infrastructure/proxmox/#user-management","title":"User Management","text":"<p>Instead of using root for everything:</p> <ol> <li>Go to Datacenter \u2192 Users</li> <li>Create administrative user</li> <li>Assign appropriate permissions</li> <li>Enable two-factor authentication</li> </ol>"},{"location":"infrastructure/proxmox/#useful-commands","title":"Useful Commands","text":""},{"location":"infrastructure/proxmox/#check-vm-status","title":"Check VM Status","text":"<pre><code>qm list\n</code></pre>"},{"location":"infrastructure/proxmox/#startstop-vm","title":"Start/Stop VM","text":"<pre><code>qm start &lt;vmid&gt;\nqm stop &lt;vmid&gt;\nqm shutdown &lt;vmid&gt;  # Graceful shutdown\n</code></pre>"},{"location":"infrastructure/proxmox/#monitor-resources","title":"Monitor Resources","text":"<pre><code>pvesh get /cluster/resources\n</code></pre>"},{"location":"infrastructure/proxmox/#view-logs","title":"View Logs","text":"<pre><code>tail -f /var/log/pveproxy/access.log  # Web access\njournalctl -u pvedaemon -f            # Proxmox daemon\n</code></pre>"},{"location":"infrastructure/proxmox/#next-steps","title":"Next Steps","text":"<p>Once Proxmox is installed and configured, proceed to VM Configuration to create the virtual machine for the IoT stack.</p>"},{"location":"infrastructure/vm-setup/","title":"VM Configuration","text":"<p>This guide covers creating and configuring the Linux VM that will host the IOTstack.</p>"},{"location":"infrastructure/vm-setup/#create-new-vm","title":"Create New VM","text":""},{"location":"infrastructure/vm-setup/#from-proxmox-web-interface","title":"From Proxmox Web Interface","text":"<ol> <li>Click Create VM button (top right)</li> <li>General tab:</li> <li>Node: Select your Proxmox node</li> <li>VM ID: Auto-assigned or choose (e.g., 100)</li> <li> <p>Name: <code>iot-stack</code> (or your preferred name)</p> </li> <li> <p>OS tab:</p> </li> <li>ISO image: Select Debian or Ubuntu server (latest stable)</li> <li>Type: Linux</li> <li> <p>Version: 6.x (latest kernel)</p> </li> <li> <p>System tab:</p> </li> <li>Graphic card: Default (VGA)</li> <li>Machine: Default (i440fx or q35)</li> <li>BIOS: Default (SeaBIOS)</li> <li>SCSI Controller: VirtIO SCSI</li> <li> <p>Qemu Agent: \u2713 Enabled (recommended)</p> </li> <li> <p>Disks tab:</p> </li> <li>Bus/Device: SCSI</li> <li>Storage: local-lvm (or your storage)</li> <li>Disk size: 50 GB minimum (80-100 GB recommended)</li> <li>Cache: Default (No cache)</li> <li>Discard: \u2713 Enabled (if using SSD)</li> <li> <p>SSD emulation: \u2713 Enabled (if Proxmox storage is SSD)</p> </li> <li> <p>CPU tab:</p> </li> <li>Sockets: 1</li> <li>Cores: 2 minimum (4 recommended)</li> <li> <p>Type: host (best performance)</p> </li> <li> <p>Memory tab:</p> </li> <li> <p>Memory (MiB): 4096 minimum (8192 recommended for Grafana)</p> </li> <li> <p>Network tab:</p> </li> <li>Bridge: vmbr0</li> <li>Model: VirtIO (paravirtualized)</li> <li> <p>Firewall: \u2713 Enabled</p> </li> <li> <p>Confirm tab:</p> </li> <li>Start after created: \u2713 Optional</li> <li>Click Finish</li> </ol>"},{"location":"infrastructure/vm-setup/#os-installation","title":"OS Installation","text":""},{"location":"infrastructure/vm-setup/#boot-and-install","title":"Boot and Install","text":"<ol> <li>Select the VM and click Start</li> <li>Open Console (noVNC or SPICE)</li> <li>Follow the Ubuntu/Debian installation:</li> <li>Language: English (or your preference)</li> <li>Keyboard: Your layout</li> <li>Network: Should auto-configure via DHCP</li> <li>Mirror: Default or choose closest</li> <li>Disk: Use entire disk (no LVM needed)</li> <li>User: Create user (e.g., <code>iotadmin</code>)</li> <li>Hostname: <code>iotstack</code> or your preference</li> <li>Software: Install OpenSSH server</li> </ol>"},{"location":"infrastructure/vm-setup/#set-static-ip-recommended","title":"Set Static IP (Recommended)","text":"<p>After installation, configure static IP for reliability:</p>"},{"location":"infrastructure/vm-setup/#for-debian","title":"For Debian","text":"<p>Edit <code>/etc/network/interfaces</code>:</p> <pre><code>auto ens18\niface ens18 inet static\n    address &lt;vm_ip&gt;\n    netmask 255.255.255.0\n    gateway &lt;gateway_ip&gt;\n    dns-nameservers 8.8.8.8 8.8.4.4\n</code></pre> <p>Restart networking:</p> <pre><code>sudo systemctl restart networking\n</code></pre>"},{"location":"infrastructure/vm-setup/#for-ubuntu-netplan","title":"For Ubuntu (Netplan)","text":"<p>Edit <code>/etc/netplan/00-installer-config.yaml</code>:</p> <pre><code>network:\n  version: 2\n  ethernets:\n    ens18:  # Your interface name (check with 'ip a')\n      dhcp4: no\n      addresses:\n        - &lt;vm_ip&gt;/24  # Your desired IP\n      gateway4: &lt;gateway_ip&gt;  # Your gateway\n      nameservers:\n        addresses:\n          - 8.8.8.8\n          - 8.8.4.4\n</code></pre> <p>Apply:</p> <pre><code>sudo netplan apply\n</code></pre>"},{"location":"infrastructure/vm-setup/#post-installation-setup","title":"Post-Installation Setup","text":""},{"location":"infrastructure/vm-setup/#update-system","title":"Update System","text":"<pre><code>sudo apt update\nsudo apt upgrade -y\nsudo reboot\n</code></pre>"},{"location":"infrastructure/vm-setup/#install-qemu-guest-agent","title":"Install QEMU Guest Agent","text":"<p>This allows Proxmox to properly manage the VM:</p> <pre><code>sudo apt install qemu-guest-agent -y\nsudo systemctl start qemu-guest-agent\nsudo systemctl enable qemu-guest-agent\n</code></pre> <p>Verify in Proxmox: VM should show IP address and system info.</p>"},{"location":"infrastructure/vm-setup/#install-essential-tools","title":"Install Essential Tools","text":"<pre><code>sudo apt install -y git curl wget vim htop net-tools\n</code></pre>"},{"location":"infrastructure/vm-setup/#vm-optimization","title":"VM Optimization","text":""},{"location":"infrastructure/vm-setup/#enable-trim-for-ssd","title":"Enable TRIM (for SSD)","text":"<p>If Proxmox storage is on SSD:</p> <pre><code>sudo systemctl enable fstrim.timer\nsudo systemctl start fstrim.timer\n</code></pre>"},{"location":"infrastructure/vm-setup/#configure-swap","title":"Configure Swap","text":"<p>For 4GB RAM systems, add swap:</p> <pre><code>sudo fallocate -l 2G /swapfile\nsudo chmod 600 /swapfile\nsudo mkswap /swapfile\nsudo swapon /swapfile\necho '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab\n</code></pre> <p>Adjust swappiness:</p> <pre><code>echo 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n</code></pre>"},{"location":"infrastructure/vm-setup/#snapshot-before-iotstack-installation","title":"Snapshot (Before IOTstack Installation)","text":"<p>Take a snapshot before proceeding:</p> <ol> <li>In Proxmox web interface, select the VM</li> <li>Go to Snapshots tab</li> <li>Click Take Snapshot</li> <li>Name: <code>pre-iotstack</code></li> <li>Description: \"Clean OS install before Docker\"</li> </ol> <p>This allows easy rollback if needed.</p>"},{"location":"infrastructure/vm-setup/#next-steps","title":"Next Steps","text":"<p>Proceed to IOTstack Installation to set up the Docker-based IoT services.</p>"},{"location":"maintenance/backup/","title":"Backup &amp; Restore","text":"<p>Comprehensive backup and restore procedures.</p>"},{"location":"maintenance/backup/#backup-strategy","title":"Backup Strategy","text":""},{"location":"maintenance/backup/#current-backup-infrastructure","title":"Current Backup Infrastructure","text":"<p>This system uses two dedicated backup storage solutions:</p> <p>1. Proxmox VM Backups: - Storage: 2TB external SSD connected to Proxmox host - What: Complete VM images and configurations - Schedule: Daily automated backups - Retention: Last 7 backups</p> <p>2. InfluxDB Data Backups: - Storage: RAID5 array (5x 2TB SSDs, ~8TB usable capacity) - What: InfluxDB time-series database - Protection: RAID5 provides redundancy (can survive 1 disk failure) - Schedule: Continuous/automated backups</p>"},{"location":"maintenance/backup/#what-to-backup","title":"What to Backup","text":"<ol> <li>Proxmox VM \u2192 2TB External SSD</li> <li>Complete VM image</li> <li>VM configuration</li> <li> <p>Automated daily snapshots</p> </li> <li> <p>InfluxDB Data \u2192 RAID5 Array</p> </li> <li>Time-series turbine data</li> <li>Weather data</li> <li> <p>Historical measurements</p> </li> <li> <p>Configuration Files \u2192 Manual/periodic backup</p> </li> <li><code>docker-compose.yml</code></li> <li>Node-RED <code>settings.js</code></li> <li>Shell scripts on Raspberry Pi</li> <li> <p>Grafana dashboards</p> </li> <li> <p>Documentation \u2192 Version control/manual backup</p> </li> <li>This manual</li> <li>Network diagram</li> <li>Passwords (encrypted)</li> </ol>"},{"location":"maintenance/backup/#backup-schedule","title":"Backup Schedule","text":"Item Storage Frequency Retention Proxmox VM 2TB External SSD Daily (automated) Last 7 backups InfluxDB data RAID5 Array Continuous All data (RAID5 protected) Grafana dashboards Manual Weekly 4 weeks Node-RED flows Manual Weekly 4 weeks Configuration files Manual Weekly 4 weeks"},{"location":"maintenance/backup/#proxmox-vm-backup","title":"Proxmox VM Backup","text":""},{"location":"maintenance/backup/#current-configuration","title":"Current Configuration","text":"<p>Storage: 2TB external SSD connected to Proxmox host</p> <p>The system is configured to automatically create daily VM backups with 7-day retention.</p>"},{"location":"maintenance/backup/#automated-backup-already-configured","title":"Automated Backup (Already Configured)","text":"<p>The Proxmox backup job is configured with:</p> <ul> <li>Storage: 2TB External SSD</li> <li>Schedule: Daily at 2:00 AM</li> <li>Mode: Snapshot (VM continues running during backup)</li> <li>Compression: ZSTD</li> <li>Retention: Keep last 7 backups (oldest is automatically deleted)</li> </ul> <p>To view/modify configuration:</p> <ol> <li>Proxmox web UI \u2192 Datacenter \u2192 Backup</li> <li>View existing backup job for the IOTstack VM</li> <li>Modify if needed (storage, schedule, retention)</li> </ol>"},{"location":"maintenance/backup/#verify-backup-job","title":"Verify Backup Job","text":"<p>Check backup status:</p> <ol> <li>Datacenter \u2192 Backup</li> <li>View backup history and logs</li> <li>Verify last backup completed successfully</li> </ol> <p>Or via command line:</p> <pre><code># List backups\npvesm list &lt;storage-name&gt;\n\n# View backup logs\ncat /var/log/pve/tasks/active\n</code></pre>"},{"location":"maintenance/backup/#manual-backup","title":"Manual Backup","text":"<p>If needed, create an additional manual backup:</p> <ol> <li>Select VM in Proxmox</li> <li>Backup tab</li> <li>Click Backup now</li> <li>Choose:</li> <li>Storage: 2TB External SSD</li> <li>Mode: Snapshot (for running VM)</li> <li>Compression: ZSTD</li> <li>Note: Optional description</li> <li>Backup</li> </ol> <p>Backup file format: <code>vzdump-qemu-&lt;vmid&gt;-&lt;timestamp&gt;.vma.zst</code></p>"},{"location":"maintenance/backup/#backup-storage-capacity","title":"Backup Storage Capacity","text":"<p>2TB SSD Capacity: - Estimated VM size: ~20-30GB per backup - 7 daily backups: ~210GB used - Remaining capacity: ~1.8TB available for growth</p> <p>Monitor Storage Usage</p> <p>Check external SSD storage usage monthly. If backups grow larger, consider:</p> <ul> <li>Reducing retention to 5 days</li> <li>Cleaning up unused files in VM</li> <li>Upgrading to larger external drive</li> </ul>"},{"location":"maintenance/backup/#download-backup-for-offsite-storage","title":"Download Backup for Offsite Storage","text":"<p>For additional offsite protection:</p> <ol> <li>SSH to Proxmox host</li> <li>Navigate to backup location</li> <li>Copy to remote location:</li> </ol> <pre><code># Find backups on external SSD\nls -lh /mnt/pve/&lt;storage-name&gt;/dump/\n\n# Copy to offsite location\nscp /mnt/pve/&lt;storage-name&gt;/dump/vzdump-qemu-*.vma.zst user@remote:/backups/\n</code></pre>"},{"location":"maintenance/backup/#influxdb-data-backup","title":"InfluxDB Data Backup","text":""},{"location":"maintenance/backup/#current-configuration_1","title":"Current Configuration","text":"<p>Storage: RAID5 array with 5x 2TB SSDs (~8TB usable capacity)</p> <p>The InfluxDB database is stored on a RAID5 array, providing:</p> <ul> <li>Redundancy: Can survive 1 disk failure without data loss</li> <li>Capacity: ~8TB usable storage for time-series data</li> <li>Performance: Fast read/write speeds for database operations</li> </ul>"},{"location":"maintenance/backup/#raid5-protection","title":"RAID5 Protection","text":"<p>How it works: - Data is striped across 4 disks with parity on the 5th - If any single disk fails, data can be rebuilt from remaining disks - Critical: Must replace failed disk promptly before second failure occurs</p> <p>Monitor RAID status:</p> <pre><code># Check RAID array status\ncat /proc/mdstat\n\n# Detailed RAID information\nsudo mdadm --detail /dev/md0\n\n# Check for disk errors\nsudo smartctl -a /dev/sda  # Repeat for sdb, sdc, sdd, sde\n</code></pre> <p>RAID5 Limitations</p> <p>RAID5 is NOT a backup - it's redundancy for hardware failure. It does NOT protect against:</p> <ul> <li>Accidental deletion</li> <li>Data corruption</li> <li>Ransomware/malware</li> <li>Multiple simultaneous disk failures</li> </ul> <p>Consider periodic manual backups for critical historical data.</p>"},{"location":"maintenance/backup/#manual-influxdb-backup","title":"Manual InfluxDB Backup","text":"<p>For additional protection or before major changes:</p> <pre><code># Create portable backup\ndocker exec influxdb influxd backup -portable -database iot_data /tmp/influxdb_backup\n\n# Copy out of container\ndocker cp influxdb:/tmp/influxdb_backup ./influxdb_backup_$(date +%Y%m%d)\n\n# Compress for storage\ntar czf influxdb_backup_$(date +%Y%m%d).tar.gz influxdb_backup_$(date +%Y%m%d)\n</code></pre> <p>Storage recommendations: - Store compressed backups on the 2TB external SSD - Keep 2-3 monthly snapshots for historical recovery</p>"},{"location":"maintenance/backup/#other-docker-volumes-backup","title":"Other Docker Volumes Backup","text":"<p>Grafana dashboards:</p> <pre><code>docker cp grafana:/var/lib/grafana ./grafana_backup_$(date +%Y%m%d)\n</code></pre> <p>Node-RED flows:</p> <pre><code>docker cp nodered:/data ./nodered_backup_$(date +%Y%m%d)\n</code></pre>"},{"location":"maintenance/backup/#iotstack-backup-script","title":"IOTstack Backup Script","text":"<p>IOTstack includes a backup script for all volumes:</p> <pre><code>cd ~/IOTstack\n./scripts/backup.sh\n</code></pre> <p>Creates backup in <code>~/IOTstack/backups/</code>.</p>"},{"location":"maintenance/backup/#automated-backup-optional","title":"Automated Backup (Optional)","text":"<p>Create cron job for periodic Grafana/Node-RED backups:</p> <pre><code>crontab -e\n</code></pre> <p>Add:</p> <pre><code># Weekly backup of Grafana and Node-RED on Sundays at 3 AM\n0 3 * * 0 docker cp grafana:/var/lib/grafana /backups/grafana_$(date +\\%Y\\%m\\%d)\n0 3 * * 0 docker cp nodered:/data /backups/nodered_$(date +\\%Y\\%m\\%d)\n</code></pre>"},{"location":"maintenance/backup/#configuration-backup","title":"Configuration Backup","text":""},{"location":"maintenance/backup/#export-docker-compose","title":"Export Docker Compose","text":"<pre><code>cp ~/IOTstack/docker-compose.yml ~/backups/docker-compose_$(date +%Y%m%d).yml\n</code></pre>"},{"location":"maintenance/backup/#export-node-red-flows","title":"Export Node-RED Flows","text":"<p>From Node-RED UI:</p> <ol> <li>Menu \u2192 Export</li> <li>Select all flows</li> <li>Download JSON</li> </ol> <p>Or from command line:</p> <pre><code>docker exec nodered cat /data/flows.json &gt; flows_backup_$(date +%Y%m%d).json\n</code></pre>"},{"location":"maintenance/backup/#export-grafana-dashboards","title":"Export Grafana Dashboards","text":"<p>Via UI:</p> <ol> <li>Dashboard \u2192 Share \u2192 Export</li> <li>Save JSON</li> </ol> <p>Via API:</p> <pre><code># List dashboards\ncurl -s http://admin:password@&lt;vm_ip&gt;:3000/api/search?query= | jq\n\n# Export specific dashboard\ncurl -s http://admin:password@&lt;vm_ip&gt;:3000/api/dashboards/uid/&lt;uid&gt; \\\n  &gt; dashboard_backup_$(date +%Y%m%d).json\n</code></pre>"},{"location":"maintenance/backup/#raspberry-pi-scripts","title":"Raspberry Pi Scripts","text":"<pre><code># From VM\nscp &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/home/&lt;pi_username&gt;/*.sh ./pi_scripts_backup/\nscp &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/usr/local/bin/gadget.sh ./pi_scripts_backup/\n</code></pre>"},{"location":"maintenance/backup/#tailscale-state","title":"Tailscale State","text":"<p>If using Docker:</p> <pre><code>cd ~/IOTstack\nsudo tar czf tailscale_state_$(date +%Y%m%d).tar.gz volumes/tailscale/state/\n</code></pre> <p>If using native install:</p> <pre><code># On VM\nsudo tar czf tailscale_state_vm_$(date +%Y%m%d).tar.gz /var/lib/tailscale/\n\n# On Pi\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo tar czf /tmp/tailscale_state_pi.tar.gz /var/lib/tailscale/'\nscp &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/tmp/tailscale_state_pi_$(date +%Y%m%d).tar.gz ./\n</code></pre> <p>Note: Tailscale state includes machine keys and configuration. Backing this up allows quick recovery without re-authentication.</p>"},{"location":"maintenance/backup/#restore-procedures","title":"Restore Procedures","text":""},{"location":"maintenance/backup/#restore-proxmox-vm","title":"Restore Proxmox VM","text":"<p>Full VM Restore:</p> <ol> <li>In Proxmox, select target node</li> <li>Local storage \u2192 Backups</li> <li>Select backup file</li> <li>Click Restore</li> <li>Configure:</li> <li>VM ID: Original or new</li> <li>Storage: local-lvm</li> <li>Click Restore</li> <li>Wait for completion</li> <li>Start VM</li> </ol> <p>Partial Restore (extract files):</p> <pre><code># Extract backup\nvzdump extract vzdump-qemu-100-*.vma.zst /tmp/restore/\n\n# Mount disk image\nguestmount -a /tmp/restore/disk.raw -i /mnt/restore/\n\n# Copy files\ncp /mnt/restore/path/to/file /destination/\n\n# Unmount\nguestunmount /mnt/restore/\n</code></pre>"},{"location":"maintenance/backup/#restore-docker-volumes","title":"Restore Docker Volumes","text":"<p>InfluxDB:</p> <pre><code>docker cp ./influxdb_backup_20260107 influxdb:/tmp/restore\ndocker exec influxdb influxd restore -portable -db iot_data /tmp/restore\ndocker compose restart influxdb\n</code></pre> <p>Grafana:</p> <pre><code>docker compose stop grafana\ndocker cp ./grafana_backup_20260107/. grafana:/var/lib/grafana/\ndocker compose start grafana\n</code></pre> <p>Node-RED:</p> <pre><code>docker compose stop nodered\ndocker cp ./nodered_backup_20260107/. nodered:/data/\ndocker compose start nodered\n</code></pre>"},{"location":"maintenance/backup/#restore-configuration","title":"Restore Configuration","text":"<p>Docker Compose:</p> <pre><code>cp docker-compose_20260107.yml ~/IOTstack/docker-compose.yml\ncd ~/IOTstack\ndocker compose up -d\n</code></pre> <p>Node-RED Flows:</p> <ol> <li>Node-RED UI \u2192 Menu \u2192 Import</li> <li>Select <code>flows_backup_20260107.json</code></li> <li>Import</li> <li>Deploy</li> </ol> <p>Grafana Dashboards:</p> <ol> <li>Grafana UI \u2192 Dashboards \u2192 Import</li> <li>Upload <code>dashboard_backup_20260107.json</code></li> <li>Select data source</li> <li>Import</li> </ol>"},{"location":"maintenance/backup/#restore-raspberry-pi","title":"Restore Raspberry Pi","text":"<p>Scripts:</p> <pre><code>scp pi_scripts_backup/*.sh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/home/&lt;pi_username&gt;/\nscp pi_scripts_backup/gadget.sh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/tmp/\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo mv /tmp/gadget.sh /usr/local/bin/ &amp;&amp; sudo chmod +x /usr/local/bin/gadget.sh'\n</code></pre> <p>Tailscale State:</p> <pre><code># On VM (Docker)\nsudo tar xzf tailscale_state_20260107.tar.gz -C ~/IOTstack/\ndocker compose restart tailscale\n\n# On VM (native)\nsudo tar xzf tailscale_state_vm_20260107.tar.gz -C /\nsudo systemctl restart tailscaled\n\n# On Pi\nscp tailscale_state_pi_20260107.tar.gz &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/tmp/\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo tar xzf /tmp/tailscale_state_pi_20260107.tar.gz -C / &amp;&amp; sudo systemctl restart tailscaled'\n</code></pre> <p>Note: After restoring Tailscale state, verify connectivity:</p> <pre><code># Check status\ntailscale status  # or: docker exec tailscale tailscale status\n\n# If not authenticated, re-authenticate\ntailscale up  # or: docker exec tailscale tailscale up\n</code></pre> <p>Regenerate USB Drive:</p> <p>If <code>drive.bin</code> is corrupted:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\nsudo dd if=/dev/zero of=/home/&lt;pi_username&gt;/drive.bin bs=1M count=100\nsudo mkfs.vfat /home/&lt;pi_username&gt;/drive.bin\nsudo mount -o loop /home/&lt;pi_username&gt;/drive.bin /mnt\nsudo mkdir -p /mnt/SAMSUNG_E-Paper\nsudo umount /mnt\n</code></pre>"},{"location":"maintenance/backup/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"maintenance/backup/#complete-system-loss","title":"Complete System Loss","text":"<p>Scenario: Proxmox host failure or complete hardware loss</p> <p>Recovery Steps:</p> <ol> <li>Reinstall Proxmox on new/repaired hardware</li> <li>Reconnect 2TB external SSD to new Proxmox host</li> <li>Restore VM from latest backup:</li> <li>In Proxmox: Local storage \u2192 Backups</li> <li>Select most recent backup from external SSD</li> <li>Click Restore, configure VM ID and storage</li> <li>Verify VM boots and all Docker services start</li> <li>Check InfluxDB data integrity (if RAID array survived)</li> <li>Test connectivity to Raspberry Pi via Tailscale</li> <li>Verify end-to-end functionality (data collection \u2192 display)</li> </ol> <p>Time Estimate: 2-4 hours (if backup storage intact)</p> <p>Recovery Time Objective (RTO): 4 hours Recovery Point Objective (RPO): 24 hours (last daily backup)</p>"},{"location":"maintenance/backup/#raid5-disk-failure","title":"RAID5 Disk Failure","text":"<p>Scenario: Single disk failure in RAID5 array</p> <p>Symptoms: - RAID degraded mode warning - System still operational (data accessible) - Performance may be reduced</p> <p>Recovery Steps:</p> <ol> <li> <p>Identify failed disk:    <pre><code>cat /proc/mdstat\nsudo mdadm --detail /dev/md0\n</code></pre></p> </li> <li> <p>Order replacement disk (same size or larger)</p> </li> <li> <p>Replace failed disk:    <pre><code># Remove failed disk from array\nsudo mdadm --manage /dev/md0 --remove /dev/sdX\n\n# Physically replace the disk\n\n# Add new disk to array\nsudo mdadm --manage /dev/md0 --add /dev/sdX\n</code></pre></p> </li> <li> <p>Monitor rebuild:    <pre><code>watch cat /proc/mdstat\n</code></pre></p> </li> <li> <p>Verify array health after rebuild completes</p> </li> </ol> <p>Time Estimate: 4-12 hours (depending on rebuild speed)</p> <p>Critical: Act Immediately</p> <p>RAID5 can only survive ONE disk failure. If a second disk fails during rebuild, ALL DATA IS LOST. Replace failed disks promptly!</p>"},{"location":"maintenance/backup/#raid5-complete-failure","title":"RAID5 Complete Failure","text":"<p>Scenario: Multiple disk failures or RAID controller failure</p> <p>Recovery Steps:</p> <ol> <li>Accept InfluxDB data loss (if no recent backup exists)</li> <li>Restore VM from 2TB external SSD backup</li> <li>Reconfigure RAID5 or use alternative storage</li> <li>System starts collecting new data immediately</li> <li>Historical data lost (time-series data unrecoverable without backup)</li> </ol> <p>Prevention: Create monthly InfluxDB backups to external SSD</p>"},{"location":"maintenance/backup/#data-loss-influxdb","title":"Data Loss (InfluxDB)","text":"<p>If manual backup available:</p> <ol> <li>Stop InfluxDB: <code>docker compose stop influxdb</code></li> <li>Restore from backup:    <pre><code>docker exec influxdb influxd restore -portable -db iot_data /tmp/restore\n</code></pre></li> <li>Start InfluxDB: <code>docker compose start influxdb</code></li> <li>Verify data: Check Grafana dashboards</li> </ol> <p>If no backup (RAID5 failed completely):</p> <ol> <li>Accept historical data loss</li> <li>System continues collecting new data</li> <li>Dashboards will only show data from restore point forward</li> </ol> <p>Lesson: Implement monthly InfluxDB backups to external SSD</p>"},{"location":"maintenance/backup/#external-ssd-failure","title":"External SSD Failure","text":"<p>Scenario: 2TB external SSD containing VM backups fails</p> <p>Impact: - VM backups lost - Active VM still running (no immediate impact) - No recovery point if VM fails</p> <p>Recovery Steps:</p> <ol> <li>Replace external SSD immediately</li> <li>Reconfigure Proxmox backup job to new storage</li> <li>Create new manual backup as soon as possible</li> <li>Consider implementing offsite backup to prevent future single-point failure</li> </ol> <p>Time to Recovery: Immediate (VM still running), but no safety net until new backup exists</p>"},{"location":"maintenance/backup/#raspberry-pi-failure","title":"Raspberry Pi Failure","text":"<p>Replacement Steps:</p> <ol> <li>Image new SD card with Raspberry Pi OS</li> <li>Configure network (static IP, Tailscale)</li> <li>Install scripts from backup</li> <li>Configure SSH keys from VM</li> <li>Set up gadget mode (see Gadget Mode Setup)</li> <li>Test image transfer and display update</li> </ol> <p>Time Estimate: 1-2 hours</p>"},{"location":"maintenance/backup/#offsite-backup","title":"Offsite Backup","text":""},{"location":"maintenance/backup/#why-offsite","title":"Why Offsite?","text":"<p>Protects against:</p> <ul> <li>Physical disaster (fire, flood)</li> <li>Theft</li> <li>Hardware failure</li> </ul>"},{"location":"maintenance/backup/#methods","title":"Methods","text":"<p>Cloud Storage:</p> <pre><code># Install rclone\nsudo apt install rclone\n\n# Configure cloud provider\nrclone config\n\n# Sync backups\nrclone sync ~/IOTstack/backups/ remote:backups/\n</code></pre> <p>Remote Server:</p> <pre><code># Rsync to remote\nrsync -avz ~/IOTstack/backups/ user@remote-server:/backups/\n</code></pre> <p>Automated:</p> <pre><code>crontab -e\n</code></pre> <p>Add:</p> <pre><code># Daily offsite backup at 4 AM\n0 4 * * * rclone sync ~/IOTstack/backups/ remote:backups/\n</code></pre>"},{"location":"maintenance/backup/#backup-verification","title":"Backup Verification","text":""},{"location":"maintenance/backup/#test-backups-regularly","title":"Test Backups Regularly","text":"<p>Monthly Test:</p> <ol> <li>Restore to test VM</li> <li>Verify services start</li> <li>Check data is accessible</li> <li>Delete test VM</li> </ol>"},{"location":"maintenance/backup/#verification-checklist","title":"Verification Checklist","text":"<ul> <li>[ ] Backup files are not corrupted</li> <li>[ ] Backup size is reasonable (not 0 bytes)</li> <li>[ ] Restore completes without errors</li> <li>[ ] All services start after restore</li> <li>[ ] Data is accessible and current</li> <li>[ ] Configuration is preserved</li> </ul>"},{"location":"maintenance/backup/#backup-storage","title":"Backup Storage","text":""},{"location":"maintenance/backup/#current-storage-infrastructure","title":"Current Storage Infrastructure","text":"<p>Primary Backup Storage:</p> <ol> <li>2TB External SSD (Proxmox VM backups)</li> <li>Connected to Proxmox host</li> <li>Dedicated for VM snapshots</li> <li>Daily automated backups with 7-day retention</li> <li>Current usage: ~210GB (7 backups \u00d7 30GB each)</li> <li> <p>Available capacity: ~1.8TB</p> </li> <li> <p>RAID5 Array (InfluxDB data)</p> </li> <li>5\u00d7 2TB SSDs in RAID5 configuration</li> <li>Usable capacity: ~8TB</li> <li>Continuous data protection with single-disk failure tolerance</li> <li>Current usage: Variable (depends on data retention)</li> <li>Dedicated for time-series database storage</li> </ol>"},{"location":"maintenance/backup/#storage-capacity-planning","title":"Storage Capacity Planning","text":"<p>2TB External SSD: - Estimated VM backup size: 20-30GB per backup - 7 daily backups: ~210GB - Growth headroom: ~1.8TB available - Recommendation: Monitor monthly, consider cleanup if usage exceeds 1TB</p> <p>RAID5 Array: - InfluxDB growth rate: ~500MB per month (estimate) - Current capacity: ~8TB usable - Recommendation: Monitor RAID status weekly, plan for expansion if usage exceeds 6TB</p>"},{"location":"maintenance/backup/#storage-monitoring","title":"Storage Monitoring","text":"<p>Check External SSD usage:</p> <pre><code># On Proxmox host\ndf -h /mnt/pve/&lt;backup-storage-name&gt;\n</code></pre> <p>Check RAID5 array usage:</p> <pre><code># RAID health\ncat /proc/mdstat\nsudo mdadm --detail /dev/md0\n\n# Storage usage\ndf -h /path/to/raid/mount\n</code></pre>"},{"location":"maintenance/backup/#storage-locations","title":"Storage Locations","text":"<p>Local (Current Setup):</p> <ul> <li>\u2705 2TB External SSD (Proxmox host) - VM backups</li> <li>\u2705 RAID5 Array (8TB usable) - InfluxDB data</li> <li>\u26a0\ufe0f Missing: Offsite backup location</li> </ul> <p>Offsite (Recommended):</p> <ul> <li>Cloud storage (AWS S3, Backblaze B2, Google Drive)</li> <li>Remote server at different physical location</li> <li>Encrypted external drive stored offsite</li> </ul> <p>Best Practice: 3-2-1 Rule</p> <ul> <li>3 copies of data</li> <li>Original (VM/database)</li> <li>Local backup (2TB SSD / RAID5)</li> <li>Missing: Offsite copy</li> <li>2 different media types \u2705 (SSD + RAID array)</li> <li>1 offsite copy \u26a0\ufe0f Not yet implemented</li> </ul> <p>Offsite Backup Recommended</p> <p>Current setup protects against hardware failure but NOT against:</p> <ul> <li>Physical disaster (fire, flood) at Proxmox location</li> <li>Theft of hardware</li> <li>Complete site loss</li> </ul> <p>Action: Implement periodic offsite backup of critical data (VM snapshots, InfluxDB monthly snapshots)</p>"},{"location":"maintenance/backup/#backup-security","title":"Backup Security","text":""},{"location":"maintenance/backup/#encryption","title":"Encryption","text":"<p>Encrypt backups before offsite storage:</p> <pre><code># Encrypt\ngpg -c backup_file.tar.gz\n\n# Decrypt\ngpg backup_file.tar.gz.gpg\n</code></pre>"},{"location":"maintenance/backup/#access-control","title":"Access Control","text":"<ul> <li>Limit who can access backups</li> <li>Use strong passwords</li> <li>Enable MFA on cloud storage</li> </ul>"},{"location":"maintenance/backup/#audit-logs","title":"Audit Logs","text":"<p>Monitor backup access:</p> <pre><code># Check recent access\nls -lt ~/IOTstack/backups/ | head\n</code></pre>"},{"location":"maintenance/backup/#documentation-backup","title":"Documentation Backup","text":""},{"location":"maintenance/backup/#critical-documents","title":"Critical Documents","text":"<ul> <li>This manual (all markdown files)</li> <li>Network diagrams</li> <li>Password vault export</li> <li>Contact information</li> <li>License keys</li> </ul>"},{"location":"maintenance/backup/#version-control","title":"Version Control","text":"<p>Store documentation in Git:</p> <pre><code>cd /path/to/docs\ngit init\ngit add .\ngit commit -m \"Initial commit\"\ngit remote add origin &lt;repository-url&gt;\ngit push -u origin main\n</code></pre>"},{"location":"maintenance/backup/#offsite-documentation","title":"Offsite Documentation","text":"<ul> <li>Print important pages</li> <li>Store in physical safe</li> <li>Share with trusted colleague</li> </ul>"},{"location":"maintenance/backup/#recovery-time-objectives","title":"Recovery Time Objectives","text":"Scenario Target RTO Target RPO Single container failure 5 minutes 0 (no data loss) VM failure 30 minutes 24 hours Complete system loss 4 hours 24 hours Data corruption 1 hour 24 hours <p>RTO: Recovery Time Objective (how fast can we restore?) RPO: Recovery Point Objective (how much data can we lose?)</p>"},{"location":"maintenance/backup/#backup-maintenance","title":"Backup Maintenance","text":""},{"location":"maintenance/backup/#regular-tasks","title":"Regular Tasks","text":"<p>Weekly:</p> <ul> <li>Verify backups completed successfully</li> <li>Check backup storage usage</li> </ul> <p>Monthly:</p> <ul> <li>Test restore procedure</li> <li>Review backup retention</li> <li>Clean old backups</li> </ul> <p>Quarterly:</p> <ul> <li>Review backup strategy</li> <li>Update documentation</li> <li>Test disaster recovery plan</li> </ul>"},{"location":"maintenance/backup/#monitoring","title":"Monitoring","text":"<p>Set up alerts for:</p> <ul> <li>Backup job failures</li> <li>Low disk space on backup storage</li> <li>Backup age &gt;48 hours</li> </ul>"},{"location":"maintenance/backup/#backup-costs","title":"Backup Costs","text":""},{"location":"maintenance/backup/#storage-costs","title":"Storage Costs","text":"<p>Estimate monthly:</p> <ul> <li>Local NAS: $0 (one-time hardware cost)</li> <li>Cloud storage (250GB): $5-15/month</li> <li>Remote server: $10-50/month</li> </ul>"},{"location":"maintenance/backup/#time-costs","title":"Time Costs","text":"<ul> <li>Setup: 4 hours initially</li> <li>Maintenance: 1 hour/month</li> <li>Testing: 2 hours/quarter</li> </ul>"},{"location":"maintenance/backup/#retention-policies","title":"Retention Policies","text":""},{"location":"maintenance/backup/#short-term-daily","title":"Short-Term (Daily)","text":"<ul> <li>Keep 7 days of daily backups</li> <li>Automatic deletion of older backups</li> </ul>"},{"location":"maintenance/backup/#medium-term-weekly","title":"Medium-Term (Weekly)","text":"<ul> <li>Keep 4 weeks of weekly backups</li> <li>Manually delete older backups</li> </ul>"},{"location":"maintenance/backup/#long-term-monthly","title":"Long-Term (Monthly)","text":"<ul> <li>Keep 3-12 months of monthly backups</li> <li>Archive to cheaper storage</li> </ul>"},{"location":"maintenance/backup/#script-example","title":"Script Example","text":"<pre><code>#!/bin/bash\n# cleanup_old_backups.sh\n\nBACKUP_DIR=~/IOTstack/backups\nDAYS_TO_KEEP=7\n\nfind \"$BACKUP_DIR\" -name \"*.tar.gz\" -mtime +$DAYS_TO_KEEP -delete\n</code></pre> <p>Run via cron:</p> <pre><code>0 5 * * 0 /path/to/cleanup_old_backups.sh\n</code></pre>"},{"location":"maintenance/regular-tasks/","title":"Regular Maintenance Tasks","text":"<p>This guide outlines routine maintenance to keep the system running smoothly.</p>"},{"location":"maintenance/regular-tasks/#daily-tasks","title":"Daily Tasks","text":""},{"location":"maintenance/regular-tasks/#monitor-system-status","title":"Monitor System Status","text":"<p>Check Grafana Dashboard</p> <ol> <li>Navigate to <code>http://&lt;vm_ip&gt;:3000</code></li> <li>Verify dashboard is displaying current data</li> <li>Check for data gaps or anomalies</li> </ol> <p>Check E-Ink Display</p> <ol> <li>Verify display shows latest image</li> <li>Check image quality and clarity</li> <li>Ensure refresh is occurring</li> </ol> <p>Quick Health Check</p> <pre><code># SSH to VM\nssh &lt;vm_username&gt;@&lt;vm_ip&gt;\n\n# Check all containers\ncd ~/IOTstack\ndocker compose ps\n</code></pre> <p>All should show \"Up\" status.</p>"},{"location":"maintenance/regular-tasks/#weekly-tasks","title":"Weekly Tasks","text":""},{"location":"maintenance/regular-tasks/#review-logs","title":"Review Logs","text":"<p>Node-RED Logs</p> <pre><code>docker compose logs --tail=100 nodered\n</code></pre> <p>Look for:</p> <ul> <li>HTTP request errors</li> <li>InfluxDB write failures</li> <li>SSH/SCP errors</li> </ul> <p>Grafana Logs</p> <pre><code>docker compose logs --tail=100 grafana\n</code></pre> <p>Look for:</p> <ul> <li>Render errors</li> <li>Data source issues</li> </ul> <p>InfluxDB Logs</p> <pre><code>docker compose logs --tail=100 influxdb\n</code></pre> <p>Look for:</p> <ul> <li>Memory warnings</li> <li>Write errors</li> </ul>"},{"location":"maintenance/regular-tasks/#check-disk-space","title":"Check Disk Space","text":"<p>On VM:</p> <pre><code>df -h\n</code></pre> <p>Ensure root partition has &gt;20% free.</p> <p>Docker Volumes:</p> <pre><code>docker system df\n</code></pre> <p>Shows Docker disk usage.</p>"},{"location":"maintenance/regular-tasks/#verify-backups","title":"Verify Backups","text":"<p>Check that automated backups are running:</p> <pre><code># Proxmox backups\nls -lh /path/to/backup/directory/\n\n# IOTstack backups\nls -lh ~/IOTstack/backups/\n</code></pre>"},{"location":"maintenance/regular-tasks/#check-raspberry-pi","title":"Check Raspberry Pi","text":"<pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\n\n# Disk space\ndf -h\n\n# Temperature\nvcgencmd measure_temp\n\n# Throttling\nvcgencmd get_throttled\n</code></pre> <p>Output <code>0x0</code> means no issues.</p>"},{"location":"maintenance/regular-tasks/#check-tailscale-connectivity","title":"Check Tailscale Connectivity","text":"<p>Verify VM Tailscale status:</p> <pre><code># If using Docker\ndocker exec tailscale tailscale status\n\n# If native install\nsudo tailscale status\n</code></pre> <p>Verify Pi connectivity via Tailscale:</p> <pre><code>ping -c 4 &lt;pi_tailscale_ip&gt;\n</code></pre> <p>Test SSH over Tailscale:</p> <pre><code>docker exec nodered ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'echo OK'\n</code></pre> <p>Should return \"OK\" without errors.</p>"},{"location":"maintenance/regular-tasks/#monthly-tasks","title":"Monthly Tasks","text":""},{"location":"maintenance/regular-tasks/#update-docker-images","title":"Update Docker Images","text":"<p>Pull Latest Images:</p> <pre><code>cd ~/IOTstack\ndocker compose pull\n</code></pre> <p>Apply Updates:</p> <pre><code>docker compose up -d\n</code></pre> <p>Containers will be recreated with new images.</p> <p>Verify:</p> <pre><code>docker compose ps\ndocker compose logs -f\n</code></pre> <p>Check for errors after update.</p>"},{"location":"maintenance/regular-tasks/#update-raspberry-pi-os","title":"Update Raspberry Pi OS","text":"<pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\nsudo apt update\nsudo apt upgrade -y\nsudo reboot\n</code></pre> <p>Wait for reboot, verify services:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\nsystemctl status usb-gadget\nsudo tailscale status\n</code></pre>"},{"location":"maintenance/regular-tasks/#update-proxmox-host","title":"Update Proxmox Host","text":"<pre><code>ssh root@&lt;proxmox-ip&gt;\napt update\napt dist-upgrade -y\n</code></pre> <p>Reboot if kernel updated.</p>"},{"location":"maintenance/regular-tasks/#clean-docker-system","title":"Clean Docker System","text":"<p>Remove unused images and containers:</p> <pre><code>cd ~/IOTstack\ndocker system prune -f\n</code></pre> <p>For more aggressive cleanup (removes all unused data):</p> <pre><code>docker system prune -a --volumes -f\n</code></pre> <p>Warning: This removes all unused volumes. Backup first.</p>"},{"location":"maintenance/regular-tasks/#check-influxdb-database-size","title":"Check InfluxDB Database Size","text":"<pre><code>docker exec influxdb du -sh /var/lib/influxdb\n</code></pre> <p>If size is concerning, consider:</p> <ul> <li>Implementing retention policy</li> <li>Downsampling old data</li> <li>Archiving to external storage</li> </ul>"},{"location":"maintenance/regular-tasks/#refresh-e-ink-display","title":"Refresh E-Ink Display","text":"<p>Prevent ghosting:</p> <ol> <li>Access display menu</li> <li>Settings \u2192 Display \u2192 Screen Refresh</li> <li>Run full refresh cycle</li> </ol>"},{"location":"maintenance/regular-tasks/#test-backups","title":"Test Backups","text":"<p>Periodically test backup restoration:</p> <ol> <li>Restore a Proxmox VM backup to test VM</li> <li>Verify services start correctly</li> <li>Delete test VM after verification</li> </ol>"},{"location":"maintenance/regular-tasks/#quarterly-tasks","title":"Quarterly Tasks","text":""},{"location":"maintenance/regular-tasks/#review-security","title":"Review Security","text":"<p>Update Passwords:</p> <ul> <li>Grafana admin password</li> <li>Node-RED password</li> <li>SSH keys (rotate if policy requires)</li> </ul> <p>Review Access Logs:</p> <pre><code># On VM\nsudo grep 'Failed password' /var/log/auth.log\n\n# On Raspberry Pi\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\nsudo grep 'Failed password' /var/log/auth.log\n</code></pre> <p>Check Tailscale Admin Console:</p> <ol> <li>Log in to Tailscale admin console</li> <li>Review connected devices</li> <li>Check for unauthorized devices</li> <li>Review access logs and activity</li> <li>Verify authentication keys are current</li> </ol> <p>Update Firewall Rules:</p> <p>Review and update as needed:</p> <pre><code>sudo ufw status numbered\n</code></pre>"},{"location":"maintenance/regular-tasks/#performance-review","title":"Performance Review","text":"<p>InfluxDB Queries:</p> <p>Check query performance in Grafana. Slow queries may need optimization.</p> <p>Node-RED Flow:</p> <p>Review flow for inefficiencies:</p> <ul> <li>Unnecessary nodes</li> <li>Debug nodes left active</li> <li>Excessive logging</li> </ul> <p>Resource Usage:</p> <pre><code>docker stats --no-stream\n</code></pre> <p>Note high CPU or memory usage.</p>"},{"location":"maintenance/regular-tasks/#documentation-review","title":"Documentation Review","text":"<p>Update this documentation with:</p> <ul> <li>Configuration changes</li> <li>New issues discovered</li> <li>Workarounds implemented</li> <li>Contact information updates</li> </ul>"},{"location":"maintenance/regular-tasks/#hardware-inspection","title":"Hardware Inspection","text":"<p>Physical Checks:</p> <ul> <li>Inspect cables for damage</li> <li>Check PoE switch ventilation</li> <li>Clean dust from equipment</li> <li>Verify all LEDs indicate normal operation</li> </ul> <p>Network:</p> <ul> <li>Test network speed: <code>speedtest-cli</code></li> <li>Check for packet loss: <code>ping -c 100 &lt;local_gateway_ip&gt;</code></li> <li>Review switch logs (if managed)</li> </ul>"},{"location":"maintenance/regular-tasks/#yearly-tasks","title":"Yearly Tasks","text":""},{"location":"maintenance/regular-tasks/#full-system-backup","title":"Full System Backup","text":"<p>Proxmox:</p> <ol> <li>Backup all VMs</li> <li>Export configuration</li> <li>Document any custom settings</li> </ol> <p>Node-RED:</p> <ol> <li>Export all flows</li> <li>Backup settings.js</li> <li>Document installed nodes</li> </ol> <p>Grafana:</p> <ol> <li>Export all dashboards</li> <li>Backup data sources configuration</li> <li>Document plugins</li> </ol> <p>Documentation:</p> <p>Create archive of all documentation and configuration files.</p>"},{"location":"maintenance/regular-tasks/#disaster-recovery-test","title":"Disaster Recovery Test","text":"<p>Simulate failure and recovery:</p> <ol> <li>Test VM restore from backup</li> <li>Test network failure recovery</li> <li>Test power failure recovery</li> <li>Document recovery time and issues</li> </ol>"},{"location":"maintenance/regular-tasks/#capacity-planning","title":"Capacity Planning","text":"<p>Review growth and plan for future:</p> <p>Data Growth:</p> <pre><code># InfluxDB size over time\ndocker exec influxdb influx -execute \"SHOW STATS FOR 'database'\"\n</code></pre> <p>Resource Usage Trends:</p> <p>Review historical:</p> <ul> <li>CPU usage</li> <li>Memory usage</li> <li>Disk usage</li> <li>Network bandwidth</li> </ul> <p>Plan for:</p> <ul> <li>Storage expansion</li> <li>Additional services</li> <li>Performance upgrades</li> </ul>"},{"location":"maintenance/regular-tasks/#firmware-and-software-updates","title":"Firmware and Software Updates","text":"<p>Proxmox:</p> <p>Check for major version updates: https://www.proxmox.com/</p> <p>IOTstack:</p> <p>Check for breaking changes: https://github.com/SensorsIot/IOTstack</p> <p>Samsung Display:</p> <p>Check for firmware updates from manufacturer.</p>"},{"location":"maintenance/regular-tasks/#review-slauptime","title":"Review SLA/Uptime","text":"<p>Calculate system uptime and reliability:</p> <pre><code>uptime\n</code></pre> <p>Document:</p> <ul> <li>Total uptime %</li> <li>Number of incidents</li> <li>Mean time to recovery</li> <li>Lessons learned</li> </ul>"},{"location":"maintenance/regular-tasks/#maintenance-calendar","title":"Maintenance Calendar","text":"Task Frequency Estimated Time Monitor status Daily 5 min Review logs Weekly 15 min Check backups Weekly 10 min Update Docker Monthly 30 min Update OS Monthly 30 min Security review Quarterly 1 hour Full backup Yearly 2 hours DR test Yearly 4 hours"},{"location":"maintenance/regular-tasks/#automation-opportunities","title":"Automation Opportunities","text":""},{"location":"maintenance/regular-tasks/#automated-monitoring","title":"Automated Monitoring","text":"<p>Set up alerts for:</p> <ul> <li>Container failures</li> <li>Disk space &lt;20%</li> <li>High CPU/memory</li> <li>Network issues</li> </ul> <p>Use tools like:</p> <ul> <li>Grafana alerts (email/Slack)</li> <li>Prometheus + Alertmanager</li> <li>Uptime Kuma</li> </ul>"},{"location":"maintenance/regular-tasks/#automated-backups","title":"Automated Backups","text":"<p>Schedule backups via cron:</p> <pre><code>crontab -e\n</code></pre> <p>Add:</p> <pre><code># Daily backup at 2 AM\n0 2 * * * cd ~/IOTstack &amp;&amp; ./scripts/backup.sh\n\n# Weekly cleanup at 3 AM Sunday\n0 3 * * 0 docker system prune -f\n</code></pre>"},{"location":"maintenance/regular-tasks/#automated-updates","title":"Automated Updates","text":"<p>Consider using:</p> <ul> <li>Watchtower (auto-update Docker containers)</li> <li>Unattended-upgrades (auto-update OS)</li> </ul> <p>Warning: Test in non-production first.</p>"},{"location":"maintenance/regular-tasks/#maintenance-log","title":"Maintenance Log","text":"<p>Keep a log of all maintenance activities:</p> <pre><code>Date: 2026-01-07\nTask: Monthly Docker updates\nResult: All containers updated successfully\nIssues: None\nTime: 25 minutes\n</code></pre> <p>Store in:</p> <ul> <li>Text file</li> <li>Spreadsheet</li> <li>Ticketing system</li> <li>Wiki</li> </ul>"},{"location":"maintenance/regular-tasks/#contact-information","title":"Contact Information","text":"<p>Document key contacts:</p> Role Contact Notes System Administrator Kieran Julien Primary contact System Administrator CoE HRTech Secondary contact Network (Modem) Montreal Solutions Modem management, see their guide Proxmox Support (Community/Commercial) For Proxmox issues Hardware Vendor Samsung Display support"},{"location":"maintenance/regular-tasks/#escalation-procedures","title":"Escalation Procedures","text":"<p>For critical issues:</p> <ol> <li>Level 1: Check troubleshooting guide</li> <li>Level 2: Review logs and recent changes</li> <li>Level 3: Contact system administrator</li> <li>Level 4: Engage vendor support</li> </ol> <p>Document resolution for future reference.</p>"},{"location":"maintenance/troubleshooting/","title":"Troubleshooting Guide","text":"<p>Common issues and their solutions.</p>"},{"location":"maintenance/troubleshooting/#system-wide-issues","title":"System-Wide Issues","text":""},{"location":"maintenance/troubleshooting/#all-services-offline","title":"All Services Offline","text":"<p>Symptoms:</p> <ul> <li>Cannot access Grafana, Node-RED, InfluxDB</li> <li>Docker containers not running</li> </ul> <p>Diagnosis:</p> <pre><code>ssh &lt;vm_username&gt;@&lt;vm_ip&gt;\ndocker compose ps\n</code></pre> <p>Solution:</p> <pre><code>cd ~/IOTstack\ndocker compose up -d\n</code></pre> <p>Check logs for errors:</p> <pre><code>docker compose logs -f\n</code></pre>"},{"location":"maintenance/troubleshooting/#proxmox-vm-wont-start","title":"Proxmox VM Won't Start","text":"<p>Symptoms:</p> <ul> <li>VM shows \"stopped\" status in Proxmox</li> <li>Cannot SSH to VM</li> </ul> <p>Solution:</p> <ol> <li>In Proxmox web interface, select VM</li> <li>Click Start</li> <li>Open Console to see boot messages</li> <li>If boot fails, check:</li> <li>Disk space on Proxmox host</li> <li>VM configuration (RAM, CPU limits)</li> <li>Proxmox logs: <code>journalctl -u pveproxy</code></li> </ol>"},{"location":"maintenance/troubleshooting/#network-connectivity-issues","title":"Network Connectivity Issues","text":"<p>Symptoms:</p> <ul> <li>Services cannot reach internet</li> <li>Services cannot reach each other</li> </ul> <p>Diagnosis:</p> <pre><code># Test internet\nping 8.8.8.8\n\n# Test gateway\nping &lt;local_gateway_ip&gt;\n\n# Test DNS\nnslookup google.com\n</code></pre> <p>Solution:</p> <p>Check network configuration (see VM Setup).</p> <p>If DHCP:</p> <pre><code>sudo dhclient -r  # Release\nsudo dhclient     # Renew\n</code></pre> <p>If static IP, verify gateway and DNS in network config.</p>"},{"location":"maintenance/troubleshooting/#dockercontainer-issues","title":"Docker/Container Issues","text":""},{"location":"maintenance/troubleshooting/#container-keeps-restarting","title":"Container Keeps Restarting","text":"<p>Symptoms:</p> <ul> <li>Container status shows \"Restarting\"</li> <li><code>docker compose ps</code> shows restart count increasing</li> </ul> <p>Diagnosis:</p> <pre><code>docker compose logs &lt;service-name&gt;\n</code></pre> <p>Common Causes:</p> <ol> <li>Configuration error: Check environment variables</li> <li>Port conflict: Another service using same port</li> <li>Resource limit: Container out of memory</li> </ol> <p>Solutions:</p> <p>Port Conflict:</p> <pre><code>sudo netstat -tlnp | grep &lt;port&gt;\n</code></pre> <p>Change port in <code>docker-compose.yml</code> or stop conflicting service.</p> <p>Memory Limit:</p> <p>Edit <code>docker-compose.yml</code>:</p> <pre><code>services:\n  &lt;service&gt;:\n    mem_limit: 2g\n</code></pre> <p>Restart:</p> <pre><code>docker compose up -d &lt;service&gt;\n</code></pre>"},{"location":"maintenance/troubleshooting/#container-not-starting","title":"Container Not Starting","text":"<p>Symptoms:</p> <ul> <li>Container shows \"Exited\" status</li> <li>Won't stay running</li> </ul> <p>Diagnosis:</p> <pre><code>docker compose logs --tail=50 &lt;service&gt;\n</code></pre> <p>Solutions:</p> <ol> <li>Remove and recreate:</li> </ol> <pre><code>docker compose rm -f &lt;service&gt;\ndocker compose up -d &lt;service&gt;\n</code></pre> <ol> <li>Check volume permissions:</li> </ol> <pre><code>ls -la ~/IOTstack/volumes/&lt;service&gt;/\nsudo chown -R 1000:1000 ~/IOTstack/volumes/&lt;service&gt;/\n</code></pre> <ol> <li>Pull fresh image:</li> </ol> <pre><code>docker compose pull &lt;service&gt;\ndocker compose up -d &lt;service&gt;\n</code></pre>"},{"location":"maintenance/troubleshooting/#docker-disk-full","title":"Docker Disk Full","text":"<p>Symptoms:</p> <ul> <li>\"no space left on device\" errors</li> <li>Containers failing to start</li> </ul> <p>Diagnosis:</p> <pre><code>df -h\ndocker system df\n</code></pre> <p>Solution:</p> <pre><code># Remove unused containers, networks, images\ndocker system prune -a\n\n# For aggressive cleanup (includes volumes)\ndocker system prune -a --volumes\n</code></pre> <p>Warning: Backup first if removing volumes.</p>"},{"location":"maintenance/troubleshooting/#node-red-issues","title":"Node-RED Issues","text":""},{"location":"maintenance/troubleshooting/#flow-not-running","title":"Flow Not Running","text":"<p>Symptoms:</p> <ul> <li>Inject nodes don't trigger</li> <li>No data flowing through</li> </ul> <p>Diagnosis:</p> <ol> <li>Check Node-RED is running:</li> </ol> <pre><code>docker compose ps nodered\n</code></pre> <ol> <li>Open Node-RED UI: <code>http://&lt;vm_ip&gt;:1880</code></li> <li>Check deploy status (should say \"Deployed\")</li> </ol> <p>Solution:</p> <ol> <li>Click Deploy button</li> <li>Check for errors in debug panel</li> <li>Verify inject nodes are enabled (blue badge under node)</li> </ol>"},{"location":"maintenance/troubleshooting/#http-request-timeout","title":"HTTP Request Timeout","text":"<p>Symptoms:</p> <ul> <li>Weather API or eGauge requests failing</li> <li>\"timeout\" errors in debug</li> </ul> <p>Diagnosis:</p> <p>Check debug output:</p> <pre><code>\"Error: timeout of 60000ms exceeded\"\n</code></pre> <p>Solution:</p> <ol> <li>Test URL manually:</li> </ol> <pre><code>curl \"https://weerlive.nl/api/weerlive_api_v2.php?key=3c2224ecab&amp;locatie=51.89908,4.42348\"\n</code></pre> <ol> <li>Increase timeout in HTTP request node:</li> <li>Double-click node</li> <li>Set timeout to 120 seconds</li> <li> <p>Deploy</p> </li> <li> <p>Check network connectivity from VM</p> </li> </ol>"},{"location":"maintenance/troubleshooting/#influxdb-write-failures","title":"InfluxDB Write Failures","text":"<p>Symptoms:</p> <ul> <li>Debug shows \"Failed to write to InfluxDB\"</li> <li>Data not appearing in Grafana</li> </ul> <p>Diagnosis:</p> <pre><code># Test InfluxDB reachable\ncurl http://influxdb:8086/ping\n</code></pre> <p>If running outside Node-RED:</p> <pre><code>docker exec nodered curl http://influxdb:8086/ping\n</code></pre> <p>Solution:</p> <ol> <li>Verify InfluxDB is running:</li> </ol> <pre><code>docker compose ps influxdb\ndocker compose logs influxdb\n</code></pre> <ol> <li>Check database exists:</li> </ol> <pre><code>docker exec influxdb influx -execute \"SHOW DATABASES\"\n</code></pre> <p>If <code>iot_data</code> missing:</p> <pre><code>docker exec influxdb influx -execute \"CREATE DATABASE iot_data\"\n</code></pre> <ol> <li>Verify InfluxDB node configuration:</li> <li>Server: <code>influxdb</code></li> <li>Port: <code>8086</code></li> <li>Database: <code>iot_data</code></li> </ol>"},{"location":"maintenance/troubleshooting/#sshscp-to-raspberry-pi-fails","title":"SSH/SCP to Raspberry Pi Fails","text":"<p>Symptoms:</p> <ul> <li>\"Permission denied\" errors</li> <li>\"Connection refused\"</li> <li>SCP command fails in exec node</li> </ul> <p>Diagnosis:</p> <p>Test SSH manually:</p> <pre><code>docker exec nodered ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'echo test'\n</code></pre> <p>Solution:</p> <p>See SSH Configuration for complete setup.</p> <p>Quick checks:</p> <ol> <li>Tailscale is connected:</li> </ol> <pre><code># On VM (if Docker)\ndocker exec tailscale tailscale status\n\n# On VM (if native)\nsudo tailscale status\n\n# On Pi\nsudo tailscale status\n</code></pre> <ol> <li>Pi is reachable via Tailscale:</li> </ol> <pre><code>ping &lt;pi_tailscale_ip&gt;  # e.g., ping 100.64.1.5\n</code></pre> <ol> <li>SSH keys configured:</li> </ol> <pre><code>docker exec nodered ls -la /root/.ssh/\n</code></pre> <p>Should show <code>id_ed25519</code> and <code>id_ed25519.pub</code>.</p> <ol> <li>Known hosts:</li> </ol> <pre><code>docker exec nodered ssh-keyscan -H &lt;pi_tailscale_ip&gt; &gt;&gt; /root/.ssh/known_hosts\n</code></pre> <ol> <li>SSH volume mounted:</li> </ol> <p>Check <code>docker-compose.yml</code> has: <pre><code>volumes:\n  - /home/&lt;user&gt;/.ssh:/root/.ssh:ro\n</code></pre></p>"},{"location":"maintenance/troubleshooting/#grafana-issues","title":"Grafana Issues","text":""},{"location":"maintenance/troubleshooting/#cant-login","title":"Can't Login","text":"<p>Symptoms:</p> <ul> <li>Forgot admin password</li> <li>Login page not loading</li> </ul> <p>Solution:</p> <p>Reset Password:</p> <pre><code>docker exec -it grafana grafana-cli admin reset-admin-password newpassword\n</code></pre> <p>Replace <code>newpassword</code> with your new password.</p> <p>Login Page Not Loading:</p> <p>Check Grafana is running:</p> <pre><code>docker compose ps grafana\ndocker compose logs grafana\n</code></pre> <p>Restart:</p> <pre><code>docker compose restart grafana\n</code></pre>"},{"location":"maintenance/troubleshooting/#dashboard-shows-no-data","title":"Dashboard Shows \"No Data\"","text":"<p>Symptoms:</p> <ul> <li>Dashboard panels empty</li> <li>Shows \"No data\" message</li> </ul> <p>Diagnosis:</p> <ol> <li>Check data source: Configuration \u2192 Data Sources \u2192 InfluxDB-IoT \u2192 Test</li> <li>Verify data exists:</li> </ol> <pre><code>docker exec influxdb influx -execute \"SELECT * FROM weather LIMIT 5\"\n</code></pre> <ol> <li>Check time range: Dashboard may be showing wrong time period</li> </ol> <p>Solution:</p> <ol> <li>Adjust time range: Top right corner, select \"Last 3 hours\"</li> <li>Check query: Edit panel \u2192 View query \u2192 Fix any syntax errors</li> <li>Refresh: Click refresh button or Ctrl+R</li> </ol>"},{"location":"maintenance/troubleshooting/#image-rendering-fails","title":"Image Rendering Fails","text":"<p>Symptoms:</p> <ul> <li>Node-RED shows render errors</li> <li>Images not generated</li> </ul> <p>Diagnosis:</p> <pre><code>docker compose ps grafana-image-renderer\ndocker compose logs grafana-image-renderer\n</code></pre> <p>Solution:</p> <ol> <li>Verify renderer is running:</li> </ol> <pre><code>docker compose up -d grafana-image-renderer\n</code></pre> <ol> <li>Check token matches:</li> </ol> <p>In <code>docker-compose.yml</code>, verify:</p> <ul> <li>Grafana: <code>GF_RENDERING_RENDERER_TOKEN</code></li> <li>Renderer: <code>AUTH_TOKEN</code></li> </ul> <p>Are identical.</p> <ol> <li>Test renderer directly:</li> </ol> <pre><code>curl -H \"Authorization: Bearer &lt;token&gt;\" \\\n  \"http://&lt;vm_ip&gt;:8081/\" \n</code></pre> <p>Should return \"Grafana Image Renderer\".</p>"},{"location":"maintenance/troubleshooting/#influxdb-issues","title":"InfluxDB Issues","text":""},{"location":"maintenance/troubleshooting/#database-not-found","title":"Database Not Found","text":"<p>Symptoms:</p> <ul> <li>\"database not found\" errors</li> <li>Grafana can't connect</li> </ul> <p>Solution:</p> <pre><code>docker exec influxdb influx -execute \"CREATE DATABASE iot_data\"\n</code></pre> <p>Verify:</p> <pre><code>docker exec influxdb influx -execute \"SHOW DATABASES\"\n</code></pre>"},{"location":"maintenance/troubleshooting/#high-memory-usage","title":"High Memory Usage","text":"<p>Symptoms:</p> <ul> <li>InfluxDB container using &gt;80% memory</li> <li>Slow queries</li> </ul> <p>Diagnosis:</p> <pre><code>docker stats influxdb --no-stream\n</code></pre> <p>Solution:</p> <ol> <li>Increase memory limit:</li> </ol> <p>Edit <code>docker-compose.yml</code>:</p> <pre><code>influxdb:\n  mem_limit: 2g\n</code></pre> <p>Restart:</p> <pre><code>docker compose up -d influxdb\n</code></pre> <ol> <li>Implement retention policy:</li> </ol> <pre><code>docker exec influxdb influx -execute \\\n  \"CREATE RETENTION POLICY 90_days ON iot_data DURATION 90d REPLICATION 1 DEFAULT\"\n</code></pre> <ol> <li>Downsample old data (see InfluxDB docs)</li> </ol>"},{"location":"maintenance/troubleshooting/#raspberry-pi-issues","title":"Raspberry Pi Issues","text":""},{"location":"maintenance/troubleshooting/#pi-not-reachable","title":"Pi Not Reachable","text":"<p>Symptoms:</p> <ul> <li>Cannot SSH to Pi</li> <li>Ping fails</li> </ul> <p>Diagnosis:</p> <pre><code># Test via Tailscale\nping &lt;pi_tailscale_ip&gt;  # e.g., ping 100.64.1.5\n\n# Test via local network (if on same network)\nping &lt;pi_local_ip&gt;  # e.g., ping 192.168.178.148\n</code></pre> <p>Solution:</p> <ol> <li>Check Tailscale connectivity:</li> </ol> <pre><code># On VM (Docker)\ndocker exec tailscale tailscale status\n\n# On VM (native)\nsudo tailscale status\n</code></pre> <p>Verify Pi is shown as online in the status output.</p> <ol> <li> <p>Check physical connection: PoE+ cable connected?</p> </li> <li> <p>Check PoE+ power: LEDs on Pi should be lit</p> </li> <li> <p>Check Tailscale on Pi:</p> </li> </ol> <p>Connect via monitor/keyboard or local network:</p> <pre><code>sudo tailscale status\n</code></pre> <p>If not connected:</p> <pre><code>sudo tailscale up\n</code></pre> <ol> <li>Check network configuration on Pi:</li> </ol> <pre><code>ip a\n</code></pre> <p>Verify both local IP and Tailscale IP are assigned.</p> <ol> <li>Restart Pi:</li> </ol> <pre><code>sudo reboot\n</code></pre> <p>Or power cycle (unplug PoE, wait, replug).</p>"},{"location":"maintenance/troubleshooting/#usb-gadget-not-working","title":"USB Gadget Not Working","text":"<p>Symptoms:</p> <ul> <li>Display doesn't detect USB drive</li> <li>Files not accessible</li> </ul> <p>Diagnosis:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'cat /sys/kernel/config/usb_gadget/EInkGadget/UDC'\n</code></pre> <p>Should show UDC name, not empty.</p> <p>Solution:</p> <ol> <li>Restart gadget service:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo systemctl restart usb-gadget'\n</code></pre> <ol> <li>Check gadget script:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo /usr/local/bin/gadget.sh'\n</code></pre> <p>Check for errors.</p> <ol> <li>Verify module loaded:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'lsmod | grep -E \"dwc2|libcomposite\"'\n</code></pre> <p>If missing:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo modprobe dwc2 &amp;&amp; sudo modprobe libcomposite'\n</code></pre> <ol> <li>Check cable: Try different USB-C cable</li> </ol>"},{"location":"maintenance/troubleshooting/#image-not-updating-on-display","title":"Image Not Updating on Display","text":"<p>Symptoms:</p> <ul> <li>Old image still showing</li> <li>New image transferred but not displayed</li> </ul> <p>Diagnosis:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'ls -lh /home/&lt;pi_username&gt;/eink_usb/SAMSUNG_E-Paper/'\n</code></pre> <p>Verify new image exists.</p> <p>Solution:</p> <ol> <li>Run refresh script:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; '/home/&lt;pi_username&gt;/refresh_script.sh'\n</code></pre> <ol> <li>Check script output for errors</li> <li>Manually refresh display: Use display menu to refresh</li> <li>Verify USB is bound:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'cat /sys/kernel/config/usb_gadget/EInkGadget/UDC'\n</code></pre> <p>Should not be empty.</p>"},{"location":"maintenance/troubleshooting/#tailscale-issues","title":"Tailscale Issues","text":""},{"location":"maintenance/troubleshooting/#tailscale-not-connected","title":"Tailscale Not Connected","text":"<p>Symptoms:</p> <ul> <li>Cannot ping Tailscale IPs</li> <li>SSH fails over Tailscale</li> <li><code>tailscale status</code> shows offline</li> </ul> <p>Diagnosis:</p> <p>On VM (Docker):</p> <pre><code>docker ps | grep tailscale\ndocker exec tailscale tailscale status\n</code></pre> <p>On VM (native) or Pi:</p> <pre><code>sudo tailscale status\n</code></pre> <p>Solution:</p> <p>If Docker container not running:</p> <pre><code>cd ~/IOTstack\ndocker compose up -d tailscale\n</code></pre> <p>If not authenticated:</p> <pre><code># Docker\ndocker exec tailscale tailscale up\n\n# Native\nsudo tailscale up\n</code></pre> <p>Follow the authentication link in your browser.</p> <p>If service stopped (native install):</p> <pre><code>sudo systemctl start tailscaled\nsudo systemctl enable tailscaled\n</code></pre>"},{"location":"maintenance/troubleshooting/#tailscale-ip-changed","title":"Tailscale IP Changed","text":"<p>Symptoms:</p> <ul> <li>SSH suddenly fails</li> <li>Node-RED can't connect to Pi</li> </ul> <p>Diagnosis:</p> <p>Get current IPs:</p> <pre><code># On VM\ndocker exec tailscale tailscale ip -4  # or: tailscale ip -4\n\n# On Pi\ntailscale ip -4\n</code></pre> <p>Solution:</p> <p>Tailscale IPs are normally persistent, but if changed:</p> <ol> <li>Update Node-RED flows with new Pi Tailscale IP</li> <li>Update known_hosts:</li> </ol> <pre><code>docker exec nodered ssh-keyscan -H &lt;new_pi_tailscale_ip&gt; &gt;&gt; /root/.ssh/known_hosts\n</code></pre> <ol> <li>Test connection:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;new_pi_tailscale_ip&gt;\n</code></pre>"},{"location":"maintenance/troubleshooting/#tailscale-firewall-blocked","title":"Tailscale Firewall Blocked","text":"<p>Symptoms:</p> <ul> <li>Tailscale won't connect</li> <li>Shows \"connecting\" but never succeeds</li> </ul> <p>Diagnosis:</p> <p>Tailscale needs outbound HTTPS (443) and UDP (41641) access.</p> <p>Solution:</p> <ol> <li>Check firewall rules on VM and Pi</li> <li>Contact network administrator if on restricted network</li> <li>Try different network to isolate issue</li> <li>Check logs:</li> </ol> <pre><code># Docker\ndocker logs tailscale\n\n# Native\nsudo journalctl -u tailscaled -n 50\n</code></pre>"},{"location":"maintenance/troubleshooting/#devices-cant-see-each-other","title":"Devices Can't See Each Other","text":"<p>Symptoms:</p> <ul> <li>Both devices online in Tailscale</li> <li>Can't ping each other</li> </ul> <p>Diagnosis:</p> <pre><code># From VM\nping &lt;pi_tailscale_ip&gt;\n\n# From Pi\nping &lt;vm_tailscale_ip&gt;\n</code></pre> <p>Solution:</p> <ol> <li>Check ACLs in Tailscale admin console:</li> <li>Go to https://login.tailscale.com/admin/acls</li> <li> <p>Ensure devices can communicate</p> </li> <li> <p>Verify both on same tailnet:</p> </li> </ol> <pre><code>tailscale status\n</code></pre> <p>Check the tailnet name matches.</p> <ol> <li>Restart Tailscale on both devices:</li> </ol> <pre><code># Docker (VM)\ndocker compose restart tailscale\n\n# Native (Pi)\nsudo systemctl restart tailscaled\n</code></pre>"},{"location":"maintenance/troubleshooting/#display-issues","title":"Display Issues","text":""},{"location":"maintenance/troubleshooting/#display-not-powering-on","title":"Display Not Powering On","text":"<p>See PoE Troubleshooting.</p>"},{"location":"maintenance/troubleshooting/#display-showing-wrong-image","title":"Display Showing Wrong Image","text":"<p>Symptoms:</p> <ul> <li>Old image displayed</li> <li>Image from wrong source</li> </ul> <p>Solution:</p> <ol> <li>Check display source: Ensure USB mode is selected</li> <li>Refresh display: Manually trigger refresh</li> <li>Verify image on USB:</li> </ol> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo mount -o loop /home/&lt;pi_username&gt;/drive.bin /mnt &amp;&amp; ls -lh /mnt/SAMSUNG_E-Paper/ &amp;&amp; sudo umount /mnt'\n</code></pre>"},{"location":"maintenance/troubleshooting/#ghosting-on-display","title":"Ghosting on Display","text":"<p>Symptoms:</p> <ul> <li>Previous image faintly visible</li> <li>Image blurry or overlapping</li> </ul> <p>Solution:</p> <ol> <li>Run full refresh: Display menu \u2192 Screen Refresh</li> <li>Enable full refresh mode: Display settings \u2192 Refresh Mode \u2192 Full</li> <li>Vary content: Avoid static images for long periods</li> </ol>"},{"location":"maintenance/troubleshooting/#performance-issues","title":"Performance Issues","text":""},{"location":"maintenance/troubleshooting/#slow-response-times","title":"Slow Response Times","text":"<p>Symptoms:</p> <ul> <li>Grafana slow to load</li> <li>Node-RED UI laggy</li> <li>API requests timing out</li> </ul> <p>Diagnosis:</p> <pre><code>docker stats --no-stream\ntop\nhtop\n</code></pre> <p>Check CPU and memory usage.</p> <p>Solution:</p> <ol> <li>Increase VM resources in Proxmox:</li> <li>More CPU cores</li> <li> <p>More RAM (8GB recommended)</p> </li> <li> <p>Optimize queries in Grafana (use appropriate time ranges)</p> </li> <li> <p>Reduce Node-RED flow complexity</p> </li> <li> <p>Clean Docker:</p> </li> </ol> <pre><code>docker system prune -a\n</code></pre>"},{"location":"maintenance/troubleshooting/#high-disk-io","title":"High Disk I/O","text":"<p>Diagnosis:</p> <pre><code>iotop\n</code></pre> <p>Solution:</p> <ul> <li>Implement InfluxDB retention policy</li> <li>Move Docker volumes to faster storage (SSD)</li> <li>Reduce write frequency in Node-RED</li> </ul>"},{"location":"maintenance/troubleshooting/#data-issues","title":"Data Issues","text":""},{"location":"maintenance/troubleshooting/#missing-data-in-grafana","title":"Missing Data in Grafana","text":"<p>Symptoms:</p> <ul> <li>Gaps in graphs</li> <li>Some fields missing</li> </ul> <p>Diagnosis:</p> <pre><code>docker exec influxdb influx -execute \\\n  \"SELECT * FROM turbine ORDER BY time DESC LIMIT 10\"\n</code></pre> <p>Solution:</p> <ol> <li>Check Node-RED is running and flows deployed</li> <li>Review Node-RED debug for API errors</li> <li>Verify APIs are accessible:</li> </ol> <pre><code>curl \"https://weerlive.nl/api/weerlive_api_v2.php?key=3c2224ecab&amp;locatie=51.89908,4.42348\"\n</code></pre>"},{"location":"maintenance/troubleshooting/#incorrect-data-values","title":"Incorrect Data Values","text":"<p>Symptoms:</p> <ul> <li>Values don't make sense</li> <li>Null or NaN values</li> </ul> <p>Diagnosis:</p> <p>Check Node-RED function node for parsing errors:</p> <ul> <li>Enable debug on function output</li> <li>Verify field names match database</li> </ul> <p>Solution:</p> <p>Review and fix function node code (see Node-RED Configuration).</p>"},{"location":"maintenance/troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"maintenance/troubleshooting/#collect-information","title":"Collect Information","text":"<p>Before seeking help, gather:</p> <ol> <li>Error messages from logs</li> <li>Docker status: <code>docker compose ps</code></li> <li>System info: <code>uname -a</code>, <code>df -h</code></li> <li>Recent changes made to system</li> </ol>"},{"location":"maintenance/troubleshooting/#resources","title":"Resources","text":"<ul> <li>IOTstack GitHub: Issues</li> <li>Node-RED Forum: https://discourse.nodered.org/</li> <li>Grafana Community: https://community.grafana.com/</li> <li>InfluxDB Forums: https://community.influxdata.com/</li> </ul>"},{"location":"maintenance/troubleshooting/#create-support-ticket","title":"Create Support Ticket","text":"<p>Include:</p> <ul> <li>Problem description</li> <li>Steps to reproduce</li> <li>Logs (relevant sections)</li> <li>System configuration</li> <li>What you've tried</li> </ul>"},{"location":"maintenance/troubleshooting/#emergency-procedures","title":"Emergency Procedures","text":""},{"location":"maintenance/troubleshooting/#system-recovery","title":"System Recovery","text":"<p>If system is completely broken:</p> <ol> <li>Restore from Proxmox backup</li> <li>Verify services start</li> <li>Test each component</li> <li>Review what caused failure</li> <li>Update procedures to prevent recurrence</li> </ol>"},{"location":"maintenance/troubleshooting/#data-loss","title":"Data Loss","text":"<p>If InfluxDB data is lost:</p> <ol> <li>Restore from backup (if available)</li> <li>Accept data loss and start fresh</li> <li>Implement better backup strategy going forward</li> </ol>"},{"location":"maintenance/troubleshooting/#hardware-failure","title":"Hardware Failure","text":"<ol> <li>Identify failed component</li> <li>Source replacement</li> <li>Install and configure</li> <li>Restore from backups</li> <li>Document in maintenance log</li> </ol>"},{"location":"raspberry-pi/gadget-mode/","title":"USB Gadget Mode Setup","text":"<p>This guide configures a Raspberry Pi as a USB mass storage device to deliver images to the Samsung E-Ink display.</p>"},{"location":"raspberry-pi/gadget-mode/#prerequisites","title":"Prerequisites","text":"<ul> <li>Raspberry Pi 4 (or Pi Zero W/2W)</li> <li>Raspberry Pi OS Lite installed</li> <li>PoE+ HAT for power and network</li> <li>USB-C cable to display</li> </ul>"},{"location":"raspberry-pi/gadget-mode/#enable-usb-gadget-mode","title":"Enable USB Gadget Mode","text":"<p>This setup uses ConfigFS/usb_gadget, which is the modern way to configure USB OTG on Raspberry Pi. It's more flexible than the legacy <code>g_mass_storage</code> method and allows composing multiple USB functions.</p>"},{"location":"raspberry-pi/gadget-mode/#1-enable-dwc2-overlay","title":"1. Enable dwc2 Overlay","text":"<p>Edit <code>/boot/config.txt</code>:</p> <pre><code>sudo nano /boot/config.txt\n</code></pre> <p>Add at the end:</p> <pre><code>dtoverlay=dwc2,dr_mode=peripheral\n</code></pre> <p>The <code>dr_mode=peripheral</code> parameter sets the USB controller to peripheral (device) mode.</p>"},{"location":"raspberry-pi/gadget-mode/#2-load-dwc2-module-on-boot","title":"2. Load dwc2 Module on Boot","text":"<p>Edit <code>/etc/modules</code>:</p> <pre><code>sudo nano /etc/modules\n</code></pre> <p>Add to the end:</p> <pre><code>dwc2\n</code></pre> <p>This ensures the USB controller driver loads at startup.</p>"},{"location":"raspberry-pi/gadget-mode/#3-verify-configfs-is-mounted","title":"3. Verify ConfigFS is Mounted","text":"<p>ConfigFS should be mounted by default on Raspberry Pi OS:</p> <pre><code>mount | grep configfs\n</code></pre> <p>Should show: <code>configfs on /sys/kernel/config type configfs</code></p> <p>If not mounted, mount it:</p> <pre><code>sudo mount -t configfs none /sys/kernel/config\n</code></pre> <p>To make it permanent, add to <code>/etc/fstab</code>:</p> <pre><code>configfs  /sys/kernel/config  configfs  defaults  0  0\n</code></pre>"},{"location":"raspberry-pi/gadget-mode/#4-reboot","title":"4. Reboot","text":"<pre><code>sudo reboot\n</code></pre>"},{"location":"raspberry-pi/gadget-mode/#create-mass-storage-file","title":"Create Mass Storage File","text":""},{"location":"raspberry-pi/gadget-mode/#create-backing-file","title":"Create Backing File","text":"<p>Create a 100MB disk image:</p> <pre><code>sudo dd if=/dev/zero of=/home/&lt;pi_username&gt;/drive.bin bs=1M count=100\n</code></pre>"},{"location":"raspberry-pi/gadget-mode/#format-as-fat32","title":"Format as FAT32","text":"<pre><code>sudo mkfs.vfat /home/&lt;pi_username&gt;/drive.bin\n</code></pre>"},{"location":"raspberry-pi/gadget-mode/#mount-and-create-folder","title":"Mount and Create Folder","text":"<pre><code>sudo mkdir -p /mnt/usb_drive\nsudo mount -o loop /home/&lt;pi_username&gt;/drive.bin /mnt/usb_drive\nsudo mkdir -p /mnt/usb_drive/SAMSUNG_E-Paper\nsudo umount /mnt/usb_drive\n</code></pre> <p>The folder <code>SAMSUNG_E-Paper</code> is required by the Samsung display.</p>"},{"location":"raspberry-pi/gadget-mode/#configure-usb-gadget","title":"Configure USB Gadget","text":"<p>The gadget configuration uses ConfigFS to create a mass storage device. This is done via the <code>gadget.sh</code> script.</p>"},{"location":"raspberry-pi/gadget-mode/#understanding-configfs-structure","title":"Understanding ConfigFS Structure","text":"<p>ConfigFS creates a virtual file system under <code>/sys/kernel/config/usb_gadget/</code> where:</p> <ul> <li>Each gadget is a directory (e.g., <code>EInkGadget</code>)</li> <li>Configuration is done by writing to files</li> <li>Functions (mass storage, ethernet, serial) are in <code>functions/</code></li> <li>Configurations link functions together</li> <li>The gadget is activated by writing to the <code>UDC</code> file</li> </ul>"},{"location":"raspberry-pi/gadget-mode/#install-gadgetsh","title":"Install gadget.sh","text":"<p>Create the script at <code>/usr/local/bin/gadget.sh</code>:</p> <pre><code>sudo nano /usr/local/bin/gadget.sh\n</code></pre> <p>Paste the contents of <code>gadget.sh</code> (see Shell Scripts for complete code).</p> <p>Key points:</p> <ul> <li>Loads <code>libcomposite</code> kernel module</li> <li>Creates gadget under <code>/sys/kernel/config/usb_gadget/EInkGadget</code></li> <li>Configures USB IDs, strings, and mass storage function</li> <li>Binds to USB Device Controller (UDC)</li> </ul> <p>Make executable:</p> <pre><code>sudo chmod +x /usr/local/bin/gadget.sh\n</code></pre>"},{"location":"raspberry-pi/gadget-mode/#run-on-boot","title":"Run on Boot","text":"<p>Create systemd service at <code>/lib/systemd/system/usb-gadget.service</code>:</p> <pre><code>sudo nano /lib/systemd/system/usb-gadget.service\n</code></pre> <p>Content:</p> <pre><code>[Unit]\nDescription=USB Gadget Mode Configuration\nAfter=systemd-user-sessions.service\n\n[Service]\nType=oneshot\nExecStart=/usr/local/bin/gadget.sh\nRemainAfterExit=yes\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Notes:</p> <ul> <li><code>After=systemd-user-sessions.service</code> ensures user sessions are ready</li> <li><code>Type=oneshot</code> means script runs once and exits</li> <li><code>RemainAfterExit=yes</code> keeps service marked as active</li> </ul> <p>Enable and start:</p> <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable usb-gadget.service\nsudo systemctl start usb-gadget.service\n</code></pre> <p>Verify:</p> <pre><code>sudo systemctl status usb-gadget.service\n</code></pre> <p>Should show \"active (exited)\" with no errors.</p>"},{"location":"raspberry-pi/gadget-mode/#verify-gadget-mode","title":"Verify Gadget Mode","text":""},{"location":"raspberry-pi/gadget-mode/#check-usb-controller","title":"Check USB Controller","text":"<pre><code>ls /sys/class/udc\n</code></pre> <p>Should show the UDC (e.g., <code>fe980000.usb</code>).</p>"},{"location":"raspberry-pi/gadget-mode/#check-gadget-directory","title":"Check Gadget Directory","text":"<pre><code>ls /sys/kernel/config/usb_gadget/EInkGadget/\n</code></pre> <p>Should show configuration directories.</p>"},{"location":"raspberry-pi/gadget-mode/#check-usb-binding","title":"Check USB Binding","text":"<pre><code>cat /sys/kernel/config/usb_gadget/EInkGadget/UDC\n</code></pre> <p>Should show the UDC name (not empty).</p>"},{"location":"raspberry-pi/gadget-mode/#connect-to-display","title":"Connect to Display","text":"<ol> <li>Connect USB-C cable from Pi to display</li> <li>Display should detect mass storage device</li> <li>Check display's USB mode settings</li> <li>Should show \"SAMSUNG_E-Paper\" folder</li> </ol>"},{"location":"raspberry-pi/gadget-mode/#testing","title":"Testing","text":""},{"location":"raspberry-pi/gadget-mode/#manually-add-image","title":"Manually Add Image","text":"<p>Mount the drive:</p> <pre><code>sudo mount -o loop /home/&lt;pi_username&gt;/drive.bin /mnt/usb_drive\n</code></pre> <p>Copy a test image:</p> <pre><code>sudo cp /path/to/test.png /mnt/usb_drive/SAMSUNG_E-Paper/001.png\n</code></pre> <p>Unmount:</p> <pre><code>sudo umount /mnt/usb_drive\n</code></pre> <p>Refresh display to see image.</p>"},{"location":"raspberry-pi/gadget-mode/#troubleshooting","title":"Troubleshooting","text":""},{"location":"raspberry-pi/gadget-mode/#gadget-not-created","title":"Gadget Not Created","text":"<p>Check kernel modules:</p> <pre><code>lsmod | grep -E 'dwc2|libcomposite'\n</code></pre> <p>Should show both modules loaded.</p> <p>If <code>dwc2</code> missing:</p> <pre><code>sudo modprobe dwc2\n</code></pre> <p>Check <code>/etc/modules</code> contains <code>dwc2</code>.</p> <p>If <code>libcomposite</code> missing, the gadget script loads it automatically.</p>"},{"location":"raspberry-pi/gadget-mode/#udc-not-found","title":"UDC Not Found","text":"<p>Verify <code>/boot/config.txt</code> has <code>dtoverlay=dwc2,dr_mode=peripheral</code>.</p> <p>Check:</p> <pre><code>ls /sys/class/udc\n</code></pre> <p>Should show device like <code>fe980000.usb</code> (Pi 4) or similar.</p> <p>If empty:</p> <ul> <li>Reboot: <code>sudo reboot</code></li> <li>Check Pi model (Pi 4, Pi Zero W/2W have OTG support)</li> <li>Verify using correct USB port (USB-C port on Pi 4)</li> </ul>"},{"location":"raspberry-pi/gadget-mode/#configfs-not-mounted","title":"ConfigFS Not Mounted","text":"<p>Check if mounted:</p> <pre><code>mount | grep configfs\n</code></pre> <p>If not mounted:</p> <pre><code>sudo mount -t configfs none /sys/kernel/config\n</code></pre> <p>Add to <code>/etc/fstab</code> for persistence.</p>"},{"location":"raspberry-pi/gadget-mode/#display-not-detecting","title":"Display Not Detecting","text":"<ol> <li>Check USB cable (must support data, not just power)</li> <li>Try different USB-C port on Pi (use the peripheral port, not power)</li> <li>Check display USB mode settings</li> <li>Verify gadget is bound: <code>cat /sys/kernel/config/usb_gadget/EInkGadget/UDC</code></li> </ol>"},{"location":"raspberry-pi/gadget-mode/#permission-errors","title":"Permission Errors","text":"<p>Ensure scripts run as root or with sudo:</p> <pre><code>sudo /usr/local/bin/gadget.sh\n</code></pre>"},{"location":"raspberry-pi/gadget-mode/#advanced-multiple-usb-functions","title":"Advanced: Multiple USB Functions","text":"<p>ConfigFS allows combining multiple USB functions. For example, to add both mass storage and serial console:</p> <pre><code># In gadget.sh, after creating mass_storage.usb0:\n\n# Add serial function\nmkdir functions/acm.usb0\n\n# Link both functions to configuration\nln -s functions/mass_storage.usb0 configs/c.1/\nln -s functions/acm.usb0 configs/c.1/\n</code></pre> <p>The Pi will appear as both a USB drive and a serial device.</p> <p>Other available functions:</p> <ul> <li><code>rndis.usb0</code> - Ethernet over USB (Windows)</li> <li><code>ecm.usb0</code> - Ethernet over USB (Linux/Mac)</li> <li><code>acm.usb0</code> - Serial console</li> <li><code>hid.usb0</code> - Keyboard/Mouse emulation</li> </ul> <p>See Linux USB Gadget documentation for more.</p>"},{"location":"raspberry-pi/gadget-mode/#security-notes","title":"Security Notes","text":"<ul> <li>Scripts require root access</li> <li>Secure SSH access to Pi</li> <li>Use key-based authentication only</li> <li>Disable password authentication</li> </ul> <p>See SSH Configuration.</p>"},{"location":"raspberry-pi/gadget-mode/#resources","title":"Resources","text":"<ul> <li>Official ConfigFS docs: https://docs.kernel.org/driver-api/usb/gadget.html</li> <li>Kernel ConfigFS USB Gadget: https://www.kernel.org/doc/Documentation/ABI/testing/configfs-usb-gadget</li> <li>Raspberry Pi USB OTG: https://www.raspberrypi.com/documentation/computers/raspberry-pi.html</li> </ul>"},{"location":"raspberry-pi/gadget-mode/#next-steps","title":"Next Steps","text":"<ul> <li>Configure shell scripts for automated image handling</li> <li>Set up SSH access from Node-RED</li> </ul>"},{"location":"raspberry-pi/scripts/","title":"Shell Scripts","text":"<p>The Raspberry Pi uses shell scripts to manage image processing and USB mass storage updates.</p>"},{"location":"raspberry-pi/scripts/#script-overview","title":"Script Overview","text":"Script Purpose Triggered By <code>gadget.sh</code> Configure USB gadget mode System boot (systemd) <code>refresh_script.sh</code> Resize, update, and refresh display images Node-RED via SSH <p>Critical: Replace Placeholders in Scripts</p> <p>All scripts below contain <code>&lt;pi_username&gt;</code> as a placeholder. You MUST replace this with your actual Raspberry Pi username (e.g., <code>hrtech</code>, <code>pi</code>, etc.) when creating the scripts, otherwise they will not work.</p>"},{"location":"raspberry-pi/scripts/#gadgetsh","title":"gadget.sh","text":"<p>Purpose: Configure the Raspberry Pi as a USB mass storage device.</p> <p>Location: <code>/usr/local/bin/gadget.sh</code></p> <p>Run by: systemd on boot</p>"},{"location":"raspberry-pi/scripts/#complete-script","title":"Complete Script","text":"<pre><code>#!/bin/bash\nmodprobe libcomposite\ncd /sys/kernel/config/usb_gadget || exit\n\nmkdir -p EInkGadget\ncd EInkGadget || exit\n\n# Vendor/Product IDs\necho 0x1d6b &gt; idVendor\necho 0x0104 &gt; idProduct\necho 0x0100 &gt; bcdDevice\necho 0x0200 &gt; bcdUSB\n\n# Strings\nmkdir -p strings/0x409\necho \"RaspberryPi\" &gt; strings/0x409/manufacturer\necho \"EInkUSB\" &gt; strings/0x409/product\nSERIAL=$(awk '/Serial/ {print $3}' /proc/cpuinfo)\necho \"$SERIAL\" &gt; strings/0x409/serialnumber\n\n# Configuration\nmkdir -p configs/c.1/strings/0x409\necho 120 &gt; configs/c.1/MaxPower\necho \"Config 1\" &gt; configs/c.1/strings/0x409/configuration\n\n# Mass storage function\nmkdir -p functions/mass_storage.usb0\necho \"/home/&lt;pi_username&gt;/drive.bin\" &gt; functions/mass_storage.usb0/lun.0/file\necho 1 &gt; functions/mass_storage.usb0/lun.0/removable\necho 0 &gt; functions/mass_storage.usb0/lun.0/cdrom\n\n# Link function\nln -s functions/mass_storage.usb0 configs/c.1/\n\nUDC=$(ls /sys/class/udc | head -n 1)\necho \"$UDC\" &gt; UDC\n</code></pre>"},{"location":"raspberry-pi/scripts/#installation","title":"Installation","text":"<pre><code>sudo nano /usr/local/bin/gadget.sh\n# Paste script content\n# IMPORTANT: Replace &lt;pi_username&gt; with your actual username!\nsudo chmod +x /usr/local/bin/gadget.sh\n</code></pre>"},{"location":"raspberry-pi/scripts/#systemd-service","title":"Systemd Service","text":"<p>Create <code>/etc/systemd/system/usb-gadget.service</code>:</p> <pre><code>[Unit]\nDescription=USB Gadget Mode Configuration\nAfter=network.target\n\n[Service]\nType=oneshot\nExecStart=/usr/local/bin/gadget.sh\nRemainAfterExit=yes\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Enable:</p> <pre><code>sudo systemctl enable usb-gadget.service\nsudo systemctl start usb-gadget.service\n</code></pre>"},{"location":"raspberry-pi/scripts/#refresh_scriptsh","title":"refresh_script.sh","text":"<p>Purpose: Unified script that unbinds USB, resizes images, updates the USB drive, and rebinds USB. Replaces the previous separate scripts (prepare_images.sh, update_usb_images.sh, publish_to_screen.sh).</p> <p>Location: <code>/home/&lt;pi_username&gt;/refresh_script.sh</code></p> <p>Run by: Node-RED via SSH</p>"},{"location":"raspberry-pi/scripts/#complete-script_1","title":"Complete Script","text":"<pre><code>#!/bin/bash\nset -e\n\n# --- Paths ---\nGADGET=/sys/kernel/config/usb_gadget/EInkGadget\nBACKING=/home/&lt;pi_username&gt;/drive.bin\nMOUNT=/mnt\nSRC=/home/&lt;pi_username&gt;/incoming_images\nDST_FOLDER=\"SAMSUNG_E-Paper\"\n\n# --- 1. Unbind gadget if active ---\nUDC=$(ls /sys/class/udc | head -n 1)\nif [ -n \"$(cat $GADGET/UDC 2&gt;/dev/null || true)\" ]; then\n    echo \"Unbinding USB gadget...\"\n    echo \"\" | sudo tee \"$GADGET/UDC\"\n    sleep 1\nfi\n\n# --- 2. Create backing file if missing ---\nif [ ! -f \"$BACKING\" ]; then\n    echo \"Creating 8GB FAT32 backing file...\"\n    dd if=/dev/zero of=\"$BACKING\" bs=1M count=8192 status=progress\n    mkfs.vfat -F 32 -n EINKUSB \"$BACKING\"\nfi\n\n# --- 3. Mount .bin ---\nsudo mkdir -p \"$MOUNT\"\nsudo umount \"$MOUNT\" 2&gt;/dev/null || true\nsudo mount -o loop \"$BACKING\" \"$MOUNT\"\n\n# Ensure the folder exists\nmkdir -p \"$MOUNT/$DST_FOLDER\"\n\n# --- 4. Prepare image with alternating filename ---\nLAST_NUM_FILE=\"$MOUNT/.last_num\"\n\n# Determine next filename: 001.png &lt;-&gt; 002.png\nif [ -f \"$LAST_NUM_FILE\" ]; then\n    LAST_NUM=$(cat \"$LAST_NUM_FILE\")\n    NUM=$(( (LAST_NUM % 2) + 1 ))   # 1 -&gt; 2, 2 -&gt; 1\nelse\n    NUM=1\nfi\n\nprintf -v FILENAME \"%03d.png\" \"$NUM\"\n\n# Pick the first image in incoming_images\nIMG=$(ls \"$SRC\"/*.{png,jpg,jpeg} 2&gt;/dev/null | head -n1)\nif [ -z \"$IMG\" ]; then\n    echo \"No images found in $SRC\"\n    sudo umount \"$MOUNT\"\n    exit 1\nfi\n\n# Remove old files in folder\nrm -f \"$MOUNT/$DST_FOLDER\"/*\n\n# Convert and copy to .bin (landscape mode: 2560x1440)\nconvert \"$IMG\" \\\n    -resize 2560x1440 \\\n    -background white \\\n    -gravity center \\\n    -extent 2560x1440 \\\n    \"$MOUNT/$DST_FOLDER/$FILENAME\"\n\n# Remember last number\necho \"$NUM\" &gt; \"$LAST_NUM_FILE\"\n\n# --- 5. Flush and unmount ---\nsync\nsudo umount \"$MOUNT\"\n\n# --- 6. Rebind gadget ---\nif [ -n \"$UDC\" ]; then\n    echo \"$UDC\" | sudo tee \"$GADGET/UDC\"\n    sleep 2\nfi\n\necho \"E-Ink USB refresh complete. Current file: $FILENAME\"\n</code></pre>"},{"location":"raspberry-pi/scripts/#dependencies","title":"Dependencies","text":"<p>Requires ImageMagick:</p> <pre><code>sudo apt install imagemagick -y\n</code></pre>"},{"location":"raspberry-pi/scripts/#how-it-works","title":"How It Works","text":"<ol> <li>Unbind USB: Disconnects USB gadget if currently active</li> <li>Create backing file: Creates 8GB FAT32 drive.bin if it doesn't exist</li> <li>Mount: Mounts the backing file to <code>/mnt</code></li> <li>Alternating filenames: Uses 001.png and 002.png alternately to force display refresh</li> <li>Resize image: Converts first image from incoming_images to 2560x1440 (landscape)</li> <li>Update: Copies processed image to USB drive</li> <li>Unmount: Cleanly unmounts the drive</li> <li>Rebind USB: Reconnects USB gadget to display</li> </ol>"},{"location":"raspberry-pi/scripts/#installation_1","title":"Installation","text":"<pre><code>nano /home/&lt;pi_username&gt;/refresh_script.sh\n# Paste script content\n# IMPORTANT: Replace ALL instances of &lt;pi_username&gt; with your actual username!\nchmod +x /home/&lt;pi_username&gt;/refresh_script.sh\n</code></pre>"},{"location":"raspberry-pi/scripts/#permissions","title":"Permissions","text":"<p>Requires sudo for USB unbind/bind and mount operations. Configure sudoers:</p> <pre><code>sudo visudo\n</code></pre> <p>Add (replace <code>&lt;pi_username&gt;</code> with your username):</p> <pre><code>&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /usr/bin/tee, /usr/bin/mount, /usr/bin/umount, /usr/bin/mkdir\n</code></pre>"},{"location":"raspberry-pi/scripts/#trigger-from-node-red","title":"Trigger from Node-RED","text":"<p>Node-RED uses SSH to trigger <code>refresh_script.sh</code>:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; '/home/&lt;pi_username&gt;/refresh_script.sh'\n</code></pre> <p>Example:</p> <pre><code>ssh hrtech@100.64.1.5 '/home/hrtech/refresh_script.sh'\n</code></pre> <p>See SSH Configuration for key-based auth setup.</p>"},{"location":"raspberry-pi/scripts/#directory-structure","title":"Directory Structure","text":"<pre><code>/home/&lt;pi_username&gt;/\n\u251c\u2500\u2500 drive.bin                    # USB backing file (8GB FAT32)\n\u251c\u2500\u2500 incoming_images/             # Images from Node-RED via SCP\n\u2502   \u2514\u2500\u2500 001.png\n\u2514\u2500\u2500 refresh_script.sh            # Main refresh script\n</code></pre>"},{"location":"raspberry-pi/scripts/#testing-script","title":"Testing Script","text":""},{"location":"raspberry-pi/scripts/#test-refresh_scriptsh","title":"Test refresh_script.sh","text":"<pre><code># Add a test image\ncp /path/to/test.png /home/&lt;pi_username&gt;/incoming_images/test.png\n\n# Run script\n/home/&lt;pi_username&gt;/refresh_script.sh\n\n# Check display for updated image\n</code></pre>"},{"location":"raspberry-pi/scripts/#troubleshooting","title":"Troubleshooting","text":""},{"location":"raspberry-pi/scripts/#no-images-found-error","title":"\"No images found\" Error","text":"<p>Ensure images exist in incoming_images folder:</p> <pre><code>ls -lh /home/&lt;pi_username&gt;/incoming_images/\n</code></pre> <p>Add a test image if needed:</p> <pre><code>cp /path/to/test.png /home/&lt;pi_username&gt;/incoming_images/test.png\n</code></pre>"},{"location":"raspberry-pi/scripts/#convert-command-not-found","title":"\"convert: command not found\"","text":"<p>Install ImageMagick:</p> <pre><code>sudo apt install imagemagick -y\n</code></pre>"},{"location":"raspberry-pi/scripts/#permission-denied","title":"Permission Denied","text":"<p>Ensure script is executable:</p> <pre><code>chmod +x /home/&lt;pi_username&gt;/refresh_script.sh\n</code></pre> <p>And sudoers configured correctly (see Permissions section above).</p>"},{"location":"raspberry-pi/scripts/#mount-errors","title":"Mount Errors","text":"<p>Check if already mounted:</p> <pre><code>mount | grep drive.bin\n</code></pre> <p>If mounted, unmount:</p> <pre><code>sudo umount /mnt\n</code></pre>"},{"location":"raspberry-pi/scripts/#usb-gadget-already-bound","title":"USB Gadget Already Bound","text":"<p>The script automatically unbinds the gadget. If manual unbind is needed:</p> <pre><code>echo \"\" | sudo tee /sys/kernel/config/usb_gadget/EInkGadget/UDC\n</code></pre>"},{"location":"raspberry-pi/scripts/#maintenance","title":"Maintenance","text":""},{"location":"raspberry-pi/scripts/#clean-old-images","title":"Clean Old Images","text":"<p>Periodically clean incoming images:</p> <pre><code>rm -f /home/&lt;pi_username&gt;/incoming_images/*\n</code></pre>"},{"location":"raspberry-pi/scripts/#check-disk-usage","title":"Check Disk Usage","text":"<pre><code>du -sh /home/&lt;pi_username&gt;/drive.bin\n</code></pre>"},{"location":"raspberry-pi/scripts/#verify-backing-file","title":"Verify Backing File","text":"<pre><code>file /home/&lt;pi_username&gt;/drive.bin\n</code></pre> <p>Should show FAT filesystem.</p>"},{"location":"raspberry-pi/scripts/#script-logging","title":"Script Logging","text":"<p>Add logging to <code>refresh_script.sh</code> by modifying the last echo line:</p> <pre><code>echo \"E-Ink USB refresh complete. Current file: $FILENAME\" | tee -a /home/&lt;pi_username&gt;/refresh.log\n</code></pre> <p>View logs:</p> <pre><code>tail -f /home/&lt;pi_username&gt;/refresh.log\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/","title":"SSH Configuration","text":"<p>Configure SSH for Node-RED to trigger scripts on the Raspberry Pi.</p>"},{"location":"raspberry-pi/ssh-setup/#goal","title":"Goal","text":"<p>Allow Node-RED on the VM to execute commands on the Raspberry Pi without password prompts.</p>"},{"location":"raspberry-pi/ssh-setup/#prerequisites","title":"Prerequisites","text":""},{"location":"raspberry-pi/ssh-setup/#install-tailscale-on-raspberry-pi","title":"Install Tailscale on Raspberry Pi","text":"<p>Tailscale provides secure networking between the VM and Raspberry Pi without requiring manual port forwarding.</p> <p>Install Tailscale:</p> <pre><code>curl -fsSL https://tailscale.com/install.sh | sh\nsudo tailscale up\n</code></pre> <p>Follow the authentication link in your browser to connect your Pi to your Tailscale network.</p> <p>Get Pi's Tailscale IP:</p> <pre><code>tailscale ip -4\n</code></pre> <p>Note this IP address (typically in the <code>100.x.x.x</code> range) - you'll use it for SSH connections and in Node-RED.</p> <p>VM Tailscale Setup Required</p> <p>Ensure Tailscale is also installed on your VM. See Node-RED Configuration - Tailscale Configuration for VM setup.</p>"},{"location":"raspberry-pi/ssh-setup/#on-the-vm-node-red-host","title":"On the VM (Node-RED Host)","text":""},{"location":"raspberry-pi/ssh-setup/#generate-ssh-key","title":"Generate SSH Key","text":"<p>As the user running Node-RED (or Docker user):</p> <pre><code>ssh-keygen -t ed25519 -C \"node-red@iotstack\"\n</code></pre> <p>Press Enter for all prompts (no passphrase for automation).</p> <p>Keys created:</p> <ul> <li>Private: <code>~/.ssh/id_ed25519</code></li> <li>Public: <code>~/.ssh/id_ed25519.pub</code></li> </ul>"},{"location":"raspberry-pi/ssh-setup/#copy-public-key-to-raspberry-pi","title":"Copy Public Key to Raspberry Pi","text":"<pre><code>ssh-copy-id &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\n</code></pre> <p>Replace: - <code>&lt;pi_username&gt;</code> with your Raspberry Pi username (e.g., <code>hrtech</code>, <code>pi</code>) - <code>&lt;pi_tailscale_ip&gt;</code> with your Raspberry Pi's Tailscale IP address (e.g., <code>100.64.1.5</code>)</p> <p>Enter Raspberry Pi password when prompted.</p> <p>Use Tailscale IP Address</p> <p>Use the Pi's Tailscale IP address, not its local network IP. Get this with <code>tailscale ip -4</code> on the Pi.</p> <p>Alternatively, manual copy:</p> <pre><code>cat ~/.ssh/id_ed25519.pub\n</code></pre> <p>Copy the output, then on Raspberry Pi:</p> <pre><code>mkdir -p ~/.ssh\nnano ~/.ssh/authorized_keys\n# Paste the public key\nchmod 700 ~/.ssh\nchmod 600 ~/.ssh/authorized_keys\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#test-ssh-connection","title":"Test SSH Connection","text":"<pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'echo Connected successfully'\n</code></pre> <p>Should connect without password using the Tailscale IP.</p>"},{"location":"raspberry-pi/ssh-setup/#on-the-raspberry-pi","title":"On the Raspberry Pi","text":""},{"location":"raspberry-pi/ssh-setup/#disable-password-authentication-recommended","title":"Disable Password Authentication (Recommended)","text":"<p>For security, allow only key-based auth:</p> <pre><code>sudo nano /etc/ssh/sshd_config\n</code></pre> <p>Find and set:</p> <pre><code>PasswordAuthentication no\nPubkeyAuthentication yes\nChallengeResponseAuthentication no\n</code></pre> <p>Restart SSH:</p> <pre><code>sudo systemctl restart ssh\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#configure-sudo-for-scripts","title":"Configure Sudo for Scripts","text":"<p>Allow running specific commands without password:</p> <pre><code>sudo visudo\n</code></pre> <p>Add these lines (replace <code>&lt;pi_username&gt;</code> with your actual Raspberry Pi username):</p> <pre><code>&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /usr/bin/tee\n&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /usr/bin/mount\n&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /usr/bin/umount\n&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /usr/bin/mkdir\n&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /bin/rm\n&lt;pi_username&gt; ALL=(ALL) NOPASSWD: /bin/cp\n</code></pre> <p>This allows passwordless sudo for the scripts.</p>"},{"location":"raspberry-pi/ssh-setup/#test-sudo-commands","title":"Test Sudo Commands","text":"<pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'sudo mount -o loop /home/&lt;pi_username&gt;/drive.bin /mnt'\n</code></pre> <p>Should not prompt for password.</p>"},{"location":"raspberry-pi/ssh-setup/#node-red-configuration","title":"Node-RED Configuration","text":""},{"location":"raspberry-pi/ssh-setup/#for-docker-node-red","title":"For Docker Node-RED","text":"<p>If Node-RED runs in Docker, the SSH key must be accessible inside the container.</p>"},{"location":"raspberry-pi/ssh-setup/#option-1-mount-ssh-directory","title":"Option 1: Mount SSH Directory","text":"<p>Edit <code>docker-compose.yml</code>:</p> <pre><code>services:\n  nodered:\n    volumes:\n      - ./volumes/nodered/data:/data\n      - /home/&lt;your-user&gt;/.ssh:/root/.ssh:ro  # Add this line\n</code></pre> <p>Restart Node-RED:</p> <pre><code>docker compose restart nodered\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#option-2-copy-key-into-container","title":"Option 2: Copy Key into Container","text":"<pre><code>docker cp ~/.ssh/id_ed25519 nodered:/root/.ssh/\ndocker cp ~/.ssh/id_ed25519.pub nodered:/root/.ssh/\ndocker exec nodered chmod 600 /root/.ssh/id_ed25519\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#test-from-node-red-container","title":"Test from Node-RED Container","text":"<pre><code>docker exec nodered ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; 'echo Test from container'\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#ssh-known-hosts","title":"SSH Known Hosts","text":"<p>First connection may prompt to accept host key:</p> <pre><code>docker exec -it nodered ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;\n</code></pre> <p>Type <code>yes</code> to accept.</p> <p>Or add to known_hosts automatically:</p> <pre><code>docker exec nodered ssh-keyscan -H &lt;pi_tailscale_ip&gt; &gt;&gt; /root/.ssh/known_hosts\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#node-red-exec-node-configuration","title":"Node-RED Exec Node Configuration","text":""},{"location":"raspberry-pi/ssh-setup/#scp-command-copy-image","title":"SCP Command (Copy Image)","text":"<p>Command:</p> <pre><code>scp /tmp/001.png &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/home/&lt;pi_username&gt;/incoming_images/incoming.png\n</code></pre> <p>Example: <pre><code>scp /tmp/001.png hrtech@100.64.1.5:/home/hrtech/incoming_images/incoming.png\n</code></pre></p> <p>Options:</p> <ul> <li>Append msg.payload: Unchecked</li> <li>Use spawn: Unchecked</li> <li>Timeout: 60 seconds</li> </ul> <p>Use Tailscale IP Address</p> <p>Use the Raspberry Pi's Tailscale IP address (100.x.x.x range), not its local network IP.</p>"},{"location":"raspberry-pi/ssh-setup/#ssh-command-trigger-script","title":"SSH Command (Trigger Script)","text":"<p>Add an exec node after SCP:</p> <p>Command:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; '/home/&lt;pi_username&gt;/refresh_script.sh'\n</code></pre> <p>Example: <pre><code>ssh hrtech@100.64.1.5 '/home/hrtech/refresh_script.sh'\n</code></pre></p> <p>Options:</p> <ul> <li>Append msg.payload: Unchecked</li> <li>Use spawn: Unchecked</li> <li>Timeout: 120 seconds (script may take time)</li> </ul>"},{"location":"raspberry-pi/ssh-setup/#error-handling","title":"Error Handling","text":"<p>Connect the error output (pin 2) of exec nodes to debug nodes to catch failures.</p>"},{"location":"raspberry-pi/ssh-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"raspberry-pi/ssh-setup/#permission-denied-publickey","title":"Permission Denied (publickey)","text":"<p>Check:</p> <ol> <li>Public key copied to Pi: <code>cat ~/.ssh/authorized_keys</code> on Pi</li> <li>Private key accessible in Node-RED container</li> <li>Permissions correct:</li> <li>Private key: <code>chmod 600</code></li> <li><code>~/.ssh</code> directory: <code>chmod 700</code></li> </ol>"},{"location":"raspberry-pi/ssh-setup/#host-key-verification-failed","title":"Host Key Verification Failed","text":"<p>Add Pi to known_hosts:</p> <pre><code>ssh-keyscan -H &lt;pi_tailscale_ip&gt; &gt;&gt; ~/.ssh/known_hosts\n</code></pre> <p>Inside container:</p> <pre><code>docker exec nodered ssh-keyscan -H &lt;pi_tailscale_ip&gt; &gt;&gt; /root/.ssh/known_hosts\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#connection-timeout","title":"Connection Timeout","text":"<p>Check:</p> <ol> <li>Tailscale is connected on both VM and Pi:</li> <li>VM: <code>docker exec tailscale tailscale status</code> (if Docker) or <code>tailscale status</code> (if native)</li> <li>Pi: <code>sudo tailscale status</code></li> <li>Pi is reachable via Tailscale: <code>ping &lt;pi_tailscale_ip&gt;</code></li> <li>SSH service running on Pi: <code>sudo systemctl status ssh</code></li> <li>Pi's Tailscale IP hasn't changed (rare, but check with <code>tailscale ip -4</code> on Pi)</li> </ol>"},{"location":"raspberry-pi/ssh-setup/#scp-fails","title":"SCP Fails","text":"<p>Verify:</p> <ol> <li>Source file exists: <code>ls /tmp/001.png</code></li> <li>Destination directory exists on Pi: <code>ls /home/&lt;pi_username&gt;/incoming_images/</code></li> <li>Permissions allow write to destination</li> </ol> <p>Create directory if missing:</p> <pre><code>ssh &lt;pi_username&gt;@&lt;rpi_ip&gt; 'mkdir -p /home/&lt;pi_username&gt;/incoming_images'\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#security-best-practices","title":"Security Best Practices","text":""},{"location":"raspberry-pi/ssh-setup/#use-ssh-keys-only","title":"Use SSH Keys Only","text":"<p>Never use password authentication for automation.</p>"},{"location":"raspberry-pi/ssh-setup/#limit-sudo-commands","title":"Limit Sudo Commands","text":"<p>Only grant passwordless sudo to specific commands needed by scripts.</p>"},{"location":"raspberry-pi/ssh-setup/#firewall-rules","title":"Firewall Rules","text":"<p>On the Pi, you can optionally restrict SSH access to Tailscale network only:</p> <pre><code># Allow SSH only from Tailscale interface\nsudo ufw allow in on tailscale0 to any port 22\nsudo ufw deny 22\nsudo ufw enable\n</code></pre> <p>This ensures SSH is only accessible through Tailscale, not from the local network.</p>"},{"location":"raspberry-pi/ssh-setup/#regular-key-rotation","title":"Regular Key Rotation","text":"<p>Periodically regenerate SSH keys:</p> <ol> <li>Generate new key</li> <li>Copy to Pi</li> <li>Test</li> <li>Remove old key from <code>authorized_keys</code></li> </ol>"},{"location":"raspberry-pi/ssh-setup/#monitor-ssh-logs","title":"Monitor SSH Logs","text":"<p>On Pi, check for suspicious activity:</p> <pre><code>sudo tail -f /var/log/auth.log\n</code></pre>"},{"location":"raspberry-pi/ssh-setup/#testing-full-flow","title":"Testing Full Flow","text":""},{"location":"raspberry-pi/ssh-setup/#from-vm-terminal","title":"From VM Terminal","text":"<pre><code># Copy image\nscp /tmp/001.png &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt;:/home/&lt;pi_username&gt;/incoming_images/incoming.png\n\n# Trigger script\nssh &lt;pi_username&gt;@&lt;pi_tailscale_ip&gt; '/home/&lt;pi_username&gt;/refresh_script.sh'\n</code></pre> <p>Example: <pre><code>scp /tmp/001.png hrtech@100.64.1.5:/home/hrtech/incoming_images/incoming.png\nssh hrtech@100.64.1.5 '/home/hrtech/refresh_script.sh'\n</code></pre></p> <p>Both should complete without password prompts.</p>"},{"location":"raspberry-pi/ssh-setup/#from-node-red","title":"From Node-RED","text":"<ol> <li>Manually inject the \"loop_image_renderer\" flow</li> <li>Check debug output for:</li> <li>Successful SCP</li> <li>Successful SSH script execution</li> <li>Verify image appears on display</li> </ol>"},{"location":"raspberry-pi/ssh-setup/#backup-ssh-keys","title":"Backup SSH Keys","text":"<p>Save SSH keys securely:</p> <pre><code># On VM\ncp ~/.ssh/id_ed25519 /path/to/secure/backup/\ncp ~/.ssh/id_ed25519.pub /path/to/secure/backup/\n</code></pre> <p>Store in password manager or encrypted backup.</p>"},{"location":"raspberry-pi/ssh-setup/#alternative-scp-without-ssh","title":"Alternative: SCP Without SSH","text":"<p>If SSH setup is problematic, alternatives:</p> <ol> <li>HTTP Upload: Run web server on Pi, Node-RED POSTs image</li> <li>Shared Network Storage: NFS or SAMBA mount</li> <li>MQTT: Publish image as base64 message</li> </ol> <p>However, SSH/SCP is the most straightforward for this use case.</p>"},{"location":"services/grafana-renderer/","title":"Grafana Image Renderer","text":"<p>The Grafana Image Renderer is a separate service that runs a headless Chromium browser to render dashboard screenshots.</p>"},{"location":"services/grafana-renderer/#why-separate-service","title":"Why Separate Service?","text":"<ul> <li>Not included in IOTstack by default</li> <li>Requires more resources (runs Chromium)</li> <li>Needs specific configuration for authentication</li> <li>Can be scaled independently</li> </ul>"},{"location":"services/grafana-renderer/#prerequisites","title":"Prerequisites","text":"<p>Before deploying the renderer:</p> <ol> <li>Have Grafana already running (see Grafana Configuration)</li> <li>Generate a service account token in Grafana:</li> <li>Go to Administration \u2192 Users and access \u2192 Service accounts</li> <li>Create account named <code>image-renderer</code> with <code>Viewer</code> role</li> <li>Generate and save the token (starts with <code>glsa_</code>)</li> <li>See Grafana Configuration for detailed steps</li> <li>Note your VM's IP address</li> </ol>"},{"location":"services/grafana-renderer/#deploy-the-renderer","title":"Deploy the Renderer","text":"<p>You can add the Grafana Image Renderer service either via docker-compose.yml or Portainer.</p>"},{"location":"services/grafana-renderer/#option-1-via-docker-composeyml","title":"Option 1: Via docker-compose.yml","text":"<p>Edit <code>~/IOTstack/docker-compose.yml</code> and add this service:</p> <pre><code>services:\n  # ... existing services ...\n\n  grafana-image-renderer:\n    image: grafana/grafana-image-renderer:latest\n    container_name: grafana-image-renderer\n    restart: unless-stopped\n    ports:\n      - \"8081:8081\"\n    environment:\n      - ENABLE_METRICS=true\n      - AUTH_TOKEN=&lt;your_service_account_token&gt;\n      - HTTP_HOST=0.0.0.0\n      - HTTP_PORT=8081\n      - BROWSER_TZ=Europe/Amsterdam  # Your timezone\n    networks:\n      - default\n</code></pre> <p>Replace <code>&lt;your_service_account_token&gt;</code> with the token from Prerequisites step 2.</p> <p>Important: The <code>AUTH_TOKEN</code> must match the <code>GF_RENDERING_RENDERER_TOKEN</code> in Grafana (configured in Grafana Configuration).</p> <p>Then start the service:</p> <pre><code>cd ~/IOTstack\ndocker compose up -d grafana-image-renderer\n</code></pre>"},{"location":"services/grafana-renderer/#option-2-via-portainer","title":"Option 2: Via Portainer","text":"<ol> <li>Navigate to <code>http://&lt;vm_ip&gt;:9000</code></li> <li>Go to Containers</li> <li>Click + Add container</li> <li>Configure:</li> <li>Name: <code>grafana-image-renderer</code></li> <li>Image: <code>grafana/grafana-image-renderer:latest</code></li> <li>Manual network port publishing:<ul> <li>Host: <code>8081</code>, Container: <code>8081</code></li> </ul> </li> <li>Restart policy: <code>Unless stopped</code></li> <li>Scroll to Env section</li> <li>Click + add environment variable for each:</li> <li><code>ENABLE_METRICS</code> = <code>true</code></li> <li><code>AUTH_TOKEN</code> = <code>&lt;your_service_account_token&gt;</code></li> <li><code>HTTP_HOST</code> = <code>0.0.0.0</code></li> <li><code>HTTP_PORT</code> = <code>8081</code></li> <li><code>BROWSER_TZ</code> = <code>Europe/Amsterdam</code> (or your timezone)</li> <li>Scroll to Network section</li> <li>Select the same network as your Grafana container (usually <code>iotstack_default</code> or similar)</li> <li>Click Deploy the container</li> </ol> <p>Service Account Token</p> <p>Use the token from Prerequisites step 2</p>"},{"location":"services/grafana-renderer/#verify-installation","title":"Verify Installation","text":"<pre><code>cd ~/IOTstack\ndocker compose up -d grafana-image-renderer\n</code></pre> <p>Verify:</p> <pre><code>docker compose ps grafana-image-renderer\ndocker compose logs grafana-image-renderer\n</code></pre>"},{"location":"services/grafana-renderer/#configuration-options","title":"Configuration Options","text":""},{"location":"services/grafana-renderer/#environment-variables","title":"Environment Variables","text":"Variable Description Default AUTH_TOKEN Bearer token for authentication (none) HTTP_HOST Listen address 0.0.0.0 HTTP_PORT Listen port 8081 BROWSER_TZ Timezone for rendering UTC ENABLE_METRICS Enable Prometheus metrics false LOG_LEVEL Logging level (debug, info, warn, error) info"},{"location":"services/grafana-renderer/#rendering-options","title":"Rendering Options","text":"<p>Additional environment variables for fine-tuning:</p> <pre><code>environment:\n  - RENDERING_MODE=default  # or 'clustered' for high load\n  - RENDERING_CLUSTERING_MODE=browser  # or 'context'\n  - RENDERING_CLUSTERING_MAX_CONCURRENCY=5\n  - RENDERING_VIEWPORT_MAX_WIDTH=3000\n  - RENDERING_VIEWPORT_MAX_HEIGHT=3000\n</code></pre>"},{"location":"services/grafana-renderer/#test-the-renderer","title":"Test the Renderer","text":""},{"location":"services/grafana-renderer/#direct-health-check","title":"Direct Health Check","text":"<pre><code>curl http://&lt;vm_ip&gt;:8081/\n</code></pre> <p>Should return:</p> <pre><code>Grafana Image Renderer\n</code></pre>"},{"location":"services/grafana-renderer/#test-render-with-token","title":"Test Render with Token","text":"<pre><code>curl -H \"Authorization: Bearer &lt;your_service_account_token&gt;\" \\\n  -d 'url=http://&lt;vm_ip&gt;:3000/d/&lt;dashboard_uid&gt;?orgId=1&amp;from=now-3h&amp;to=now&amp;kiosk=true' \\\n  -d 'width=1536' \\\n  -d 'height=2048' \\\n  http://&lt;vm_ip&gt;:8081/render \\\n  --output test.png\n</code></pre> <p>Replace: - <code>&lt;your_service_account_token&gt;</code> with your Grafana service account token - <code>&lt;vm_ip&gt;</code> with your VM's IP address - <code>&lt;dashboard_uid&gt;</code> with your dashboard UID (e.g., <code>ad5v9hp</code>)</p> <p>Check <code>test.png</code> is a valid image.</p>"},{"location":"services/grafana-renderer/#configure-grafana-integration","title":"Configure Grafana Integration","text":"<p>After deploying the renderer, configure Grafana to use it. See Grafana Configuration - Configure Grafana Environment Variables for detailed steps.</p> <p>Key points: - Use <code>GF_RENDERING_SERVER_URL=http://grafana-image-renderer:8081/render</code> - Token must match the <code>AUTH_TOKEN</code> set above - Restart Grafana after configuration</p>"},{"location":"services/grafana-renderer/#verify-integration","title":"Verify Integration","text":"<p>In Grafana:</p> <ol> <li>Go to Administration \u2192 General \u2192 Settings</li> <li>Find the \"rendering\" section</li> <li>Ignore the legacy \"plugin.grafana-image-renderer\"</li> <li>Verify the external renderer is configured correctly</li> </ol> <p>Or check Grafana logs:</p> <pre><code>docker compose logs grafana | grep -i render\n</code></pre> <p>Should show successful connection to renderer.</p>"},{"location":"services/grafana-renderer/#performance-tuning","title":"Performance Tuning","text":""},{"location":"services/grafana-renderer/#increase-memory-limit","title":"Increase Memory Limit","text":"<p>For larger dashboards:</p> <pre><code>grafana-image-renderer:\n  mem_limit: 1g\n  mem_reservation: 512m\n</code></pre>"},{"location":"services/grafana-renderer/#adjust-concurrency","title":"Adjust Concurrency","text":"<p>If rendering multiple images simultaneously:</p> <pre><code>environment:\n  - RENDERING_CLUSTERING_MODE=browser\n  - RENDERING_CLUSTERING_MAX_CONCURRENCY=10\n</code></pre>"},{"location":"services/grafana-renderer/#troubleshooting","title":"Troubleshooting","text":""},{"location":"services/grafana-renderer/#renderer-not-responding","title":"Renderer Not Responding","text":"<p>Check if service is running:</p> <pre><code>docker compose ps grafana-image-renderer\n</code></pre> <p>Check logs for errors:</p> <pre><code>docker compose logs -f grafana-image-renderer\n</code></pre> <p>Common issues:</p> <ul> <li>Out of memory: Increase <code>mem_limit</code></li> <li>Port conflict: Change <code>8081</code> to another port</li> <li>Network issues: Verify Docker network connectivity</li> </ul>"},{"location":"services/grafana-renderer/#authentication-errors","title":"Authentication Errors","text":"<p>If you see \"unauthorized\" errors:</p> <ol> <li>Verify token matches in both services</li> <li>Restart both Grafana and renderer:</li> </ol> <pre><code>docker compose restart grafana grafana-image-renderer\n</code></pre>"},{"location":"services/grafana-renderer/#timeout-errors","title":"Timeout Errors","text":"<p>Increase timeout in Grafana:</p> <pre><code>grafana:\n  environment:\n    - GF_RENDERING_TIMEOUT=60  # seconds\n</code></pre>"},{"location":"services/grafana-renderer/#image-quality-issues","title":"Image Quality Issues","text":"<p>Adjust rendering parameters:</p> <pre><code>environment:\n  - RENDERING_VIEWPORT_DEVICE_SCALE_FACTOR=2  # Higher DPI\n  - IGNORE_HTTPS_ERRORS=true  # If using self-signed certs\n</code></pre>"},{"location":"services/grafana-renderer/#monitoring","title":"Monitoring","text":""},{"location":"services/grafana-renderer/#check-metrics","title":"Check Metrics","text":"<p>If <code>ENABLE_METRICS=true</code>:</p> <pre><code>curl http://&lt;vm_ip&gt;:8081/metrics\n</code></pre> <p>Returns Prometheus-format metrics.</p>"},{"location":"services/grafana-renderer/#view-logs","title":"View Logs","text":"<pre><code>docker compose logs -f grafana-image-renderer\n</code></pre> <p>Look for:</p> <ul> <li>Render requests</li> <li>Errors</li> <li>Performance metrics</li> </ul>"},{"location":"services/grafana-renderer/#security-notes","title":"Security Notes","text":""},{"location":"services/grafana-renderer/#token-security","title":"Token Security","text":"<p>The bearer token should be:</p> <ul> <li>Unique and complex</li> <li>Same in both Grafana and renderer</li> <li>Kept secret (not in version control)</li> </ul> <p>To generate a new token, use Grafana's Service Account feature (see Grafana Configuration).</p>"},{"location":"services/grafana-renderer/#network-isolation","title":"Network Isolation","text":"<p>For production, consider:</p> <ul> <li>Not exposing port 8081 externally</li> <li>Using Docker internal network only</li> <li>Firewall rules to restrict access</li> </ul>"},{"location":"services/grafana-renderer/#resource-usage","title":"Resource Usage","text":"<p>Typical resource usage:</p> <ul> <li>CPU: Low when idle, spikes during rendering</li> <li>Memory: 200-500 MB baseline, up to 1 GB during rendering</li> <li>Disk: Minimal (stores temporary files)</li> </ul> <p>Monitor with:</p> <pre><code>docker stats grafana-image-renderer\n</code></pre>"},{"location":"services/grafana-renderer/#updates","title":"Updates","text":"<p>Update to latest version:</p> <pre><code>cd ~/IOTstack\ndocker compose pull grafana-image-renderer\ndocker compose up -d grafana-image-renderer\n</code></pre> <p>Check for breaking changes in release notes.</p>"},{"location":"services/grafana/","title":"Grafana Configuration","text":"<p>Grafana provides the visualization dashboard for turbine and weather data.</p>"},{"location":"services/grafana/#initial-access","title":"Initial Access","text":"<ul> <li>URL: <code>http://&lt;vm_ip&gt;:3000</code></li> <li>Replace <code>&lt;vm_ip&gt;</code> with your VM's IP address (e.g., <code>192.168.178.164</code>)</li> <li>Default credentials: <code>admin</code> / <code>admin</code></li> <li>Change password on first login</li> </ul>"},{"location":"services/grafana/#add-influxdb-data-source","title":"Add InfluxDB Data Source","text":"<ol> <li>Go to Connections \u2192 Data sources</li> <li>Click Add new data source</li> <li>Select InfluxDB</li> <li>Configure:</li> <li>Name: <code>InfluxDB-IoT</code></li> <li>Query Language: <code>InfluxQL</code> (for InfluxDB 1.x)</li> <li>URL: <code>http://influxdb:8086</code> (Docker DNS name)</li> <li>Database: <code>iot_data</code></li> <li>Leave authentication fields blank if no auth is enabled</li> <li>Click Save &amp; Test</li> </ol> <p>Should show: \"Data source is working\".</p> <p>For detailed InfluxDB setup and configuration, see InfluxDB Configuration.</p>"},{"location":"services/grafana/#image-renderer-integration","title":"Image Renderer Integration","text":"<p>For dashboard rendering to images (needed for e-ink display), you need the Grafana Image Renderer service.</p>"},{"location":"services/grafana/#prerequisites","title":"Prerequisites","text":"<ol> <li>First, deploy the Grafana Image Renderer service - see Grafana Image Renderer documentation</li> <li>Generate a service account token (see below)</li> <li>Configure Grafana with renderer settings</li> </ol>"},{"location":"services/grafana/#generate-service-account-token","title":"Generate Service Account Token","text":"<ol> <li>In Grafana UI, go to Administration \u2192 Users and access \u2192 Service accounts</li> <li>Click Add service account</li> <li>Name: <code>image-renderer</code></li> <li>Role: <code>Viewer</code></li> <li>Click Create</li> <li>Click Add service account token</li> <li>Copy the token (starts with <code>glsa_</code>)</li> <li>Save this token - you'll need it for both Grafana and the renderer service</li> </ol>"},{"location":"services/grafana/#configure-grafana-environment-variables","title":"Configure Grafana Environment Variables","text":"<p>Add these environment variables to your Grafana container:</p> <pre><code>services:\n  grafana:\n    environment:\n      - GF_SERVER_DOMAIN=&lt;vm_ip&gt;\n      - GF_SERVER_ROOT_URL=http://&lt;vm_ip&gt;:3000/\n      - GF_RENDERING_SERVER_URL=http://grafana-image-renderer:8081/render\n      - GF_RENDERING_CALLBACK_URL=http://&lt;vm_ip&gt;:3000/\n      - GF_RENDERING_RENDERER_TOKEN=&lt;your_service_account_token&gt;\n</code></pre> <p>Docker Network Configuration</p> <p>Use Docker DNS name <code>grafana-image-renderer</code> if both services are in the same Docker network. Otherwise use <code>http://&lt;vm_ip&gt;:8081/render</code>.</p> <p>Replace: - <code>&lt;vm_ip&gt;</code> with your VM's IP address - <code>&lt;your_service_account_token&gt;</code> with the token from above</p> <p>Restart Grafana after changes:</p> <pre><code>docker compose restart grafana\n</code></pre>"},{"location":"services/grafana/#create-dashboard","title":"Create Dashboard","text":""},{"location":"services/grafana/#option-1-import-pre-configured-dashboard","title":"Option 1: Import Pre-configured Dashboard","text":"<p>This repository includes a pre-configured dashboard designed for the wind turbine monitoring system with:</p> <ul> <li>Environmental impact metrics (CO\u2082 avoided, households powered, trees equivalent)</li> <li>Power generation gauges and time series</li> <li>Weather conditions (wind speed, direction, temperature, humidity)</li> <li>All panels pre-configured with InfluxQL queries</li> </ul> <p>Download: dashboard.json (right-click \u2192 Save link as...)</p> <p>To import:</p> <ol> <li>Go to Dashboards \u2192 New \u2192 Import</li> <li>Upload the downloaded <code>dashboard.json</code> file</li> <li>Click Load</li> <li>Select data source: InfluxDB-IoT</li> <li>Click Import</li> </ol> <p>Verify Data Source UID</p> <p>After importing, verify that the InfluxDB data source UID matches. If panels show \"No data\", edit each panel and reselect the data source.</p>"},{"location":"services/grafana/#option-2-import-other-dashboard","title":"Option 2: Import Other Dashboard","text":"<p>If you have a different dashboard JSON:</p> <ol> <li>Go to Dashboards \u2192 New \u2192 Import</li> <li>Upload JSON file or paste JSON</li> <li>Click Load</li> <li>Select data source</li> <li>Click Import</li> </ol>"},{"location":"services/grafana/#option-3-create-new-dashboard","title":"Option 3: Create New Dashboard","text":"<ol> <li>Go to Dashboards \u2192 New \u2192 New Dashboard</li> <li>Click Add visualization</li> <li>Select InfluxDB-IoT data source</li> <li>Write query:</li> </ol> <pre><code>SELECT mean(\"temperature_C\") FROM \"weather\" \nWHERE $timeFilter \nGROUP BY time($__interval)\n</code></pre> <ol> <li>Customize panel (title, axes, legend)</li> <li>Click Apply</li> <li>Add more panels as needed</li> <li>Click Save dashboard (disk icon)</li> </ol>"},{"location":"services/grafana/#example-panels","title":"Example Panels","text":""},{"location":"services/grafana/#turbine-power-output","title":"Turbine Power Output","text":"<pre><code>SELECT mean(\"grid_s6_power\") FROM \"turbine\" \nWHERE $timeFilter \nGROUP BY time($__interval)\n</code></pre>"},{"location":"services/grafana/#wind-speed","title":"Wind Speed","text":"<pre><code>SELECT mean(\"wind_speed_ms\") FROM \"weather\" \nWHERE $timeFilter \nGROUP BY time($__interval)\n</code></pre>"},{"location":"services/grafana/#temperature-humidity","title":"Temperature &amp; Humidity","text":"<pre><code>SELECT mean(\"temperature_C\") AS \"Temperature\", \n       mean(\"humidity\") AS \"Humidity\" \nFROM \"weather\" \nWHERE $timeFilter \nGROUP BY time($__interval)\n</code></pre>"},{"location":"services/grafana/#get-dashboard-uid","title":"Get Dashboard UID","text":"<p>For Node-RED image requests, you need the dashboard UID:</p> <ol> <li>Open the dashboard</li> <li>Check the URL: <code>http://.../d/&lt;UID&gt;/dashboard-name</code></li> <li>Copy the UID (e.g., <code>ad5v9hp</code>)</li> </ol> <p>Or via API:</p> <pre><code>curl -s -H \"Authorization: Bearer &lt;your_service_account_token&gt;\" \\\n  http://&lt;vm_ip&gt;:3000/api/search | jq\n</code></pre>"},{"location":"services/grafana/#image-rendering-test","title":"Image Rendering Test","text":"<p>Test the renderer directly:</p> <pre><code>curl -H \"Authorization: Bearer &lt;your_service_account_token&gt;\" \\\n  \"http://&lt;vm_ip&gt;:3000/render/d/&lt;dashboard_uid&gt;?orgId=1&amp;from=now-3h&amp;to=now&amp;width=1536&amp;height=-1&amp;kiosk=true\" \\\n  --output test_render.png\n</code></pre> <p>Replace: - <code>&lt;your_service_account_token&gt;</code> with the token generated in the previous section - <code>&lt;dashboard_uid&gt;</code> with your dashboard UID (e.g., <code>ad5v9hp</code>)</p> <p>If successful, <code>test_render.png</code> should contain the dashboard image.</p>"},{"location":"services/grafana/#additional-configuration","title":"Additional Configuration","text":""},{"location":"services/grafana/#anonymous-access-optional","title":"Anonymous Access (Optional)","text":"<p>To allow viewing without login:</p> <pre><code>environment:\n  - GF_AUTH_ANONYMOUS_ENABLED=true\n  - GF_AUTH_ANONYMOUS_ORG_ROLE=Viewer\n</code></pre> <p>Restart Grafana after changes.</p>"},{"location":"services/grafana/#email-alerts-optional","title":"Email Alerts (Optional)","text":"<p>Configure SMTP for alerts:</p> <pre><code>environment:\n  - GF_SMTP_ENABLED=true\n  - GF_SMTP_HOST=smtp.gmail.com:587\n  - GF_SMTP_USER=your-email@gmail.com\n  - GF_SMTP_PASSWORD=your-app-password\n  - GF_SMTP_FROM_ADDRESS=your-email@gmail.com\n</code></pre>"},{"location":"services/grafana/#backup-dashboard","title":"Backup Dashboard","text":""},{"location":"services/grafana/#export-dashboard-json","title":"Export Dashboard JSON","text":"<ol> <li>Open dashboard</li> <li>Click Export</li> <li>Click Export as code</li> <li>Click Download file</li> </ol> <p>Store in safe location.</p>"},{"location":"services/grafana/#programmatic-backup","title":"Programmatic Backup","text":"<pre><code># Get dashboard JSON by UID\ncurl -H \"Authorization: Bearer &lt;your_service_account_token&gt;\" \\\n  http://&lt;vm_ip&gt;:3000/api/dashboards/uid/&lt;dashboard_uid&gt; &gt; dashboard_backup.json\n</code></pre> <p>Replace <code>&lt;dashboard_uid&gt;</code> with your dashboard UID (e.g., <code>ad5v9hp</code>).</p>"},{"location":"services/grafana/#restore-dashboard","title":"Restore Dashboard","text":"<ol> <li>Dashboards \u2192 New \u2192 Import</li> <li>Upload saved JSON</li> <li>Select data source</li> <li>Import</li> </ol>"},{"location":"services/grafana/#useful-links","title":"Useful Links","text":"<ul> <li>Grafana Docs: https://grafana.com/docs/</li> <li>Query Language: InfluxQL Guide</li> </ul>"},{"location":"services/grafana/#troubleshooting","title":"Troubleshooting","text":""},{"location":"services/grafana/#cant-connect-to-influxdb","title":"Can't Connect to InfluxDB","text":"<p>Check Docker network:</p> <pre><code>docker exec grafana ping influxdb\n</code></pre> <p>Should resolve to InfluxDB container IP.</p>"},{"location":"services/grafana/#image-rendering-not-working","title":"Image Rendering Not Working","text":"<p>Check renderer service:</p> <pre><code>docker compose ps grafana-image-renderer\ndocker compose logs grafana-image-renderer\n</code></pre> <p>Verify token matches in both services.</p>"},{"location":"services/grafana/#dashboard-shows-no-data","title":"Dashboard Shows No Data","text":"<ol> <li>Verify data exists in InfluxDB</li> <li>Check time range in dashboard</li> <li>Review query syntax</li> <li>Check data source configuration</li> </ol>"},{"location":"services/influxdb/","title":"InfluxDB Configuration","text":"<p>InfluxDB 1.x is used as the time-series database for storing weather and turbine sensor data.</p>"},{"location":"services/influxdb/#initial-setup","title":"Initial Setup","text":""},{"location":"services/influxdb/#access-influxdb-cli","title":"Access InfluxDB CLI","text":"<pre><code>docker exec -it influxdb influx\n</code></pre>"},{"location":"services/influxdb/#create-database","title":"Create Database","text":"<pre><code>CREATE DATABASE iot_data\nUSE iot_data\nSHOW MEASUREMENTS\nEXIT\n</code></pre>"},{"location":"services/influxdb/#verify-in-container-logs","title":"Verify in Container Logs","text":"<pre><code>docker compose logs influxdb\n</code></pre>"},{"location":"services/influxdb/#database-structure","title":"Database Structure","text":""},{"location":"services/influxdb/#measurements","title":"Measurements","text":"<p>Two main measurements are used:</p>"},{"location":"services/influxdb/#1-weather","title":"1. weather","text":"<p>Stores weather station data:</p> <pre><code>SELECT * FROM weather ORDER BY time DESC LIMIT 5\n</code></pre> <p>Fields:</p> <ul> <li>temperature_C</li> <li>humidity</li> <li>wind_speed_kmh, wind_speed_ms, wind_speed_kn</li> <li>wind_bft, wind_direction, wind_direction_deg</li> <li>air_pressure_hPa</li> <li>dew_point_C</li> <li>air_density</li> <li>visibility_m</li> <li>summary</li> </ul> <p>Tags:</p> <ul> <li>location</li> </ul>"},{"location":"services/influxdb/#2-turbine","title":"2. turbine","text":"<p>Stores wind turbine sensor data:</p> <pre><code>SELECT * FROM turbine ORDER BY time DESC LIMIT 5\n</code></pre> <p>Fields: (varies based on eGauge configuration)</p> <ul> <li>grid_* (power readings)</li> <li>orientation_* (orientation sensors)</li> <li>vibration_* (vibration sensors)</li> </ul> <p>Tags:</p> <ul> <li>source: \"rdm_windturbine\"</li> </ul>"},{"location":"services/influxdb/#configuration","title":"Configuration","text":""},{"location":"services/influxdb/#data-retention","title":"Data Retention","text":"<p>Check retention policies:</p> <pre><code>SHOW RETENTION POLICIES ON iot_data\n</code></pre> <p>Default is infinite. To set a retention policy (e.g., 90 days):</p> <pre><code>CREATE RETENTION POLICY \"90_days\" ON \"iot_data\" DURATION 90d REPLICATION 1 DEFAULT\n</code></pre>"},{"location":"services/influxdb/#continuous-queries","title":"Continuous Queries","text":"<p>For downsampling high-frequency data (optional):</p> <pre><code>CREATE CONTINUOUS QUERY \"downsample_turbine\" ON \"iot_data\"\nBEGIN\n  SELECT mean(*) INTO \"iot_data\".\"90_days\".\"turbine_1h\"\n  FROM \"turbine\"\n  GROUP BY time(1h), *\nEND\n</code></pre> <p>This creates hourly averages from 30-second data.</p>"},{"location":"services/influxdb/#backup-restore","title":"Backup &amp; Restore","text":""},{"location":"services/influxdb/#backup-database","title":"Backup Database","text":"<pre><code>docker exec influxdb influxd backup -portable -database iot_data /tmp/backup\ndocker cp influxdb:/tmp/backup ./influxdb_backup_$(date +%Y%m%d)\n</code></pre>"},{"location":"services/influxdb/#restore-database","title":"Restore Database","text":"<pre><code>docker cp ./influxdb_backup_20260107 influxdb:/tmp/restore\ndocker exec influxdb influxd restore -portable -db iot_data /tmp/restore\n</code></pre>"},{"location":"services/influxdb/#connecting-from-grafana","title":"Connecting from Grafana","text":"<p>To connect Grafana to InfluxDB:</p> <ol> <li>In Grafana, add InfluxDB as a data source</li> <li>Use URL: <code>http://influxdb:8086</code> (Docker DNS name)</li> <li>Database: <code>iot_data</code></li> <li>Leave authentication blank if not enabled</li> </ol> <p>For detailed steps, see Grafana Configuration - Add InfluxDB Data Source.</p>"},{"location":"services/influxdb/#connecting-from-node-red","title":"Connecting from Node-RED","text":"<p>Install InfluxDB node:</p> <ol> <li>In Node-RED UI, go to Menu \u2192 Manage palette</li> <li>Install tab \u2192 Search \"node-red-contrib-influxdb\"</li> <li>Click Install</li> </ol> <p>Configure in flow:</p> <ul> <li>Server: <code>influxdb</code> (use Docker DNS name) or <code>&lt;vm_ip&gt;</code> if Node-RED runs outside Docker</li> <li>Port: <code>8086</code></li> <li>Database: <code>iot_data</code></li> <li>Username: (leave blank if no auth)</li> <li>Password: (leave blank if no auth)</li> </ul>"},{"location":"services/influxdb/#monitoring","title":"Monitoring","text":""},{"location":"services/influxdb/#check-database-size","title":"Check Database Size","text":"<pre><code>SHOW STATS FOR 'database'\n</code></pre>"},{"location":"services/influxdb/#check-series-cardinality","title":"Check Series Cardinality","text":"<pre><code>SHOW SERIES CARDINALITY\n</code></pre> <p>High cardinality can impact performance.</p>"},{"location":"services/influxdb/#troubleshooting","title":"Troubleshooting","text":""},{"location":"services/influxdb/#connection-refused","title":"Connection Refused","text":"<p>Verify InfluxDB is running:</p> <pre><code>docker compose ps influxdb\n</code></pre> <p>Check if port 8086 is accessible:</p> <pre><code>curl -I http://&lt;influxdb_ip&gt;:8086/ping\n</code></pre> <p>Should return <code>HTTP/1.1 204 No Content</code> in the headers.</p> <p>IP Address Configuration</p> <p>Replace <code>&lt;influxdb_ip&gt;</code> with your VM's IP address (e.g., <code>192.168.178.164</code>) or use <code>localhost</code> if testing locally on the VM.</p>"},{"location":"services/influxdb/#out-of-memory","title":"Out of Memory","text":"<p>Increase InfluxDB memory in <code>docker-compose.yml</code>:</p> <pre><code>services:\n  influxdb:\n    mem_limit: 2g\n</code></pre>"},{"location":"services/influxdb/#slow-queries","title":"Slow Queries","text":"<p>Check query execution:</p> <pre><code>SHOW QUERIES\n</code></pre> <p>Kill slow query:</p> <pre><code>KILL QUERY &lt;query-id&gt;\n</code></pre>"},{"location":"services/influxdb/#useful-queries","title":"Useful Queries","text":""},{"location":"services/influxdb/#count-records","title":"Count Records","text":"<pre><code>SELECT COUNT(*) FROM weather\nSELECT COUNT(*) FROM turbine\n</code></pre>"},{"location":"services/influxdb/#time-range","title":"Time Range","text":"<pre><code>SELECT * FROM turbine WHERE time &gt; now() - 1h\n</code></pre>"},{"location":"services/influxdb/#aggregate","title":"Aggregate","text":"<pre><code>SELECT MEAN(temperature_C) FROM weather WHERE time &gt; now() - 24h GROUP BY time(1h)\n</code></pre>"},{"location":"services/influxdb/#delete-data","title":"Delete Data","text":"<pre><code>DELETE FROM weather WHERE time &lt; '2025-01-01'\n</code></pre>"},{"location":"services/influxdb/#security-optional","title":"Security (Optional)","text":""},{"location":"services/influxdb/#enable-authentication","title":"Enable Authentication","text":"<p>Edit InfluxDB config or environment variables in <code>docker-compose.yml</code>:</p> <pre><code>environment:\n  - INFLUXDB_HTTP_AUTH_ENABLED=true\n  - INFLUXDB_ADMIN_USER=admin\n  - INFLUXDB_ADMIN_PASSWORD=your_secure_password\n</code></pre> <p>Recreate container:</p> <pre><code>docker compose up -d influxdb\n</code></pre> <p>Update Grafana and Node-RED with credentials.</p>"},{"location":"services/node-red/","title":"Node-RED Configuration","text":"<p>Node-RED is the automation and orchestration engine that connects all components.</p>"},{"location":"services/node-red/#initial-access","title":"Initial Access","text":"<ul> <li>URL: <code>http://&lt;vm_ip&gt;:1880</code></li> <li>Replace <code>&lt;vm_ip&gt;</code> with your VM's IP address (e.g., <code>192.168.178.164</code>)</li> <li>No default authentication (configure security first)</li> </ul>"},{"location":"services/node-red/#enable-security-recommended","title":"Enable Security (Recommended)","text":""},{"location":"services/node-red/#generate-password-hash","title":"Generate Password Hash","text":"<pre><code>docker exec -it nodered node-red-admin hash-pw\n</code></pre> <p>Enter your desired password. Copy the hash (starts with <code>$2b$</code>).</p>"},{"location":"services/node-red/#edit-settings","title":"Edit Settings","text":"<pre><code>cd ~/IOTstack/volumes/nodered/data\nnano settings.js\n</code></pre> <p>Find the <code>adminAuth</code> section and uncomment/edit:</p> <pre><code>adminAuth: {\n    type: \"credentials\",\n    users: [{\n        username: \"admin\",\n        password: \"$2b$08$...(your hash here)\",\n        permissions: \"*\"\n    }]\n},\n</code></pre> <p>Save and restart Node-RED:</p> <pre><code>docker compose restart nodered\n</code></pre> <p>Now login required at <code>http://&lt;vm_ip&gt;:1880</code>.</p>"},{"location":"services/node-red/#docker-volume-configuration","title":"Docker Volume Configuration","text":""},{"location":"services/node-red/#add-ssh-keys-volume","title":"Add SSH Keys Volume","text":"<p>To enable SSH/SCP functionality from Node-RED to the Raspberry Pi, you need to mount the SSH directory as a volume in the Node-RED container.</p>"},{"location":"services/node-red/#option-1-using-portainer-recommended-for-beginners","title":"Option 1: Using Portainer (Recommended for Beginners)","text":"<ol> <li>Access Portainer:</li> <li>Navigate to <code>http://&lt;vm_ip&gt;:9000</code></li> <li> <p>Login with your credentials</p> </li> <li> <p>Navigate to Node-RED Container:</p> </li> <li>Click Containers in the left menu</li> <li>Find <code>nodered</code> in the list</li> <li> <p>Click Duplicate/Edit</p> </li> <li> <p>Stop the Container:</p> </li> <li>Click Stop on the container</li> <li> <p>Wait for it to fully stop</p> </li> <li> <p>Add Volume Mapping:</p> </li> <li>In the container details, scroll to Volumes section</li> <li>Click + map additional volume</li> <li>Container path: <code>/root/.ssh</code></li> <li>Host path: <code>/home/&lt;user&gt;/.ssh</code> (replace <code>&lt;user&gt;</code> with your username, e.g., <code>/home/kieran/.ssh</code>)</li> <li>Toggle Read-only to ON (recommended for security)</li> <li> <p>Click Deploy the container at the bottom</p> </li> <li> <p>Start the Container:</p> </li> <li>The container should start automatically after deployment</li> <li>Verify it's running with a green \"running\" status</li> </ol> <p>Alternative: Using Stacks</p> <p>You can also use the Stacks feature in Portainer to edit the entire docker-compose.yml and redeploy the stack.</p>"},{"location":"services/node-red/#option-2-using-command-line","title":"Option 2: Using Command Line","text":"<p>Edit the <code>docker-compose.yml</code> file in <code>~/IOTstack</code>:</p> <pre><code>cd ~/IOTstack\nnano docker-compose.yml\n</code></pre> <p>Find the <code>nodered</code> service section and add the SSH volume to the volumes list:</p> <pre><code>nodered:\n  container_name: nodered\n  image: nodered/node-red:latest\n  restart: unless-stopped\n  ports:\n    - \"1880:1880\"\n  volumes:\n    - ./volumes/nodered/data:/data\n    - /home/&lt;user&gt;/.ssh:/root/.ssh:ro  # Add this line\n  environment:\n    - TZ=Europe/Amsterdam\n</code></pre> <p>Replace <code>&lt;user&gt;</code> with your actual username (e.g., <code>/home/kieran/.ssh:/root/.ssh:ro</code>).</p> <p>Read-Only Mount</p> <p>The <code>:ro</code> flag mounts the volume as read-only for security. This allows Node-RED to read SSH keys but not modify them.</p> <p>After making changes, restart Node-RED:</p> <pre><code>docker compose down nodered\ndocker compose up -d nodered\n</code></pre>"},{"location":"services/node-red/#verify-volume-mount","title":"Verify Volume Mount","text":"<p>To confirm the SSH volume is properly mounted, check the container configuration:</p> <p>Via Portainer: - Go to Containers \u2192 nodered \u2192 Inspect - Scroll to Mounts section - Verify <code>/root/.ssh</code> is listed with source <code>/home/&lt;user&gt;/.ssh</code></p> <p>Via Command Line: <pre><code>docker inspect nodered | grep -A 5 Mounts\n</code></pre></p> <p>You should see the SSH directory mounted.</p>"},{"location":"services/node-red/#install-required-nodes","title":"Install Required Nodes","text":""},{"location":"services/node-red/#via-ui","title":"Via UI","text":"<ol> <li>Menu (\u2630) \u2192 Manage palette</li> <li>Install tab</li> <li>Search and install:</li> <li><code>node-red-contrib-influxdb</code></li> <li>(Any other custom nodes you need)</li> </ol>"},{"location":"services/node-red/#via-command-line","title":"Via Command Line","text":"<pre><code>docker exec -it nodered npm install --prefix /usr/src/node-red node-red-contrib-influxdb\ndocker compose restart nodered\n</code></pre>"},{"location":"services/node-red/#prerequisites-before-configuring-flow","title":"Prerequisites Before Configuring Flow","text":"<p>Before importing and configuring your flow, ensure:</p> <ol> <li>InfluxDB is running with database <code>iot_data</code> created - see InfluxDB Configuration</li> <li>Grafana is configured with dashboard and service account token - see Grafana Configuration</li> <li>Tailscale VPN is configured and running between VM and Raspberry Pi - see Tailscale Configuration below</li> <li>Raspberry Pi has SSH key-based authentication configured - see Raspberry Pi SSH Setup</li> <li>SSH known_hosts is configured - see SSH Known Hosts Setup below</li> </ol>"},{"location":"services/node-red/#ssh-known-hosts-setup","title":"SSH Known Hosts Setup","text":"<p>Before Node-RED can connect to the Raspberry Pi via SSH/SCP, you need to add the Pi to the known hosts file. This prevents SSH from prompting for host verification.</p> <p>On the VM, connect to the Pi via SSH as your regular user:</p> <pre><code>ssh &lt;pi-user&gt;@&lt;pi-tailscale-ip&gt;\n</code></pre> <p>Example: <pre><code>ssh hrtech@100.64.1.5\n</code></pre></p> <p>When prompted with \"Are you sure you want to continue connecting (yes/no)?\", type <code>yes</code> and press Enter. This adds the Pi to <code>~/.ssh/known_hosts</code>.</p> <p>You can then exit the SSH session:</p> <pre><code>exit\n</code></pre> <p>Required Before Node-RED Configuration</p> <p>This step must be completed before Node-RED can use SSH/SCP commands to the Raspberry Pi. The known_hosts file is shared with the Node-RED container through the volume mount.</p>"},{"location":"services/node-red/#tailscale-configuration","title":"Tailscale Configuration","text":"<p>Tailscale provides secure networking between the VM and Raspberry Pi without requiring manual port forwarding or complex VPN setup.</p>"},{"location":"services/node-red/#install-tailscale-on-vm","title":"Install Tailscale on VM","text":"<p>Run Tailscale natively on the VM (simpler than Docker-based setup):</p> <pre><code>curl -fsSL https://tailscale.com/install.sh | sh\nsudo tailscale up\n</code></pre> <p>Follow the authentication link to connect your VM to your Tailscale network.</p> <p>Get VM's Tailscale IP: <pre><code>tailscale ip -4\n</code></pre></p> <p>Note this IP address (typically in the <code>100.x.x.x</code> range).</p>"},{"location":"services/node-red/#install-tailscale-on-raspberry-pi","title":"Install Tailscale on Raspberry Pi","text":"<p>Prerequisite: Configure Raspberry Pi First</p> <p>Before proceeding, ensure Tailscale is installed and configured on your Raspberry Pi. </p> <p>See Raspberry Pi SSH Setup for complete Pi network configuration including Tailscale installation.</p> <p>After Tailscale is installed on the Pi, get its Tailscale IP:</p> <pre><code>tailscale ip -4\n</code></pre> <p>Note this IP address - you'll use it in Node-RED.</p>"},{"location":"services/node-red/#verify-connectivity","title":"Verify Connectivity","text":"<p>From VM, ping the Raspberry Pi: <pre><code>ping &lt;pi-tailscale-ip&gt;\n</code></pre></p> <p>Test SSH connection: <pre><code>ssh &lt;pi-user&gt;@&lt;pi-tailscale-ip&gt;\n</code></pre></p>"},{"location":"services/node-red/#configure-node-red-for-tailscale","title":"Configure Node-RED for Tailscale","text":"<p>Update the exec node's SCP command to use the Raspberry Pi's Tailscale IP:</p> <pre><code>scp /tmp/001.png &lt;pi-user&gt;@&lt;pi-tailscale-ip&gt;:/home/&lt;pi-user&gt;/incoming_images/incoming.png\n</code></pre> <p>Example: <pre><code>scp /tmp/001.png hrtech@100.64.1.5:/home/hrtech/incoming_images/incoming.png\n</code></pre></p> <p>Advantages of Tailscale</p> <ul> <li>No manual port forwarding required</li> <li>Automatic NAT traversal</li> <li>Easy multi-device management</li> <li>Built-in access controls</li> <li>Works across different networks</li> <li>Zero-config mesh networking</li> </ul>"},{"location":"services/node-red/#import-flow","title":"Import Flow","text":""},{"location":"services/node-red/#option-1-use-provided-flow","title":"Option 1: Use Provided Flow","text":"<p>This repository includes a pre-configured flow with all nodes already set up for the wind turbine monitoring system.</p> <p>Download: flows.json (right-click \u2192 Save link as...)</p> <ol> <li>In Node-RED UI, Menu \u2192 Import</li> <li>Select a file to import</li> <li>Choose the downloaded <code>flows.json</code> file</li> <li>Click Import</li> </ol>"},{"location":"services/node-red/#option-2-copy-directly","title":"Option 2: Copy Directly","text":"<p>If you have access to the repository on the VM, copy the flow file directly:</p> <pre><code>cp /path/to/repository/docs/files/flows.json ~/IOTstack/volumes/nodered/data/flows.json\ndocker compose restart nodered\n</code></pre> <p>Configuration Still Required</p> <p>After importing, you'll still need to configure the nodes with your specific values (IPs, tokens, etc.) as described in the Flow Configuration section below.</p>"},{"location":"services/node-red/#flow-configuration","title":"Flow Configuration","text":""},{"location":"services/node-red/#configure-influxdb-nodes","title":"Configure InfluxDB Nodes","text":"<p>For each InfluxDB node in the flow:</p> <ol> <li>Double-click the node</li> <li>Edit Server configuration:</li> <li>URL: <code>http://influxdb:8086</code> (Docker DNS name)</li> <li>Database: <code>iot_data</code></li> <li>Click Done</li> <li>Deploy</li> </ol> <p>See InfluxDB Configuration for database setup details.</p>"},{"location":"services/node-red/#configure-http-request-nodes","title":"Configure HTTP Request Nodes","text":""},{"location":"services/node-red/#weather-api-node","title":"Weather API Node","text":"<ul> <li>Method: GET</li> <li>URL: <code>https://weerlive.nl/api/weerlive_api_v2.php?key=3c2224ecab&amp;locatie=51.89908,4.42348</code></li> <li>Return: a parsed JSON object</li> </ul>"},{"location":"services/node-red/#egauge-node","title":"eGauge Node","text":"<ul> <li>Method: GET</li> <li>URL: <code>https://egauge84432.egaug.es/cgi-bin/egauge?inst</code></li> <li>Return: a UTF-8 string</li> <li>Authentication: Digest Auth</li> <li>Username: <code>HR_RDM</code></li> <li>Password: (provided separately)</li> </ul> <p>Authentication Required</p> <p>The eGauge API requires digest authentication for access. Ensure you have the correct credentials before configuring this node.</p> <p>API Details</p> <p>The eGauge XML API provides real-time instantaneous register values. See the eGauge XML API documentation for register types and data structures.</p> <p>Configuration Steps:</p> <ol> <li>Double-click the eGauge HTTP request node</li> <li>Check Use authentication</li> <li>Type: Digest authentication</li> <li>Enter Username: <code>HR_RDM</code></li> <li>Enter Password: (obtain from supervisor/administrator)</li> <li>Click Done</li> </ol>"},{"location":"services/node-red/#grafana-render-node","title":"Grafana Render Node","text":"<ul> <li>Method: GET</li> <li>URL: <code>http://&lt;vm_ip&gt;:3000/render/d/&lt;dashboard_uid&gt;?orgId=1&amp;from=now-1h&amp;to=now&amp;timezone=browser&amp;height=1440&amp;width=2560&amp;scale=1&amp;kiosk=true&amp;hideNav=true&amp;fullPageImage=true</code></li> <li>Return: a binary buffer</li> <li>Authentication: Bearer</li> <li>Token: Your Grafana service account token (starts with <code>glsa_</code>)</li> </ul> <p>Replace: - <code>&lt;vm_ip&gt;</code> with your VM's IP address - <code>&lt;dashboard_uid&gt;</code> with your dashboard UID from Grafana</p> <p>See Grafana Configuration - Generate Service Account Token and Get Dashboard UID for details.</p>"},{"location":"services/node-red/#configure-exec-nodes-ssh-to-raspberry-pi","title":"Configure Exec Nodes (SSH to Raspberry Pi)","text":"<p>The exec node for SCP uses Tailscale for secure connectivity:</p> <ul> <li>Command: <code>scp /tmp/001.png &lt;pi-user&gt;@&lt;pi-tailscale-ip&gt;:/home/&lt;pi-user&gt;/incoming_images/incoming.png</code></li> <li>Replace <code>&lt;pi-tailscale-ip&gt;</code> with your Pi's Tailscale IP (e.g., <code>100.64.1.5</code>)</li> <li>Replace <code>&lt;pi-user&gt;</code> with your Pi username (e.g., <code>hrtech</code>)</li> <li>All communication goes through Tailscale's encrypted mesh network</li> </ul> <p>Example: <pre><code>scp /tmp/001.png hrtech@100.64.1.5:/home/hrtech/incoming_images/incoming.png\n</code></pre></p> <p>Settings: - Append msg.payload: unchecked - Use spawn: unchecked</p> <p>Prerequisites:</p> <ul> <li>Tailscale configured and active (see Tailscale Configuration)</li> <li>SSH key-based authentication configured (see Raspberry Pi SSH Setup)</li> <li>SSH known_hosts configured (see SSH Known Hosts Setup)</li> <li>SSH volume mounted in Docker (see Docker Volume Configuration)</li> </ul> <p>Security Note: By using Tailscale's private network IPs, all SSH/SCP traffic is encrypted through a secure tunnel. SSH port 22 is never exposed to the public internet, eliminating a major security risk.</p>"},{"location":"services/node-red/#configure-inject-nodes-timing","title":"Configure Inject Nodes (Timing)","text":""},{"location":"services/node-red/#loop_turbine_data","title":"loop_turbine_data","text":"<ul> <li>Repeat: interval</li> <li>Every: 30 seconds</li> <li>Start automatically: checked</li> </ul>"},{"location":"services/node-red/#loop_weather_data","title":"loop_weather_data","text":"<ul> <li>Repeat: interval</li> <li>Every: 300 seconds (5 minutes)</li> <li>Start automatically: checked</li> </ul>"},{"location":"services/node-red/#loop_image_renderer","title":"loop_image_renderer","text":"<ul> <li>Repeat: interval</li> <li>Every: 300 seconds (5 minutes)</li> <li>Start automatically: checked</li> <li>Inject once: at start plus 0.1 seconds</li> </ul>"},{"location":"services/node-red/#function-node-code","title":"Function Node Code","text":"<p>The function nodes contain JavaScript for data processing. Key ones:</p>"},{"location":"services/node-red/#parse_data-weather","title":"parse_data (Weather)","text":"<p>Extracts weather data, calculates air density, formats for InfluxDB.</p> <pre><code>// See flows.json for complete code\nlet data = msg.payload;\nlet weather = data.liveweer[0];\n// ... processing ...\nmsg.payload = [{ measurement: \"weather\", tags: {...}, fields: {...} }];\nreturn msg;\n</code></pre>"},{"location":"services/node-red/#parse_data-turbine","title":"parse_data (Turbine)","text":"<p>Parses XML from eGauge, sanitizes field names, formats for InfluxDB.</p> <pre><code>// See flows.json for complete code\nfunction sanitize(name) {\n    // Prefix logic for S6_, IM_, VM_ etc.\n}\n// ... processing ...\nmsg.payload = [{ measurement: \"turbine\", tags: {...}, fields: {...} }];\nreturn msg;\n</code></pre>"},{"location":"services/node-red/#deploy-flow","title":"Deploy Flow","text":"<p>After configuration, click Deploy (top right).</p> <p>Monitor debug nodes:</p> <ul> <li>weather_data</li> <li>turbine_data</li> <li>Errors SCP</li> <li>Errors Refresh</li> </ul>"},{"location":"services/node-red/#flow-testing","title":"Flow Testing","text":""},{"location":"services/node-red/#test-individual-loops","title":"Test Individual Loops","text":"<p>Click the inject node's button to manually trigger:</p> <ol> <li>loop_turbine_data: Should fetch and store turbine data</li> <li>loop_weather_data: Should fetch and store weather data</li> <li>loop_image_renderer: Should render image and send to Pi</li> </ol>"},{"location":"services/node-red/#monitor-debug-output","title":"Monitor Debug Output","text":"<p>Open Debug panel (bug icon) to see:</p> <ul> <li>HTTP responses</li> <li>Parsed data</li> <li>InfluxDB write results</li> <li>Errors</li> </ul>"},{"location":"services/node-red/#backup-flow","title":"Backup Flow","text":""},{"location":"services/node-red/#export-flow","title":"Export Flow","text":"<ol> <li>Select all nodes (Ctrl+A)</li> <li>Menu \u2192 Export</li> <li>JSON tab</li> <li>Click Download</li> </ol> <p>Save to secure location.</p>"},{"location":"services/node-red/#automatic-backup","title":"Automatic Backup","text":"<p>Node-RED auto-saves flows to:</p> <pre><code>~/IOTstack/volumes/nodered/data/flows.json\n</code></pre> <p>Include in your regular backups.</p>"},{"location":"services/node-red/#useful-nodes","title":"Useful Nodes","text":""},{"location":"services/node-red/#debug-node","title":"Debug Node","text":"<p>Shows msg properties in debug panel:</p> <ul> <li>Set to <code>msg.payload</code> to see data</li> <li>Enable/disable with button</li> </ul>"},{"location":"services/node-red/#inject-node","title":"Inject Node","text":"<p>Manually trigger flows:</p> <ul> <li>Click button to inject</li> <li>Configure repeat intervals</li> </ul>"},{"location":"services/node-red/#function-node","title":"Function Node","text":"<p>Write custom JavaScript:</p> <ul> <li>Access <code>msg</code>, <code>context</code>, <code>flow</code>, <code>global</code></li> <li>Use <code>node.warn()</code> for logging</li> </ul>"},{"location":"services/node-red/#change-node","title":"Change Node","text":"<p>Modify message properties:</p> <ul> <li>Set, delete, move properties</li> <li>Use JSONata expressions</li> </ul>"},{"location":"services/node-red/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"services/node-red/#context-storage","title":"Context Storage","text":"<p>Enable file-based context (persists across restarts):</p> <p>Edit <code>settings.js</code>:</p> <pre><code>contextStorage: {\n    default: {\n        module: \"localfilesystem\"\n    },\n},\n</code></pre>"},{"location":"services/node-red/#custom-modules","title":"Custom Modules","text":"<p>Install npm packages:</p> <pre><code>docker exec -it nodered npm install --prefix /usr/src/node-red &lt;package-name&gt;\ndocker compose restart nodered\n</code></pre>"},{"location":"services/node-red/#environment-variables","title":"Environment Variables","text":"<p>Pass variables to Node-RED via <code>docker-compose.yml</code>:</p> <pre><code>nodered:\n  environment:\n    - TZ=Europe/Amsterdam\n    - NODE_RED_CREDENTIAL_SECRET=your_secret_key\n</code></pre>"},{"location":"services/node-red/#troubleshooting","title":"Troubleshooting","text":""},{"location":"services/node-red/#flow-not-running","title":"Flow Not Running","text":"<ol> <li>Check if Node-RED is running:</li> </ol> <pre><code>docker compose ps nodered\n</code></pre> <ol> <li>Check for errors in logs:</li> </ol> <pre><code>docker compose logs -f nodered\n</code></pre> <ol> <li>Verify flows are deployed (should see \"Flows started\")</li> </ol>"},{"location":"services/node-red/#http-request-timeouts","title":"HTTP Request Timeouts","text":"<p>Increase timeout in HTTP request node:</p> <ul> <li>Timeout: 60 seconds (default is 120)</li> </ul>"},{"location":"services/node-red/#influxdb-write-errors","title":"InfluxDB Write Errors","text":"<p>Check:</p> <ol> <li>InfluxDB is running</li> <li>Database exists</li> <li>Data format is correct (array of points)</li> <li>Network connectivity</li> </ol>"},{"location":"services/node-red/#sshscp-fails","title":"SSH/SCP Fails","text":"<p>Check Tailscale connectivity:</p> <ol> <li>Tailscale is running: <code>sudo tailscale status</code></li> <li>Tailscale connectivity: <code>ping &lt;pi-tailscale-ip&gt;</code></li> <li>Pi is online in Tailscale: Check <code>tailscale status</code> output shows the Pi</li> </ol> <p>Check SSH configuration:</p> <ol> <li>SSH volume is mounted: Check <code>docker-compose.yml</code> has <code>/home/&lt;user&gt;/.ssh:/root/.ssh:ro</code></li> <li>Known_hosts is configured: The Pi's host key should be in <code>~/.ssh/known_hosts</code></li> <li>SSH keys have correct permissions:    <pre><code>ls -l ~/.ssh/\n# id_rsa should be 600, id_rsa.pub should be 644\n</code></pre></li> <li>Test SSH manually from VM (not from Node-RED container):    <pre><code>ssh &lt;pi-user&gt;@&lt;pi-tailscale-ip&gt;\n</code></pre></li> <li>Path exists on Pi: <code>/home/&lt;pi-user&gt;/incoming_images/</code></li> <li>SSH keys are configured on the Pi (see Raspberry Pi SSH Setup)</li> </ol> <p>See: - Tailscale Configuration - Raspberry Pi SSH Setup - SSH Known Hosts Setup</p>"},{"location":"services/node-red/#performance","title":"Performance","text":""},{"location":"services/node-red/#limit-concurrent-requests","title":"Limit Concurrent Requests","text":"<p>Use Delay nodes to throttle:</p> <ul> <li>Action: Rate Limit</li> <li>All messages: 1 per 5 seconds</li> </ul>"},{"location":"services/node-red/#monitor-memory","title":"Monitor Memory","text":"<pre><code>docker stats nodered\n</code></pre> <p>If high memory usage, reduce flow complexity or increase container limits.</p>"},{"location":"services/node-red/#security-best-practices","title":"Security Best Practices","text":"<ol> <li>Enable authentication (adminAuth)</li> <li>Use HTTPS (reverse proxy with nginx)</li> <li>Limit network exposure (firewall rules)</li> <li>Secure credentials (use environment variables)</li> <li>Regular updates</li> </ol> <pre><code>docker compose pull nodered\ndocker compose up -d nodered\n</code></pre>"},{"location":"services/portainer/","title":"Portainer","text":"<p>Portainer provides a web UI for managing Docker containers, images, and stacks.</p>"},{"location":"services/portainer/#access","title":"Access","text":"<ul> <li>URL: <code>http://&lt;vm_ip&gt;:9000</code></li> <li>Replace <code>&lt;vm_ip&gt;</code> with your VM's IP address (e.g., <code>192.168.178.164</code>)</li> <li>Create admin user on first visit</li> </ul>"},{"location":"services/portainer/#initial-setup","title":"Initial Setup","text":"<ol> <li>Navigate to <code>http://&lt;vm_ip&gt;:9000</code></li> <li>Create admin user:</li> <li>Username: <code>admin</code></li> <li>Password: (set strong password)</li> <li>Click Create user</li> <li>Connect to local Docker:</li> <li>Select \"Get started\" \u2192 \"Local\"</li> <li>Portainer auto-connects to Docker socket</li> </ol>"},{"location":"services/portainer/#main-features","title":"Main Features","text":""},{"location":"services/portainer/#dashboard","title":"Dashboard","text":"<p>Overview of:</p> <ul> <li>Running containers</li> <li>Stopped containers</li> <li>Images</li> <li>Volumes</li> <li>Networks</li> </ul>"},{"location":"services/portainer/#containers","title":"Containers","text":"<p>View all containers with:</p> <ul> <li>Status (running, stopped, paused)</li> <li>CPU and memory usage</li> <li>Port mappings</li> </ul> <p>Actions:</p> <ul> <li>Start/Stop/Restart containers</li> <li>View logs</li> <li>Inspect container details</li> <li>Attach console</li> <li>View stats</li> </ul>"},{"location":"services/portainer/#stacks","title":"Stacks","text":"<p>Manage Docker Compose stacks:</p> <ul> <li>View IOTstack</li> <li>Edit docker-compose.yml</li> <li>Restart entire stack</li> <li>View stack containers</li> </ul>"},{"location":"services/portainer/#images","title":"Images","text":"<ul> <li>View all Docker images</li> <li>Pull new images</li> <li>Remove unused images</li> <li>Build images from Dockerfile</li> </ul>"},{"location":"services/portainer/#volumes","title":"Volumes","text":"<ul> <li>View persistent data volumes</li> <li>Browse volume contents</li> <li>Remove unused volumes</li> </ul>"},{"location":"services/portainer/#networks","title":"Networks","text":"<ul> <li>View Docker networks</li> <li>Create custom networks</li> <li>Inspect network details</li> </ul>"},{"location":"services/portainer/#common-tasks","title":"Common Tasks","text":""},{"location":"services/portainer/#view-container-logs","title":"View Container Logs","text":"<ol> <li>Go to Containers</li> <li>Click container name</li> <li>Logs tab</li> <li>Adjust:</li> <li>Lines to display</li> <li>Auto-refresh</li> <li>Wrap lines</li> </ol>"},{"location":"services/portainer/#restart-a-service","title":"Restart a Service","text":"<ol> <li>Go to Containers</li> <li>Select container checkbox</li> <li>Click Restart</li> </ol> <p>Or:</p> <ol> <li>Click container name</li> <li>Click Restart button at top</li> </ol>"},{"location":"services/portainer/#update-container-image","title":"Update Container Image","text":"<ol> <li>Go to Containers</li> <li>Click container name</li> <li>Image section shows current tag</li> <li>Go to Images \u2192 find image \u2192 Pull latest</li> <li>Return to Containers \u2192 Recreate container</li> </ol>"},{"location":"services/portainer/#execute-commands-in-container","title":"Execute Commands in Container","text":"<ol> <li>Go to Containers</li> <li>Click container name</li> <li>Console tab</li> <li>Choose shell (usually <code>/bin/bash</code> or <code>/bin/sh</code>)</li> <li>Click Connect</li> </ol>"},{"location":"services/portainer/#monitor-resource-usage","title":"Monitor Resource Usage","text":"<ol> <li>Go to Containers</li> <li>Click container name</li> <li>Stats tab</li> <li>View:</li> <li>CPU usage %</li> <li>Memory usage</li> <li>Network I/O</li> <li>Block I/O</li> </ol>"},{"location":"services/portainer/#stack-management","title":"Stack Management","text":""},{"location":"services/portainer/#view-iotstack","title":"View IOTstack","text":"<ol> <li>Go to Stacks</li> <li>Click <code>iotstack</code> (or your stack name)</li> <li>View:</li> <li>Containers in stack</li> <li>Stack file (docker-compose.yml)</li> </ol>"},{"location":"services/portainer/#edit-stack","title":"Edit Stack","text":"<ol> <li>Stacks \u2192 Select stack</li> <li>Editor tab</li> <li>Modify <code>docker-compose.yml</code></li> <li>Click Update the stack</li> <li>Containers will be recreated with new config</li> </ol> <p>Warning: Use with caution, prefer editing files directly via SSH.</p>"},{"location":"services/portainer/#restart-stack","title":"Restart Stack","text":"<ol> <li>Stacks \u2192 Select stack</li> <li>Click Stop this stack</li> <li>Wait for all containers to stop</li> <li>Click Start this stack</li> </ol>"},{"location":"services/portainer/#security","title":"Security","text":""},{"location":"services/portainer/#change-admin-password","title":"Change Admin Password","text":"<ol> <li>Users \u2192 Select admin user</li> <li>Change password</li> <li>Enter current and new password</li> <li>Save</li> </ol>"},{"location":"services/portainer/#add-users","title":"Add Users","text":"<ol> <li>Go to Users</li> <li>Click Add user</li> <li>Set username and password</li> <li>Assign role (admin or user)</li> <li>Create</li> </ol>"},{"location":"services/portainer/#enable-two-factor-authentication","title":"Enable Two-Factor Authentication","text":"<p>Available in Portainer Business Edition (paid).</p>"},{"location":"services/portainer/#backup-portainer-data","title":"Backup Portainer Data","text":"<p>Portainer data is stored in a Docker volume:</p> <pre><code>docker volume ls | grep portainer\n</code></pre> <p>Backup:</p> <pre><code>docker run --rm -v portainer_data:/data -v $(pwd):/backup \\\n  alpine tar czf /backup/portainer_backup.tar.gz /data\n</code></pre> <p>Restore:</p> <pre><code>docker run --rm -v portainer_data:/data -v $(pwd):/backup \\\n  alpine sh -c \"cd /data &amp;&amp; tar xzf /backup/portainer_backup.tar.gz --strip 1\"\n</code></pre>"},{"location":"services/portainer/#useful-features","title":"Useful Features","text":""},{"location":"services/portainer/#image-cleanup","title":"Image Cleanup","text":"<p>Remove unused images to free space:</p> <ol> <li>Images \u2192 Unused</li> <li>Select all unused images</li> <li>Click Remove</li> </ol>"},{"location":"services/portainer/#volume-cleanup","title":"Volume Cleanup","text":"<p>Remove unused volumes:</p> <ol> <li>Volumes \u2192 Unused</li> <li>Select volumes</li> <li>Remove</li> </ol>"},{"location":"services/portainer/#quick-actions","title":"Quick Actions","text":"<p>From dashboard:</p> <ul> <li>Click numbers to jump to containers/images/volumes</li> <li>Use search to find specific containers</li> <li>Filter by status</li> </ul>"},{"location":"services/portainer/#troubleshooting","title":"Troubleshooting","text":""},{"location":"services/portainer/#cant-access-portainer","title":"Can't Access Portainer","text":"<p>Check if running:</p> <pre><code>docker compose ps portainer\n</code></pre> <p>Restart:</p> <pre><code>docker compose restart portainer\n</code></pre>"},{"location":"services/portainer/#forgot-admin-password","title":"Forgot Admin Password","text":"<p>Reset by recreating Portainer:</p> <pre><code>cd ~/IOTstack\ndocker compose down portainer\ndocker volume rm portainer_data\ndocker compose up -d portainer\n</code></pre> <p>Warning: This deletes all Portainer settings. You'll need to reconfigure.</p>"},{"location":"services/portainer/#portainer-shows-wrong-status","title":"Portainer Shows Wrong Status","text":"<p>Refresh browser or clear cache:</p> <ul> <li>Ctrl+Shift+R (hard refresh)</li> <li>Or clear browser cache</li> </ul>"},{"location":"services/portainer/#limitations","title":"Limitations","text":"<ul> <li>Cannot replace direct command-line access</li> <li>Some advanced Docker features not available in UI</li> <li>Performance overhead (minimal)</li> </ul>"},{"location":"services/portainer/#alternatives","title":"Alternatives","text":"<p>If Portainer doesn't meet your needs:</p> <ul> <li>Yacht: Lightweight alternative</li> <li>Dockge: Stack-focused manager</li> <li>Lazydocker: Terminal UI for Docker</li> </ul>"},{"location":"services/portainer/#updates","title":"Updates","text":"<p>Portainer included in IOTstack. Update with:</p> <pre><code>cd ~/IOTstack\ndocker compose pull portainer\ndocker compose up -d portainer\n</code></pre> <p>Check Portainer releases for changes.</p>"}]}